import{g as qe,c as Sr,r as A,R as X}from"./index.DRjF_FHU.js";function Er(e,t){return Array.isArray(t)?t.includes(e):t===e}function ee(e,t,r){return e.context?e.callback(r,...t):e.callback(...t)}class kr{constructor(){this.interceptions=[],this.interceptionKeySet=new Set}isUsed(){return this.interceptions.length>0}intercept(t){this.interceptions.push(t),Object.keys(t).forEach(r=>{this.interceptionKeySet.add(r)})}tap(t){this.interceptionKeySet.has("tap")&&this.interceptions.forEach(r=>{var n;(n=r.tap)==null||n.call(r,t)})}call(t,...r){this.interceptionKeySet.has("call")&&this.interceptions.forEach(n=>{var i,o;n.context?(i=n.call)==null||i.call(n,t,...r):(o=n.call)==null||o.call(n,...r)})}loop(...t){this.interceptionKeySet.has("loop")&&this.interceptions.forEach(r=>{var n;(n=r.loop)==null||n.call(r,...t)})}error(t){if(this.interceptionKeySet.has("error")&&t instanceof Error){const r=t;this.interceptions.forEach(n=>{var i;(i=n.error)==null||i.call(n,r)})}}result(t){this.interceptionKeySet.has("result")&&this.interceptions.forEach(r=>{var n;(n=r.result)==null||n.call(r,t)})}done(){this.interceptionKeySet.has("done")&&this.interceptions.forEach(t=>{var r;(r=t.done)==null||r.call(t)})}}class te{constructor(){this.taps=[],this.interceptions=new kr}tap(t,r){const n=typeof t=="string"?{name:t,context:!1}:{context:!1,...t},o={key:Symbol(n.name),...n,callback:r};if(o.before){let s=this.taps.length;const l=new Set(Array.isArray(o.before)?o.before:[o.before]);for(s;s>0&&l.size>0;s--){const a=this.taps[s-1];if(l.has(a.name)&&l.delete(a.name),a.before&&Er(o.name,a.before))break}this.taps.splice(s,0,o)}else this.taps.push(o);return this.interceptions.tap(o),o}untap(t){this.taps=this.taps.filter(r=>r.key!==t.key)}isUsed(){return this.taps.length>0||this.interceptions.isUsed()}intercept(t){this.interceptions.intercept(t)}}class E extends te{call(...t){if(!this.isUsed())return;const r={};this.interceptions.call(r,...t);try{this.taps.forEach(n=>{ee(n,t,r)})}catch(n){throw this.interceptions.error(n),n}this.interceptions.done()}}class J extends te{call(...t){if(!this.isUsed())return;const r={};this.interceptions.call(r,...t);for(let n=0;n<this.taps.length;n+=1){const i=ee(this.taps[n],t,r);if(i!==void 0)return this.interceptions.result(i),i}this.interceptions.done()}}class R extends te{call(...t){const r={};this.interceptions.call(r,...t);let[n,...i]=t;for(let o=0;o<this.taps.length;o+=1){const s=ee(this.taps[o],[n,...i],r);s!==void 0&&(n=s)}return this.interceptions.result(n),n}}class As extends te{async call(...t){const r={};this.interceptions.call(r,...t),await Promise.allSettled(this.taps.map(n=>ee(n,t,r))),this.interceptions.done()}}class Cs extends te{async call(...t){const r={};this.interceptions.call(r,...t);try{for(let n=0;n<this.taps.length;n+=1)await ee(this.taps[n],t,r)}catch(n){throw this.interceptions.error(n),n}this.interceptions.done()}}class Ts extends te{async call(...t){let[r,...n]=t;const i={};this.interceptions.call(i,...t);try{for(let o=0;o<this.taps.length;o+=1){const s=await ee(this.taps[o],[r,...n],i);s!==void 0&&(r=s)}}catch(o){throw this.interceptions.error(o),o}return this.interceptions.result(r),r}}var ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.toError=Z=ae.NestedError=void 0;class K extends Error{constructor(t,...r){super(t);const n=K.getErrorReport(this);if(r.length===1){const o=$e(r[0]);this.innerErrors=[o];const s=K.getErrorReport(o);this.stack=`${n}

======= INNER ERROR =======

${s}`;return}this.innerErrors=r.map(o=>$e(o));const i=this.innerErrors.map((o,s)=>{const l=K.getErrorReport(o);return`======= INNER ERROR (${s+1} of ${r.length}) =======

${l}`}).join(`

`);this.stack=`${n}

${i}`}get innerError(){return this.innerErrors.length===0?null:this.innerErrors[0]}static rethrow(t){return(...r)=>{throw new this(t,...r)}}}var Z=ae.NestedError=K;K.getErrorReport=typeof new Error().stack=="string"?e=>e.stack:e=>`${e.name}: ${e.message}`;K.prototype.name="NestedError";function $e(e){try{return e instanceof Error?e:new Error(`Value that is not an instance of Error was thrown: ${e}`)}catch{return new Error("Failed to stringify non-instance of Error that was thrown.This is possibly due to the fact that toString() method of the valuedoesn't return a primitive value.")}}ae.toError=$e;function Ke(e,t,r,n,i){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:i;return e===i?r:e}var _={};Object.defineProperty(_,"__esModule",{value:!0});var Or=_.clone=me,Ar=_.addLast=Vt;_.addFirst=Mt;_.removeLast=Rt;_.removeFirst=xt;_.insert=Nt;var Cr=_.removeAt=Dt;_.replaceAt=_t;_.getIn=be;var Tr=_.set=Se,U=_.setIn=Ee;_.update=It;_.updateIn=jt;_.merge=$t;_.mergeDeep=Ft;_.mergeIn=Ut;var Ct=_.omit=Lt;_.addDefaults=zt;_.default=void 0;/*!
 * Timm
 *
 * Immutability helpers with fast reads and acceptable writes.
 *
 * @copyright Guillermo Grau Panea 2016
 * @license MIT
 */const Tt="INVALID_ARGS";function Pt(e){throw new Error(e)}function Ge(e){const t=Object.keys(e);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t}const Pr={}.hasOwnProperty;function me(e){if(Array.isArray(e))return e.slice();const t=e,r=Ge(t),n={};for(let i=0;i<r.length;i++){const o=r[i];n[o]=t[o]}return n}function ve(e){return e!=null&&typeof e=="object"}function Vt(e,t){return Array.isArray(t)?e.concat(t):e.concat([t])}function Mt(e,t){return Array.isArray(t)?t.concat(e):[t].concat(e)}function Rt(e){return e.length?e.slice(0,e.length-1):e}function xt(e){return e.length?e.slice(1):e}function Nt(e,t,r){return e.slice(0,t).concat(Array.isArray(r)?r:[r]).concat(e.slice(t))}function Dt(e,t){return t>=e.length||t<0?e:e.slice(0,t).concat(e.slice(t+1))}function _t(e,t,r){if(e[t]===r)return e;const n=e.length,i=Array(n);for(let o=0;o<n;o++)i[o]=e[o];return i[t]=r,i}function be(e,t){if(Array.isArray(t)||Pt(Tt),e==null)return;let r=e;for(let n=0;n<t.length;n++){const i=t[n];if(r=r?.[i],r===void 0)return r}return r}function Se(e,t,r){let n=e;if(n==null&&(n=typeof t=="number"?[]:{}),n[t]===r)return n;const i=me(n);return i[t]=r,i}function Ee(e,t,r){return t.length?Bt(e,t,r,0):r}function Bt(e,t,r,n){let i;const o=t[n];if(n===t.length-1)i=r;else{const s=ve(e)&&ve(e[o])?e[o]:typeof t[n+1]=="number"?[]:{};i=Bt(s,t,r,n+1)}return Se(e,o,i)}function It(e,t,r){const n=e?.[t],i=r(n);return Se(e,t,i)}function jt(e,t,r){const n=be(e,t),i=r(n);return Ee(e,t,i)}function $t(e,t,r,n,i,o,...s){return s.length?z.call(null,!1,!1,e,t,r,n,i,o,...s):z(!1,!1,e,t,r,n,i,o)}function Ft(e,t,r,n,i,o,...s){return s.length?z.call(null,!1,!0,e,t,r,n,i,o,...s):z(!1,!0,e,t,r,n,i,o)}function Ut(e,t,r,n,i,o,s,...l){let a=be(e,t);a==null&&(a={});let c;return l.length?c=z.call(null,!1,!1,a,r,n,i,o,s,...l):c=z(!1,!1,a,r,n,i,o,s),Ee(e,t,c)}function Lt(e,t){const r=Array.isArray(t)?t:[t];let n=!1;for(let s=0;s<r.length;s++)if(Pr.call(e,r[s])){n=!0;break}if(!n)return e;const i={},o=Ge(e);for(let s=0;s<o.length;s++){const l=o[s];r.indexOf(l)>=0||(i[l]=e[l])}return i}function zt(e,t,r,n,i,o,...s){return s.length?z.call(null,!0,!1,e,t,r,n,i,o,...s):z(!0,!1,e,t,r,n,i,o)}function z(e,t,r,...n){let i=r;i==null&&Pt(Tt);let o=!1;for(let s=0;s<n.length;s++){const l=n[s];if(l==null)continue;const a=Ge(l);if(a.length)for(let c=0;c<=a.length;c++){const d=a[c];if(e&&i[d]!==void 0)continue;let h=l[d];t&&ve(i[d])&&ve(h)&&(h=z(e,t,i[d],h)),!(h===void 0||h===i[d])&&(o||(o=!0,i=me(i)),i[d]=h)}}return i}const Vr={clone:me,addLast:Vt,addFirst:Mt,removeLast:Rt,removeFirst:xt,insert:Nt,removeAt:Dt,replaceAt:_t,getIn:be,set:Se,setIn:Ee,update:It,updateIn:jt,merge:$t,mergeDeep:Ft,mergeIn:Ut,omit:Lt,addDefaults:zt};var Mr=Vr;_.default=Mr;var Je=Object.prototype.hasOwnProperty;function Ze(e,t,r){for(r of e.keys())if(G(r,t))return r}function G(e,t){var r,n,i;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&G(e[n],t[n]););return n===-1}if(r===Set){if(e.size!==t.size)return!1;for(n of e)if(i=n,i&&typeof i=="object"&&(i=Ze(t,i),!i)||!t.has(i))return!1;return!0}if(r===Map){if(e.size!==t.size)return!1;for(n of e)if(i=n[0],i&&typeof i=="object"&&(i=Ze(t,i),!i)||!G(n[1],t.get(i)))return!1;return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return n===-1}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(Je.call(e,r)&&++n&&!Je.call(t,r)||!(r in t)||!G(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}const Rr=()=>{const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e};var xr=Rr;const Ht=qe(xr);/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let et;var Nr=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Sr):e=>(et||(et=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0));const Dr=qe(Nr);var qt={exports:{}};(function(e){var t=function(){var r=n({constructor:function(o,s){this.array=[],this.compare=s||i;for(var l=o.length,a=0;a<l;)this.insert(o[a++])},insert:function(o){for(var s=this.array,l=this.compare,a=s.length-1,c=0,d=-1,h,v;a>=c;)if(h=(a+c)/2>>>0,v=l(s[h],o),v<0)c=h+1;else if(v>0)a=h-1;else{d=h;break}for(d===-1&&(d=a),d++,a=s.length-1;d<a&&l(o,s[d])===0;)d++;for(h=s.length,s.push(o);h>d;)s[h]=s[--h];return s[d]=o,this},search:function(o){for(var s=this.array,l=this.compare,a=s.length-1,c=0,d,h;a>=c;)if(d=(a+c)/2>>>0,h=l(s[d],o),h<0)c=d+1;else if(h>0)a=d-1;else return d;return-1},remove:function(o){var s=this.search(o);return s>=0&&this.array.splice(s,1),this}});return r.comparing=function(o,s){return new r(s,function(l,a){return i(l[o],a[o])})},r;function n(o){var s=o.constructor;return s.prototype=o,s}function i(o,s){return o<s?-1:o>s?1:0}}();e.exports=t})(qt);var _r=qt.exports;const Br=qe(_r);function Kt(e,t=[],r=new Map){for(const n of Object.keys(e)){const i=e[n],o=[...t,n];typeof i=="object"?Kt(i,o,r):r.set(o,i)}return r}function Ir(e){const t=Kt(e),r=n=>{for(const i of Array.from(t)){const[o,s]=i;if(Ke(n,o)!==s)return!1}return!0};return r.count=t.size,r}function jr(e){const t=r=>e===r;return t.count=1,t}var tt=()=>new Br([],e=>e.matcher.count),$r=class{constructor(e){this.store=tt(),e?.forEach(([t,r])=>{this.set(t,r)})}set(e,t){const r=typeof e=="object"?Ir(e):jr(e);this.store.insert({key:e,value:t,matcher:r})}get(e){for(const t of this.store.array)if(t.matcher(e))return t.value}forEach(e){for(const t of this.store.array)e(t)}clear(){this.store=tt()}isRegistryEmpty(){return this.store.array.length===0}},Fr=Object.defineProperty,Ur=(e,t)=>{for(var r in t)Fr(e,r,{get:t[r],enumerable:!0})},rt=e=>({name:"Value",value:e}),Lr=e=>({name:"Expression",value:e}),zr=e=>({name:"PathNode",path:e}),Hr=(e,t)=>({name:"Query",key:e,value:t}),qr=e=>e.length===1?e[0]:{name:"Concatenated",value:e},Kr=".",Te="{",Pe="}",nt="[",Gr="]",it="=",ue="'",Ve='"',he="`",st=e=>{if(!e)return!1;const t=e.charCodeAt(0);return!(t===32||t===34||t===39||t===40||t===41||t===42||t===46||t===61||t===91||t===93||t===96||t===123||t===125)},Wr=e=>{let t=1,r=e.charAt(0);const n=w=>{if(w&&r!==w)throw new Error(`Expected char: ${w} but got: ${r}`);return r=e.charAt(t),t+=1,r},i=()=>{for(;r===" ";)n()},o=()=>{if(!st(r))return;let w=r;for(;n()&&st(r);)w+=r;if(w){const b=Number(w);return w=isNaN(b)?w:b,rt(w)}},s=()=>{if(r===he){n(he);let w=r;for(;n()&&r!==he;)w+=r;if(n(he),w)return Lr(w)}},l=w=>{if(!r?.match(w))return;let b=r;for(;n()&&r?.match(w);)b+=r;if(b)return rt(b)},a=()=>{if(r===Te){n(Te),n(Te);const w=g();return n(Pe),n(Pe),w}},c=()=>a()??s()??o(),d=()=>{const w=[];let b=c();for(;b!==void 0;)w.push(b),b=c();if(w.length!==0)return qr(w)},h=()=>{if(i(),r===ue||r===Ve){const w=r===ue;n(w?ue:Ve);const b=l(/[^'"]+/);return n(w?ue:Ve),b}return c()},v=()=>{if(r!==it)return!1;for(;r===it;)n();return!0},p=()=>{if(r===nt){n(nt),i();let w=h();if(w){if(i(),v()){i();const b=h();w=Hr(w,b),i()}}else throw new Error("Expected identifier");return w&&n(Gr),w}},y=()=>{const w=[],b=d();if(b){w.push(b);let k=p();if(k?.name==="Value"){const x=Number(k.value);k.value=isNaN(x)||String(x)!==k.value?k.value:x}for(;k!==void 0;)w.push(k),k=p()}return w},g=()=>{const w=[];let b=y();for(;b!==void 0&&(w.push(...b),!(!r||r===Pe));){if(b.length===0&&r)throw new Error(`Unexpected character: ${r}`);n(Kr),b=y()}return zr(w)};try{return{status:!0,path:g()}}catch(w){return{status:!1,error:w.message}}};function W(e){return!(typeof e=="string"||Array.isArray(e))}function Qr(e){const t=parseInt(e,10);return isNaN(t)?e:t}function Yr(e){return Array.isArray(e)?e:typeof e=="string"?e.split("."):e.asArray()}function Xr(e,t,r){return e.findIndex(n=>n&&typeof n=="object"?n[t]==r:!1)}var Q=class Gt{constructor(t,r=n=>new Gt(n)){const n=Array.isArray(t)?t:t.split(".");this.split=n.map(i=>{if(typeof i=="number")return i;const o=Number(i);return isNaN(o)||String(o)!==i?i:o}),Object.freeze(this.split),this.joined=this.split.join("."),this.factory=r}asArray(){return this.split}asString(){return this.joined}contains(t){const r=t.asArray();if(r.length<this.split.length)return!1;for(let n=0;n<this.split.length;n++)if(this.split[n]!==r[n])return!1;return!0}relative(t){return this.asArray().slice(t.asArray().length)}parent(){return this.factory(this.split.slice(0,-1))}key(){return this.split[this.split.length-1]}descendent(t){const r=Yr(t);return this.factory(this.split.concat(r))}};function Wt(e,t,r){const n={updates:{},path:[]};function i(l){if(l.name==="Value")return l.value;if(l.name==="PathNode"){const a=Wt(l,t);a.updates&&(n.updates={...n.updates,...a.updates});try{return t.convertToPath(t.getValue(a.path))}catch(c){throw new Z(`Unable to resolve path segment: ${a.path}`,c)}}if(l.name==="Expression")try{const a=t.evaluate(l.value);return t.convertToPath(a)}catch(a){throw new Z(`Unable to resolve path: ${l.value}`,a)}throw new Error(`Unable to resolve value for node: ${l.name}`)}function o(l){typeof l=="string"&&l.indexOf(".")>-1?l.split(".").forEach(a=>{n.path.push(Qr(a))}):n.path.push(l)}function s(l){const a=r?.beforeResolveNode.call(l,{...n,...t})??l;switch(a.name){case"Expression":case"PathNode":o(i(a));break;case"Value":o(a.value);break;case"Query":{const c=t.getValue(n.path)??[],{key:d,value:h}=a,v=i(d),p=h&&i(h),y=Xr(c,v,p);y===void 0||y===-1?(n.updates[[...n.path,c.length,v].join(".")]=p,n.path.push(c.length)):n.path.push(y);break}case"Concatenated":n.path.push(a.value.map(i).join(""));break;default:throw new Error(`Unsupported node type: ${a.name}`)}}return e.path.forEach(s),{path:n.path,updates:Object.keys(n.updates??{}).length>0?n.updates:void 0}}var Jr=/[\s()*=`{}'"[\]]/,Zr=/^[^.]+(\..+)*$/,en={get:()=>{throw new Error("Not Implemented")},set:()=>{throw new Error("Not Implemented")},evaluate:()=>{throw new Error("Not Implemented")}},tn=class{constructor(e){this.hooks={skipOptimization:new J,beforeResolveNode:new R},this.parserOptions={...en,...e},this.cache={},this.parseCache={},this.parse=this.parse.bind(this)}normalizePath(e,t){if(!Jr.test(e)&&Zr.test(e)&&this.hooks.skipOptimization.call(e)!==!0)return{path:e.split("."),updates:void 0};const r=this.parseCache[e]??Wr(e);if(this.parseCache[e]=r,typeof r!="object"||!r?.status)throw new TypeError(`Cannot normalize path "${e}": ${r?.error??"Unknown Error."}`);try{return Wt(r.path,t,this.hooks)}catch(n){throw new Z(`Cannot resolve binding: ${e}`,n)}}getBindingForNormalizedResult(e){const t=e.path.join(".");if(this.cache[t])return this.cache[t];const r=new Q(t===""?[]:e.path,this.parse);return this.cache[t]=r,r}parse(e,t={}){if(W(e))return e;const r={...this.parserOptions,...t};let n={};const i=Array.isArray(e)?e.join("."):String(e),o={getValue:a=>{const c=this.normalizePath(a.join("."),o);return r.get(this.getBindingForNormalizedResult(c))},evaluate:a=>r.evaluate(a),convertToPath:a=>{if(a===void 0)throw new Error("Attempted to convert undefined value to binding path");if(typeof a!="string"&&typeof a!="number"&&typeof a!="boolean")throw new Error(`Attempting to convert ${typeof a} to a binding path.`);const c=this.normalizePath(String(a),o);c.updates&&(n={...n,...c.updates});const d=c.path.join(".");if(d==="")throw new Error("Nested path resolved to an empty path");return d}},s=this.normalizePath(i,o);s.updates&&(n={...n,...s.updates});const l=Object.keys(n);if(!r.readOnly&&l.length>0){const a=l.map(c=>[this.parse(c),n[c]]);r.set(a)}return this.getBindingForNormalizedResult(s)}},rn=class{constructor(){this.readDeps=new Set,this.writeDeps=new Set,this.namedDependencySets={},this.namedSet="core",this.createSubset("core"),this.createSubset("children")}createSubset(e,t=!1){(t||!this.namedDependencySets[e])&&(this.namedDependencySets[e]={readDeps:new Set,writeDeps:new Set})}getDependencies(e){return e!==void 0?this.namedDependencySets?.[e]?.readDeps??new Set:this.readDeps}trackSubset(e){this.createSubset(e),this.namedSet=e}trackDefault(){this.namedSet="core"}getModified(e){return e!==void 0?this.namedDependencySets?.[e]?.writeDeps??new Set:this.writeDeps}readsBinding(e){return this.readDeps.has(e)}writesBinding(e){return this.writeDeps.has(e)}reset(){this.readDeps=new Set,this.writeDeps=new Set,this.namedDependencySets={},this.namedSet="core",this.createSubset("core",!0),this.createSubset("children",!0)}addReadDep(e,t=this.namedSet){t&&this.namedDependencySets?.[t]?.readDeps.add(e),this.readDeps.add(e)}addWriteDep(e,t=this.namedSet){t&&this.namedDependencySets?.[t]?.writeDeps.add(e),this.writeDeps.add(e)}addChildReadDep(e){this.addReadDep(e,"children")}},nn=class extends rn{constructor(e){super(),this.rootModel=e,this.set=this.set.bind(this),this.get=this.get.bind(this)}set(e,t){return e.forEach(([r])=>this.addWriteDep(r)),this.rootModel.set(e,t)}get(e,t){return this.addReadDep(e),this.rootModel.get(e,t)}delete(e,t){return this.addWriteDep(e),this.rootModel.delete(e,t)}},sn=class{get(){}set(){return[]}delete(){}},ot=new sn,on=new Q([]);function an(e,t){function r(n,i){const o=W(n)?n:t(n,{get:e.get,set:e.set,readOnly:i});if(!o)throw new Error("Unable to parse binding");return o}return{get(n,i){return e.get(r(n,!0),i)},set(n,i){return e.set(n.map(([o,s])=>[r(o,!1),s]),i)},delete(n,i){return e.delete(r(n,!1),i)}}}function Fe(e,t,r){return r?{get:(n,i)=>{const o=i??t;return e.get?e.get(n,o,r):r?.get(n,o)},set:(n,i)=>{const o=i??t;return e.set?e.set(n,o,r):r?.set(n,o)},delete:(n,i)=>{const o=i??t;return e.delete?e.delete(n,o,r):r?.delete(n,o)}}:e}function Me(e){if(e.length===0)return ot;if(e.length===1)return Fe(e[0]);function t(r){return e.reduce((i,o)=>Fe(o,r,i),void 0)??ot}return{get:(r,n)=>t(n)?.get(r,n),set:(r,n)=>t(n)?.set(r,n),delete:(r,n)=>t(n)?.delete(r,n)}}var ln=class{constructor(e=[]){this.hooks={onSet:new E},this.pipeline=e,this.effectiveDataModel=Me(this.pipeline)}setMiddleware(e){this.pipeline=e,this.effectiveDataModel=Me(e)}addMiddleware(e){this.pipeline=[...this.pipeline,e],this.effectiveDataModel=Me(this.pipeline)}reset(e={}){this.pipeline.forEach(t=>{"reset"in t&&t.reset?.()}),this.set([[on,e]])}set(e,t){const r=this.effectiveDataModel.set(e,t);return this.hooks.onSet.call(e),r}get(e,t){return this.effectiveDataModel.get(e,t)}delete(e,t){return this.effectiveDataModel.delete(e,t)}},Ue=class{constructor(e={}){this.model=e,this.get=this.get.bind(this),this.set=this.set.bind(this)}reset(e={}){this.model=e}get(e){return!e||!e.asString()?this.model:Ke(this.model,e.asArray())}set(e){const t=[];return e.forEach(([r,n])=>{const i=this.get(r);this.model=U(this.model,r.asArray(),n),t.push({binding:r,oldValue:i,newValue:n})}),t}delete(e){const t=e.parent();if(t){const r=this.get(t);r!==void 0&&(Array.isArray(r)?this.model=U(this.model,t.asArray(),Cr(r,e.key())):this.model=U(this.model,t.asArray(),Ct(r,e.key())))}}},j=Symbol("Expression Node ID");function Qt(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)&&e.__id===j}var re=46,Re=44,at=39,lt=34,de=40,ct=41,xe=91,ut=93,cn=63,un=59,ht=58,ye=123,Ne=125,fe=!0,Yt={"-":fe,"!":fe,"~":fe,"+":fe},We={"=":3,"+=":3,"-=":3,"&=":3,"|=":3,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,"<<":12,">>":12,">>>":12,"+":13,"-":13,"*":14,"/":14,"%":14};function D(e,t){const r=new Error(`${e} at character ${t}`);throw r.index=t,r.description=e,r}function dt(e,t){if(!(!e||!t))return{start:e.start,end:t.end}}function Xt(e){let t=0;return Object.keys(e).forEach(r=>{r.length>t&&Object.prototype.hasOwnProperty.call(e,r)&&(t=r.length)}),t}var hn=Xt(Yt),dn=Xt(We),ft={true:!0,false:!1,null:null,undefined:void 0},fn="this";function pt(e){return We[e]||0}function gt(e,t,r,n){let i;return e==="||"||e==="&&"?i="LogicalExpression":e==="="?i="Assignment":e==="+="||e==="-="||e==="&="||e==="|="?i="Modification":i="BinaryExpression",{__id:j,type:i,operator:e,left:t,right:r,location:n}}function ne(e){return e>=48&&e<=57}function De(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122}function pn(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57}function gn(e,t){return e===ye&&t===ye}function vn(e,t){const r=t?.strict??!0,n=e.charAt,i=e.charCodeAt,{length:o}=e;let s=0;const l=u=>({start:{character:u},end:{character:s}});function a(u){return n.call(e,u)}function c(u){return i.call(e,u)}function d(){const u=[];let f=!1,m=!0,S,O,N;const T=s;for(++s;s<o;){if(h(),N=c(s),N===Ne){S&&D("A key was defined but a value was not",s),s++,f=!0;break}else m?(N!==at&&N!==lt&&D("An object must start wtih a key",s),S=b(),h(),c(s)===ht?(s++,m=!1):D("A colon must follow an object key",s)):(O=v(),u.push({key:S,value:O}),h(),N=c(s),N===Re?s++:N!==Ne&&D("Please add a comma to add another key",s),m=!0,S=void 0,O=void 0);N=c(s)}return f||D("Unclosed brace in object",s),{__id:j,type:"Object",attributes:u,location:l(T)}}function h(){let u=c(s);for(;u===32||u===9;)u=c(++s)}function v(){const u=y();h();const f=s;if(s<o&&c(s)===cn){s++;const m=v();if(m||D("Expected expression",s),h(),c(s)===ht){s++;const S=v();return S||D("Expected expression",s),{__id:j,type:"ConditionalExpression",test:u,consequent:m,alternate:S,location:l(f)}}D("Expected :",s)}return u}function p(){h();let u=e.substr(s,dn),f=u.length;for(;f>0;){if(Object.prototype.hasOwnProperty.call(We,u))return s+=f,u;u=u.substr(0,--f)}return!1}function y(){let u,f,m,S=g(),O=p();if(!O)return S;let N={value:O,prec:pt(O)},T=g();T||D(`Expected expression after ${O}`,s);const V=[S,N,T];for(O=p();O&&(f=pt(O),f!==0);){for(N={value:O,prec:f};V.length>2&&f<=V[V.length-2].prec;)T=V.pop(),O=V.pop().value,S=V.pop(),u=gt(O,S,T,dt(S.location,T.location)),V.push(u);u=g(),u||D(`Expected expression after ${O}`,s),V.push(N,u),O=p()}for(m=V.length-1,u=V[m];m>1;)u=gt(V[m-1].value,V[m-2],u,dt(V[m-2].location,u.location)),m-=2;return u}function g(){h();const u=c(s),f=s;if(ne(u)||u===re)return w();if(u===at||u===lt)return b();if(De(u)||u===de)return C();if(u===xe)return M();if(gn(u,c(s+1)))return k();if(u===ye)return d();let m=e.substr(s,hn),S=m.length;for(;S>0;){if(Object.prototype.hasOwnProperty.call(Yt,m))return s+=S,{__id:j,type:"UnaryExpression",operator:m,argument:g(),prefix:!0,location:l(f)};m=m.substr(0,--S)}return!1}function w(){let u="";const f=s;for(;ne(c(s));)u+=a(s++);if(c(s)===re)for(u+=a(s++);ne(c(s));)u+=a(s++);let m=a(s);if(m==="e"||m==="E"){for(u+=a(s++),m=a(s),(m==="+"||m==="-")&&(u+=a(s++));ne(c(s));)u+=a(s++);ne(c(s-1))||D(`Expected exponent (${u}${a(s)})`,s)}const S=c(s);return De(S)?D(`Variable names cannot start with a number (${u}${a(s)})`,s):S===re&&D("Unexpected period",s),{__id:j,type:"Literal",value:parseFloat(u),raw:u,location:l(f)}}function b(){const u=a(s++);let f="",m=!1;const S=s;for(;s<o;){let O=a(s++);if(O===u){m=!0;break}if(O!=="\\"){f+=O;continue}switch(O=a(s++),O){case"n":f+=`
`;break;case"r":f+="\r";break;case"t":f+="	";break;case"b":f+="\b";break;case"f":f+="\f";break;case"v":f+="\v";break}}return m||D(`Unclosed quote after "${f}"`,s),{__id:j,type:"Literal",value:f,raw:`${u}${f}${u}`,location:l(S)}}function k(){let u="",f=!1,m=1;const S=s;for(s+=2;s<o;){const O=a(s++);if(O==="}"&&c(s)===Ne){if(s++,m--,m===0){f=!0;break}u+="}}"}else O==="{"&&c(s)===ye?(m++,u+="{{",s++):u+=O}return f||D(`Unclosed brace after "${u}"`,s),{__id:j,type:"ModelRef",ref:u,location:l(S)}}function x(){const u=s;let f=c(u);for(De(f)?s++:D(`Unexpected ${a(s)}`,s);s<o&&(f=c(s),pn(f));)s++;const m=e.slice(u,s);return Object.prototype.hasOwnProperty.call(ft,m)?{__id:j,type:"Literal",value:ft[m],raw:m,location:l(u)}:m===fn?{__id:j,type:"ThisExpression",location:l(u)}:{__id:j,type:"Identifier",name:m,location:l(u)}}function I(u){const f=[];let m,S;for(;s<o;){if(h(),m=c(s),m===u){s++;break}if(m===Re){s++;continue}S=v(),(!S||S.type==="Compound")&&D("Expected comma",s),f.push(S)}return r&&m!==u&&D(`Expected ${String.fromCharCode(u)}`,s),f}function C(){let u=c(s),f=u===de?P():x();const m=s;for(h(),u=c(s);u===re||u===xe||u===de;)s++,u===re?(h(),f={__id:j,type:"MemberExpression",computed:!1,object:f,property:x(),location:l(m)}):u===xe?(f={__id:j,type:"MemberExpression",computed:!0,object:f,property:v(),location:l(m)},h(),u=c(s),u!==ut&&D("Unclosed [",s),s++):u===de&&(f={__id:j,type:"CallExpression",args:I(ct),callTarget:f,location:l(m)}),h(),u=c(s);return f}function P(){s++;const u=v();if(h(),c(s)===ct)return s++,u;D("Unclosed (",s)}function M(){const u=s;return s++,{__id:j,type:"ArrayExpression",elements:I(ut),location:l(u)}}const B=[];try{for(;s<o;){const u=c(s);if(u===un||u===Re){s++;continue}const f=v();f?B.push(f):r&&s<o&&D(`Unexpected "${a(s)}"`,s)}return B.length===1?B[0]:{__id:j,type:"Compound",body:B,location:l(0)}}catch(u){if(r||!(u instanceof Error))throw u;return{__id:j,type:"Compound",body:B,location:l(0),error:u}}}var Jt={};Ur(Jt,{conditional:()=>Zt,deleteDataVal:()=>mn,getDataVal:()=>wn,setDataVal:()=>yn});var yn=(e,t,r)=>{e.model.set([[t,r]])},wn=(e,t)=>e.model.get(t),mn=(e,t)=>e.model.delete(t),Zt=(e,t,r,n)=>e.evaluate(t)?e.evaluate(r):n?e.evaluate(n):null;Zt.resolveParams=!1;function bn(e){return Qt(e)?!1:typeof e=="object"&&e!==null&&!Array.isArray(e)&&"value"in e}var er=(e,t,r)=>e.evaluate(t)&&e.evaluate(r);er.resolveParams=!1;var tr=(e,t,r)=>e.evaluate(t)||e.evaluate(r);tr.resolveParams=!1;var Sn={"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,"&&":er,"||":tr,"!==":(e,t)=>e!==t,"===":(e,t)=>e===t,"|":(e,t)=>e|t,"&":(e,t)=>e&t,"+=":(e,t)=>e+t,"-=":(e,t)=>e-t,"&=":(e,t)=>e&t,"|=":(e,t)=>e|t},En={"-":e=>-e,"+":e=>Number(e),"!":e=>!e},kn=class{constructor(e){this.vars={},this.hooks={resolve:new R,resolveOptions:new R,beforeEvaluate:new R,onError:new J},this.expressionsCache=new Map,this.operators={binary:new Map(Object.entries(Sn)),unary:new Map(Object.entries(En)),expressions:new Map(Object.entries(Jt))},this.defaultHookOptions={...e,evaluate:t=>this.evaluate(t,this.defaultHookOptions),resolveNode:t=>this._execAST(t,this.defaultHookOptions)},this.hooks.resolve.tap("ExpressionEvaluator",this._resolveNode.bind(this)),this.evaluate=this.evaluate.bind(this)}reset(){this.expressionsCache.clear()}evaluate(e,t){const r=this.hooks.resolveOptions.call({...this.defaultHookOptions,...t,resolveNode:i=>this._execAST(i,r)});let n=this.hooks.beforeEvaluate.call(e,r)??e;for(;bn(n);)n=n.value;return typeof n=="number"||typeof n=="boolean"||n===void 0||n===null?n:Qt(n)?this._execAST(n,r):Array.isArray(n)?n.reduce((i,o)=>this.evaluate(o,t),null):this._execString(String(n),r)}addExpressionFunction(e,t){this.operators.expressions.set(e,t)}addBinaryOperator(e,t){this.operators.binary.set(e,t)}addUnaryOperator(e,t){this.operators.unary.set(e,t)}setExpressionVariable(e,t){this.vars[e]=t}getExpressionVariable(e){return this.vars[e]}_execAST(e,t){return this.hooks.resolve.call(void 0,e,t)}_execString(e,t){if(e==="")return e;const r=e.match(/^@\[(.*)\]@$/);let n=e;r&&([,n]=Array.from(r));let i;try{i=this.expressionsCache.get(n)??vn(n,{strict:t.strict}),this.expressionsCache.set(n,i)}catch(o){if(t.throwErrors||!this.hooks.onError.call(o))throw new Z(`Error parsing expression: ${e}`,o);return}try{return this._execAST(i,t)}catch(o){if(t.throwErrors||!this.hooks.onError.call(o))throw new Z(`Error evaluating expression: ${e}`,o)}}_resolveNode(e,t,r){const{resolveNode:n,model:i}=r,o={...r,evaluate:s=>this.evaluate(s,r)};if(t.type==="Literal")return t.value;if(t.type==="Identifier")return this.vars[t.name];if(t.type==="Compound"||t.type==="ThisExpression")throw new Error(`Expression type: ${t.type} is not supported`);if(t.type==="BinaryExpression"||t.type==="LogicalExpression"){const s=this.operators.binary.get(t.operator);return s?"resolveParams"in s?s.resolveParams===!1?s(o,t.left,t.right):s(o,n(t.left),n(t.right)):s(n(t.left),n(t.right)):void 0}if(t.type==="UnaryExpression"){const s=this.operators.unary.get(t.operator);return s?"resolveParams"in s?s(o,s.resolveParams===!1?t.argument:n(t.argument)):s(n(t.argument)):void 0}if(t.type==="Object"){const{attributes:s}=t,l={};return s.forEach(a=>{const c=n(a.key),d=n(a.value);l[c]=d}),l}if(t.type==="CallExpression"){const s=t.callTarget.name,l=this.operators.expressions.get(s);if(!l)throw new Error(`Unknown expression function: ${s}`);if("resolveParams"in l&&l.resolveParams===!1)return l(o,...t.args);const a=t.args.map(c=>n(c));return l(o,...a)}if(t.type==="ModelRef")return i.get(t.ref,{context:{model:r.model}});if(t.type==="MemberExpression"){const s=n(t.object),l=n(t.property);return s[l]}if(t.type==="Assignment"){if(t.left.type==="ModelRef"){const s=n(t.right);return i.set([[t.left.ref,s]]),s}if(t.left.type==="Identifier"){const s=n(t.right);return this.vars[t.left.name]=s,s}return}if(t.type==="ConditionalExpression"){const s=n(t.test)?t.consequent:t.alternate;return n(s)}if(t.type==="ArrayExpression")return t.elements.map(s=>n(s));if(t.type==="Modification"){const s=this.operators.binary.get(t.operator);if(s){let l;return"resolveParams"in s?s.resolveParams===!1?l=s(o,t.left,t.right):l=s(o,n(t.left),n(t.right)):l=s(n(t.left),n(t.right)),t.left.type==="ModelRef"?i.set([[t.left.ref,l]]):t.left.type==="Identifier"&&(this.vars[t.left.name]=l),l}return n(t.left)}}},On=class{constructor(){this.hooks={trace:new E,debug:new E,info:new E,warn:new E,error:new E,log:new E},this.logHandlers=new Set,this.trace=this.createHandler("trace"),this.debug=this.createHandler("debug"),this.info=this.createHandler("info"),this.warn=this.createHandler("warn"),this.error=this.createHandler("error")}createHandler(e){return(...t)=>{this.hooks[e].call(t),this.hooks.log.call(e,t),this.logHandlers.forEach(r=>r[e](...t))}}addHandler(e){this.logHandlers.add(e)}removeHandler(e){this.logHandlers.delete(e)}},An=class{constructor(e){this.trace=this.createHandler("trace"),this.debug=this.createHandler("debug"),this.info=this.createHandler("info"),this.warn=this.createHandler("warn"),this.error=this.createHandler("error"),this.proxiedLoggerProvider=e}createHandler(e){return(...t)=>{this.proxiedLoggerProvider()?.[e](...t)}}},vt=e=>e;function Cn(e){const t=new Map;if(!e.ROOT)return t;const r=[{node:e.ROOT,path:[],visited:new Set}];for(;r.length>0;){const n=r.shift();if(!n)break;const{node:i,path:o,visited:s}=n;Object.entries(i).forEach(([l,a])=>{const c=[...o,l],d=c.join(".");if(t.has(d))throw new Error("Path has already been processed. There's either a loop somewhere or a bug");if(s.has(a.type))throw new Error(`Path already contained type: ${a.type}. This likely indicates a loop in the schema`);t.set(d,a),a.isArray&&c.push("[]"),a.isRecord&&c.push("{}"),a.type&&e[a.type]&&r.push({path:c,node:e[a.type],visited:new Set([...s,a.type])})})}return t}var Tn=class{constructor(e){this.formatters=new Map,this.types=new Map,this.schema=new Map,this.bindingSchemaNormalizedCache=new Map,this.hooks={resolveTypeForBinding:new R},this.schema=e?Cn(e):new Map}addFormatters(e){e.forEach(t=>{this.formatters.set(t.name,t)})}addDataTypes(e){e.forEach(t=>{this.types.set(t.type,t)})}getValidationsForBinding(e){const t=this.getApparentType(e);if(t?.validation?.length)return t.validation.map(r=>({severity:"error",trigger:"change",...r}))}normalizeBinding(e){const t=this.bindingSchemaNormalizedCache.get(e);if(t)return t;let r=e.asArray(),n=r.map(i=>typeof i=="number"?"[]":i).join(".");return n&&(this.bindingSchemaNormalizedCache.set(e,n),r=n.split(".")),r.forEach(i=>{const o=r.map(s=>s===i?"{}":s).join(".");this.schema.get(o)&&(this.bindingSchemaNormalizedCache.set(e,o),r=o.split("."),n=o)}),n}getType(e){return this.hooks.resolveTypeForBinding.call(this.schema.get(this.normalizeBinding(e)),e)}getApparentType(e){const t=this.getType(e);if(t===void 0)return;const r=this.getTypeDefinition(t?.type);return r===void 0?t:{...r,...t,validation:[...t.validation??[],...r.validation??[]]}}getTypeDefinition(e){return this.types.get(e)}getFormatterForType(e){const{type:t,...r}=e,n=this.formatters.get(t);if(n)return{format:n.format?i=>n.format?.(i,r):vt,deformat:n.deformat?i=>n.deformat?.(i,r):vt}}getFormatter(e){const t=this.getApparentType(e);if(t?.format)return this.getFormatterForType(t.format)}},L="{{",_e="}}";function Pn(e){const t=e.indexOf(L);if(t===-1)return;let r=1,n=t+L.length,i=e.substring(t+L.length);for(;r>0&&i.length>0;){const o=i.indexOf(_e);if(o===-1)break;const s=i.indexOf(L);s!==-1&&s<o?(r++,i=i.substring(s+L.length),n+=s+L.length):(r--,i=i.substring(o+_e.length),n+=o+_e.length)}if(r!==0)throw new Error(`Unbalanced {{ and }} in exp: ${e}`);return{start:t,end:n}}function Vn(e,{evaluate:t}){if(!t)return e;const r=/@\[.*?\]@/;let n=e,i=n.match(r);for(;i!==null;){const o=i[0],s=n.indexOf(o),l=o.substr(2,o.length-2-2),a=t(l);if(s===0&&o===e&&typeof a!="string")return a;n=n.substr(0,s)+a+n.substr(s+o.length),i=n.match(r)}return n}function rr(e,t){const{model:r,formatted:n=!0}=t;let i=Vn(e,t);if(!r||typeof i!="string"||i.indexOf(L)===-1)return i;for(;i.indexOf(L)!==-1;){const o=Pn(i);if(!o)return i;const{start:s,end:l}=o,a=i.substring(s+L.length,l-L.length).trim(),c=r.get(a,{formatted:n});if(s===0&&l===i.length&&typeof c!="string")return c;i=i.substr(0,s)+c+i.substr(l)}return i}function nr(e,t){switch(typeof e){case"string":return rr(e,t);case"object":{if(!e)return e;const r=Object.keys(e);let n=e;return r.length>0&&r.forEach(i=>{n=U(n,[i],nr(e[i],t))}),n}default:return e}}function Qe(e,t){return nr(e,t)}function ir(e,t){const r=new Map(e),n=t.parent(),i=t.key();return r.forEach((o,s)=>{(t===s||t.contains(s))&&r.delete(s)}),typeof i=="number"&&Array.from(e.keys()).filter(s=>{if(n.contains(s)){const[l]=s.relative(n);return typeof l=="number"&&l>i}return!1}).sort().forEach(s=>{const[l,...a]=s.relative(n);if(typeof l=="number"){const c=[l-1,...a],d=n.descendent(c);r.set(d,r.get(s)),r.delete(s)}}),r}var Mn=class{constructor(e,t){this.validator=e,this.shadowModelPaths=new Map,this.logger=t?.logger,this.shouldIncludeInvalid=t?.shouldIncludeInvalid}set(e,t,r){const n=Fe(this,{...t,includeInvalid:!0},r),i=[],o=new Set;e.forEach(([c,d])=>{this.shadowModelPaths.set(c,d),o.add(c)});const s=[];this.shadowModelPaths.forEach((c,d)=>{const h=this.validator(d,n);h===void 0?i.push([d,c]):h instanceof Set?h.forEach(v=>{s.push(v.binding),!v.isStrong&&v.binding.asString()===d.asString()&&i.push([v.binding,c])}):o.has(d)&&(s.push(d),this.logger?.debug(`Invalid value for path: ${d.asString()} - ${h.severity} - ${h.message}`))});let l=[];if(r&&i.length>0){i.forEach(([d])=>this.shadowModelPaths.delete(d));const c=r.set(i,t);if(s.length===0)return c;l=c}const a=s.map(c=>({binding:c,oldValue:n.get(c),newValue:n.get(c),force:!0}));return[...l,...a]}get(e,t,r){let n=r?.get(e,t);return(this.shouldIncludeInvalid?.(t)??t?.includeInvalid===!0)&&this.shadowModelPaths.forEach((i,o)=>{if(o===e){n=i;return}e.contains(o)&&(n=U(n,o.relative(e),i))}),n}delete(e,t,r){return this.shadowModelPaths=ir(this.shadowModelPaths,e),r?.delete(e,t)}},Rn=class{constructor(){this.registry=new Map}get(e){return this.registry.get(e)}register(e,t){this.registry.set(e,t)}};function xn(e,t){return Object.hasOwnProperty.call(e,"template")&&Array.isArray(e?.template)&&e.template.length&&e.template.find(r=>r.output===t)}function yt(e){return e==="staticSwitch"||e==="dynamicSwitch"}function sr(e){return e==="template"}function Nn(e){if(e&&"value"in e&&typeof e.value=="object"&&typeof e.value?.id=="string")return e.value.id}var Dn={type:"empty"},_n=class{constructor(){this.hooks={onParseObject:new R,onCreateASTNode:new R,parseNode:new J}}parseView(e){const t=this.parseObject(e,"view");if(!t)throw new Error("Unable to parse object into a view");return t}createASTNode(e,t){const r=this.hooks.onCreateASTNode.call(e,t);return r===void 0?e:r}parseObject(e,t="value",r={templateDepth:0}){const n=this.hooks.parseNode.call(e,t,r);if(n||n===null)return n;const i=(a,c,d=[])=>{if(typeof c!="object"||c===null)return{value:c,children:[]};const h=this.hooks.onParseObject.call(c,t);if(!h)return a;const v=Array.isArray(h)?h.map((g,w)=>[w,g]):[...Object.entries(h),...Object.getOwnPropertySymbols(h).map(g=>[g,h[g]])],p={children:[],value:a};return v.reduce((g,w)=>{let{value:b}=g;const{children:k}=g,[x,I]=w,C=this.hooks.parseNode.call(I,"value",r,{path:d,key:x,parentObj:h});if(C)k.push(...C);else if(I&&typeof I=="object"){const P=i(g.value,I,[...d,x]);b=P.value,k.push(...P.children)}else b=U(g.value,[...d,x],I);return{value:b,children:k}},p)},{value:o,children:s}=i(void 0,e),l=o===void 0&&!s.length?void 0:{type:t,value:o};if(l&&s.length){const a=l;a.children=s,s.forEach(c=>{c.value.parent=a})}return this.hooks.onCreateASTNode.call(l,e)??null}};function Le(e,t){if(!e||!t)return!0;const r=Array.from(t.values()),n=Array.from(e.values());return r.find(i=>!!n.find(o=>o===i||o.contains(i)||i.contains(o)))!==void 0}function or(e){return{...e,data:{model:e.model,formatValue:(t,r)=>e.formatValue?e.formatValue(t,r):r,format:(t,r)=>e.format?e.format(W(t)?t:e.parseBinding(t),r):r},evaluate:t=>e.evaluator.evaluate(t,e)}}var Bn=e=>({get:(t,r)=>e.get(t,{context:{model:e},...r}),set:(t,r)=>e.set(t,{context:{model:e},...r}),delete:(t,r)=>e.delete(t,{context:{model:e},...r})}),In=class{constructor(e,t){this.hooks={skipResolve:new R,beforeUpdate:new E,afterUpdate:new E,resolveOptions:new R,beforeResolve:new R,resolve:new R,afterResolve:new R,afterNodeUpdate:new E},this.root=e,this.options=t,this.resolveCache=new Map,this.ASTMap=new Map,this.logger=t.logger,this.idCache=new Set}getSourceNode(e){return this.ASTMap.get(e)}update(e){this.hooks.beforeUpdate.call(e);const t=new Map;this.idCache.clear();const r=new Map(this.ASTMap);this.ASTMap.clear();const n=this.computeTree(this.root,void 0,e,t,or(this.options),void 0,r);return this.resolveCache=t,this.hooks.afterUpdate.call(n.value),n.value}getResolveCache(){return new Map(this.resolveCache)}getPreviousResult(e){if(!e)return;const t=this.resolveCache.size===0,r=Nn(e);if(r){if(this.idCache.has(r)){t&&(e.type==="asset"||e.type==="view"?this.logger?.error(`Cache conflict: Found Asset/View nodes that have conflicting ids: ${r}, may cause cache issues.`):e.type==="value"&&this.logger?.info(`Cache conflict: Found Value nodes that have conflicting ids: ${r}, may cause cache issues. To improve performance make value node IDs globally unique.`));return}this.idCache.add(r)}return this.resolveCache.get(e)}cloneNode(e){const t=Or(e);return Object.keys(t).forEach(r=>{if(r==="parent")return;const n=t[r];typeof n=="object"&&n!==null&&(t[r]=Array.isArray(n)?[...n]:{...n})}),t}computeTree(e,t,r,n,i,o,s){const l=new nn(i.data.model);l.trackSubset("core");const a=Bn(an(l,this.options.parseBinding)),c=this.hooks.resolveOptions.call({...i,data:{...i.data,model:a},evaluate:C=>this.options.evaluator.evaluate(C,{model:a}),node:e},e),d=this.getPreviousResult(e),h=d?.dependencies,v=Le(r,h),p=this.hooks.skipResolve.call(!v,e,c),y={...this.cloneNode(e),parent:o},g=this.hooks.beforeResolve.call(y,c)??{type:"empty"},w=g.type==="multi-node"&&o?.parent?.type==="multi-node"&&o.type==="value";if(d&&p){const C={...d,updated:!1},P=(M,B,u)=>{const{node:f}=M;this.ASTMap.set(f,B);const m={...M,updated:!1};n.set(B,m);const S=O=>{const N=s.get(O)??O,T=this.getPreviousResult(N);T&&P(T,N,B)};"children"in f?f.children?.forEach(({value:O})=>S(O)):f.type==="multi-node"&&f.values.forEach(S),this.hooks.afterNodeUpdate.call(B,u,m)};return d.node.parent=o,P(d,e,t),C}g.parent=o,c.node=g,this.ASTMap.set(g,e);let b=this.hooks.resolve.call(void 0,g,c),k=!G(d?.value,b);d&&!k&&(b=d?.value);const x=new Set;if(l.trackSubset("children"),"children"in g){const C=g.children?.map(P=>{const M=this.computeTree(P.value,e,r,n,c,g,s),{dependencies:B,node:u,updated:f,value:m}=M;if(B.forEach(S=>x.add(S)),m)if(u.type==="multi-node"&&!u.override){const S=Ar(Ke(b,P.path,[]),m);b=U(b,P.path,S)}else b=U(b,P.path,m);return k=k||f,{...P,value:u}});g.children=C}else if(g.type==="multi-node"){const C=[],P=w?o?.parent:e,M=g.values.map(B=>{const u=this.computeTree(B,P,r,n,c,g,s);return u.value!==void 0&&u.value!==null&&C.push(u.value),u.dependencies.forEach(f=>x.add(f)),k=k||u.updated,u.node});g.values=M,b=C}x.forEach(C=>l.addChildReadDep(C)),l.trackSubset("core"),d&&!k&&(b=d?.value),b=this.hooks.afterResolve.call(b,g,{...c,getDependencies:C=>l.getDependencies(C)});const I={node:g,updated:k,value:b,dependencies:new Set([...l.getDependencies(),...x])};return this.hooks.afterNodeUpdate.call(e,w?o?.parent:t,I),n.set(e,I),I}},jn=class{constructor(e,t,r){this.allValidations=new Set,this.byBinding=new Map,this.logger=r,this.parse(e,t)}parse(e,t){const r=e.validation;if(r!==void 0){if(!Array.isArray(r)){this.logger?.warn(`Unable to register view validations for id: ${e.id}. 'validation' property must be an Array.`);return}r.forEach(n=>{const i={trigger:"navigation",severity:"error",...n};this.allValidations.add(i);const{ref:o}=n;if(o){const s=t(o);this.byBinding.has(s)?this.byBinding.get(s)?.push(i):this.byBinding.set(s,[i])}})}}getValidationsForBinding(e){return this.byBinding.get(e)}},$n=class{constructor(e,t){this.hooks={onUpdate:new E,parser:new E,resolver:new E,onTemplatePluginCreated:new E,templatePlugin:new E},this.initialView=e,this.resolverOptions=t,this.hooks.onTemplatePluginCreated.tap("view",r=>{this.templatePlugin=r})}updateAsync(){const e=this.resolver?.update();this.lastUpdate=e,this.hooks.onUpdate.call(e)}update(e){if(this.rootNode===void 0){this.validationProvider=new jn(this.initialView,this.resolverOptions.parseBinding,this.resolverOptions.logger),this.templatePlugin?this.hooks.templatePlugin.call(this.templatePlugin):this.resolverOptions.logger?.warn("templatePlugin not set for View, legacy templates may not work");const r=new _n;this.hooks.parser.call(r),this.rootNode=r.parseView(this.initialView),this.resolver=new In(this.rootNode,{...this.resolverOptions,parseNode:r.parseObject.bind(r)}),this.hooks.resolver.call(this.resolver)}const t=this.resolver?.update(e);return this.lastUpdate===t?this.lastUpdate:(this.lastUpdate=t,this.hooks.onUpdate.call(t),t)}getValidationsForBinding(e){return this.validationProvider?.getValidationsForBinding(e)}},Fn=class{constructor(e){this.hooks={resolveTemplateSubstitutions:new R},this.options=e}parseTemplate(e,t,r){const{template:n,depth:i}=t,o=r.data.model.get(t.data);if(!o)return null;if(!Array.isArray(o))throw new Error(`Template using '${t.data}' but is not an array`);const s=[];return o.forEach((a,c)=>{const d=this.hooks.resolveTemplateSubstitutions.call([{expression:new RegExp(`_index${i||""}_`),value:String(c)}],{depth:i,data:a,index:c});let h=JSON.stringify(n);for(const{expression:p,value:y}of d){let g="g";typeof p=="object"&&(g=`${p.flags}${p.global?"":"g"}`),h=h.replace(new RegExp(p,g),y)}const v=e(JSON.parse(h),"value",{templateDepth:t.depth+1});v&&s.push(v)}),{type:"multi-node",override:!1,values:s}}applyParser(e){e.hooks.onCreateASTNode.tap("template",t=>t&&t.type==="template"&&!t.dynamic?this.parseTemplate(e.parseObject.bind(e),t,this.options):t),e.hooks.parseNode.tap("template",(t,r,n,i)=>{if(i&&sr(i.key))return t.map(o=>{const s=e.createASTNode({type:"template",depth:n.templateDepth??0,data:o.data,template:o.value,dynamic:o.dynamic??!1},o);if(s)return s.type==="multi-node"&&s.values.forEach(l=>{l.parent=s}),{path:[...i.path,o.output],value:s}}).filter(Boolean)})}applyResolverHooks(e){e.hooks.beforeResolve.tap("template",(t,r)=>t&&t.type==="template"&&t.dynamic?this.parseTemplate(r.parseNode,t,r):t)}apply(e){e.hooks.parser.tap("template",this.applyParser.bind(this)),e.hooks.resolver.tap("template",this.applyResolverHooks.bind(this))}},ar=(e,t)=>r=>{const n=r.indexOf(e);if(n===-1)return!1;const i=r.indexOf(t);return i===-1?!1:n<i},Un=ar("{{","}}"),Ln=ar("@[","]@");function zn(e){return Un(e)||Ln(e)}function wt(e,t){return zn(e)?Qe(e,{model:t.data.model,evaluate:t.evaluate}):e}function lr(e,t,r){if(e==null||typeof e!="object"&&typeof e!="string")return e;if(typeof e=="string")return wt(e,t);let n=e;return Object.keys(e).forEach(i=>{if(r.has(i))return;const o=e[i];let s=o;typeof o=="object"?s=lr(o,t,r):typeof o=="string"&&(s=wt(o,t)),s!==o&&(n=Tr(n,i,s))}),n}var cr=(e,t)=>{const r=e.parent;if(!r)return[];if("children"in r){const n=t.getSourceNode(e);return r.children?.find(i=>i.value===n)?.path??[]}return r.type!=="multi-node"?[]:cr(r,t)},Hn=class{constructor(){this.propertiesToSkipCache=new Map}applyResolver(e){e.hooks.resolve.tap("string-resolver",(t,r,n)=>{if(r.type==="empty"||r.type==="unknown")return null;if(r.type==="value"||r.type==="asset"||r.type==="view"){let i;r.type==="asset"||r.type==="view"?(i=new Set(r.plugins?.stringResolver?.propertiesToSkip??["exp"]),r.value?.id&&this.propertiesToSkipCache.set(r.value.id,i)):r.parent?.type==="multi-node"&&(r.parent?.parent?.type==="asset"||r.parent?.parent?.type==="view")&&r.parent.parent.value?.id&&this.propertiesToSkipCache.has(r.parent.parent.value.id)?i=this.propertiesToSkipCache.get(r.parent.parent.value.id):i=new Set(["exp"]);const o=cr(r,e);return o.length>0&&o.some(s=>i.has(s.toString()))?r.value:lr(r.value,n,i)}return t})}apply(e){e.hooks.resolver.tap("string-resolver",this.applyResolver.bind(this))}},qn=class{isApplicability(e){return e&&Object.prototype.hasOwnProperty.call(e,"applicability")}applyResolver(e){e.hooks.beforeResolve.tap("applicability",(t,r)=>{let n=t;if(t?.type==="applicability"){if(r.evaluate(t.expression)===!1)return null;n=t.value}return n})}applyParser(e){e.hooks.parseNode.tap("applicability",(t,r,n,i)=>{if(this.isApplicability(t)){const o=e.parseObject(Ct(t,"applicability"),r,n);if(!o)return i?[]:null;const s=e.createASTNode({type:"applicability",expression:t.applicability,value:o},t);return s?(s.type==="applicability"&&(s.value.parent=s),i?[{path:[...i.path,i.key],value:s}]:s):i?[]:null}})}apply(e){e.hooks.resolver.tap("applicability",this.applyResolver.bind(this)),e.hooks.parser.tap("applicability",this.applyParser.bind(this))}},Kn=class{constructor(e){this.options=e}resolveSwitch(e,t){for(const r of e.cases)if(t.evaluate(r.case))return r.value;return Dn}isSwitch(e){return e&&(Object.prototype.hasOwnProperty.call(e,"dynamicSwitch")||Object.prototype.hasOwnProperty.call(e,"staticSwitch"))}applyParser(e){e.hooks.onCreateASTNode.tap("switch",t=>t&&t.type==="switch"&&!t.dynamic?this.resolveSwitch(t,this.options):t),e.hooks.parseNode.tap("switch",(t,r,n,i)=>{if(this.isSwitch(t)||i&&yt(i.key)){const o=i&&yt(i.key)?{[i.key]:t}:t,s="dynamicSwitch"in o,a=(s?o.dynamicSwitch:o.staticSwitch).map(d=>{const{case:h,...v}=d,p=e.parseObject(v,"value",n);if(p)return{case:h,value:p}}).filter(Boolean),c=e.createASTNode({type:"switch",dynamic:s,cases:a},o);if(!c||c.type==="empty")return i?[]:null;if(c.type==="switch"&&c.cases.forEach(d=>{d.value.parent=c}),i){let d=[...i.path,i.key],h=c;if(c.type==="value"&&c.children?.length===1&&c.value===void 0){const v=c.children[0];d=[...d,...v.path],h=v.value}return[{path:d,value:h}]}return c}})}applyResolver(e){e.hooks.beforeResolve.tap("switch",(t,r)=>t&&t.type==="switch"&&t.dynamic?this.resolveSwitch(t,r):t)}apply(e){e.hooks.parser.tap("switch",this.applyParser.bind(this)),e.hooks.resolver.tap("switch",this.applyResolver.bind(this))}},Gn=class{applyParser(e){e.hooks.parseNode.tap("multi-node",(t,r,n,i)=>{if(i&&!sr(i.key)&&Array.isArray(t)){const o=t.map(l=>e.parseObject(l,"value",n)).filter(l=>!!l);if(!o.length)return[];const s=e.createASTNode({type:"multi-node",override:!xn(i.parentObj,i.key),values:o},t);return s?(s.type==="multi-node"&&s.values.forEach(l=>{l.parent=s}),[{path:[...i.path,i.key],value:s}]):[]}})}apply(e){e.hooks.parser.tap("multi-node",this.applyParser.bind(this))}},Wn=class{applyParser(e){e.hooks.parseNode.tap("asset",(t,r,n,i)=>{if(i?.key==="asset"&&typeof t=="object"){const o=e.parseObject(t,"asset",n);return o?[{path:[...i.path,i.key],value:o}]:[]}})}apply(e){e.hooks.parser.tap("asset",this.applyParser.bind(this))}},Qn=class{constructor(e,t,r){this.isTransitioning=!1,this.hooks={beforeStart:new J,onStart:new E,onEnd:new E,skipTransition:new J,beforeTransition:new R,resolveTransitionNode:new R,transition:new E,afterTransition:new E},this.id=e,this.flow=t,this.log=r?.logger,this.history=[],this.hooks.transition.tap("startPromise",async(n,i)=>{const o=i.value;this.flowPromise&&o.state_type==="END"&&this.flowPromise.resolve(o)})}async start(){if(this.flowPromise)return this.log?.warn("Already called start for flow"),this.flowPromise.promise;this.flow=this.hooks.beforeStart.call(this.flow)||this.flow,this.flow.onStart&&this.hooks.onStart.call(this.flow.onStart);const e=this.flow.startState;return e?(this.flowPromise=Ht(),this.pushHistory(e),this.flowPromise.promise):Promise.reject(new Error("No 'startState' defined for flow"))}transition(e,t){if(this.isTransitioning)throw new Error(`Transitioning while ongoing transition from ${this.currentState?.name} is in progress is not supported`);if(this.currentState?.value.state_type==="END"){this.log?.warn(`Skipping transition using ${e}. Already at and END state`);return}if(this.currentState===void 0)throw new Error("Cannot transition when there's no current state");if(t?.force)this.log?.debug("Forced transition. Skipping validation checks");else if(this.hooks.skipTransition.call(this.currentState)){this.log?.debug(`Skipping transition from ${this.currentState.name} b/c hook told us to`);return}const r=this.hooks.beforeTransition.call(this.currentState.value,e);if(!("transitions"in r))throw new Error(`No transitions defined for ${this.currentState.value}`);const{transitions:n}=r,i=n[e]||n["*"];if(i===void 0){this.log?.warn(`No transition from ${this.currentState.name} using ${e} or *`);return}return this.log?.debug(`Transitioning from ${this.currentState.name} to ${i} using ${e} `),this.pushHistory(i,t)}pushHistory(e,t){if(!Object.prototype.hasOwnProperty.call(this.flow,e))throw new Error(`No flow definition for: ${e} was found.`);let r=this.flow[e];if(!this.flow[e]||typeof r!="object"||!("state_type"in r)){this.log?.error(`Flow doesn't contain any states named: ${e}`);return}const n=this.currentState;this.isTransitioning=!0,r=this.hooks.resolveTransitionNode.call(r);const i={name:e,value:r};this.currentState=i,this.history.push(e),i.value.state_type==="END"&&this.flow.onEnd&&this.hooks.onEnd.call(this.flow.onEnd),this.hooks.transition.call(n,{...i}),this.isTransitioning=!1,this.hooks.afterTransition.call(this)}},Yn=class{constructor(e,t){this.hooks={flow:new E},this.navigation=e,this.navStack=[],this.log=t?.logger,this.start=this.start.bind(this),this.run=this.run.bind(this),this.transition=this.transition.bind(this),this.addNewFlow=this.addNewFlow.bind(this)}transition(e,t){if(this.current===void 0)throw new Error("Not currently in a flow. Cannot transition.");this.current.transition(e,t)}addNewFlow(e){this.navStack.push(e),this.current=e,this.hooks.flow.call(e)}async run(e){if(!Object.prototype.hasOwnProperty.call(this.navigation,e))return Promise.reject(new Error(`No flow defined for: ${e}`));const t=this.navigation[e];if(t===null||typeof t!="object")return Promise.reject(new Error(`Flow: ${e} needs to be an object`));this.log?.debug(`Starting flow: ${e}`);const r=new Qn(e,t,{logger:this.log});this.addNewFlow(r),r.hooks.afterTransition.tap("flow-controller",i=>{if(i.currentState?.value.state_type==="FLOW"){const o=i.currentState?.value.ref;this.log?.debug(`Loading subflow ${o}`),this.run(o).then(s=>{this.log?.debug(`Subflow ended. Using outcome: ${s.outcome}`),i.transition(s?.outcome)})}});const n=await r.start();return this.navStack.pop(),this.navStack.length>0&&(this.current=this.navStack[0]),n}async start(){return this.navigation.BEGIN?this.run(this.navigation.BEGIN):Promise.reject(new Error("Must supply a BEGIN state"))}},Xn=/%([a-zA-Z]+)/g;function Jn(e,t){return e.slice().replace(Xn,r=>t[r.slice(1)]||r)}var ie="validation-binding-tracker",Zn=class{constructor(e){this.trackedBindings=new Set,this.options=e}getBindings(){return this.trackedBindings}trackBinding(e){this.trackedBindings.has(e)||(this.trackedBindings.add(e),this.options.callbacks?.onAdd?.(e))}applyResolver(e){this.trackedBindings.clear();const t=new Map,r=new Map;let n;const i=new Map;let o=new Map;const s=new Map,l=new Map;e.hooks.beforeUpdate.tap(ie,a=>{n=a}),e.hooks.skipResolve.tap(ie,(a,c)=>{const d=i.get(c);return!a||!n||!d?a:new Set([...n].filter(v=>d.has(v))).size===0}),e.hooks.resolveOptions.tap(ie,(a,c)=>{if(a.validation===void 0)return a;t.delete(c);const d=h=>{const v=W(h)?h:this.options.parseBinding(h);t.has(c)?t.get(c)?.add(v):t.set(c,new Set([v]));let{parent:p}=c;for(;p;)if(r.has(p)){r.get(p)?.add(c);break}else p=p.parent;this.trackedBindings.add(v),this.options.callbacks?.onAdd?.(v)};return{...a,validation:{...a.validation,get:(h,v)=>(v?.track&&d(h),a.validation?._getValidationForBinding(h)?.getAll(v)?.find(g=>g.displayTarget==="field"||g.displayTarget===void 0)),getValidationsForBinding(h,v){return v?.track&&d(h),a.validation?._getValidationForBinding(h)?.getAll(v)??[]},getChildren:h=>{const v=new Array;return i.get(c)?.forEach(p=>{const y=a.validation?._getValidationForBinding(p)?.get();y&&(h===void 0||h===y.displayTarget)&&v.push(y)}),v},getValidationsForSection:()=>{const h=new Array;return s.get(c)?.forEach(v=>{const p=a.validation?._getValidationForBinding(v)?.get();p&&p.displayTarget==="section"&&h.push(p)}),h},register:h=>{h?.type==="section"&&(r.has(c)||r.set(c,new Set))},track:d}}}),e.hooks.afterNodeUpdate.tap(ie,(a,c,d)=>{const{updated:h,node:v}=d;if(l.set(v,a),h){const p=new Set(t.get(a));v.type==="multi-node"&&v.values.forEach(y=>o.get(y)?.forEach(g=>p.add(g))),"children"in v&&v.children&&v.children.forEach(y=>{o.get(y.value)?.forEach(g=>p.add(g))}),o.set(v,p)}else o.set(v,i.get(a)??new Set);a===e.root&&(this.trackedBindings=new Set(o.get(v)),i.clear(),o.forEach((p,y)=>{const g=l.get(y);g&&i.set(g,p)}),s.clear(),r.forEach((p,y)=>{const g=new Set;p.forEach(w=>{t.get(w)?.forEach(g.add,g)}),s.set(y,g)}),t.clear(),r.clear(),o=new Map)})}apply(e){e.hooks.resolver.tap(ie,this.applyResolver.bind(this))}},ei="schema",ti="view",ri=Symbol.for("validation-provider-name");function ni(e,t){if(e.size>t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function ii(e){return{value:e,type:e.severity,state:"none",isBlockingNavigation:!1}}var si=class{constructor(e,t,r,n){this.applicableValidations=[],this.validationsByState={load:[],change:[],navigation:[]},this.onDismiss=t,e.forEach(i=>{const{trigger:o}=i;if(this.validationsByState[o]){const s=ii(i);this.validationsByState[o].push(s)}else r?.warn(`Unknown validation trigger: ${o}`)}),this.weakBindings=n??new Set}get allValidations(){return Object.values(this.validationsByState).flat()}checkIfBlocking(e){if(e.state==="active"){const{isBlockingNavigation:t}=e;return t}return!1}getAll(){return this.applicableValidations.reduce((e,t)=>(t.state==="active"&&t.response&&e.push({...t.response,blocking:this.checkIfBlocking(t)}),e),[])}get(){const e=this.applicableValidations.find(t=>t.state==="active"&&t.response);if(e?.state==="active")return{...e.response,blocking:this.checkIfBlocking(e)}}runApplicableValidations(e,t,r){this.applicableValidations=this.applicableValidations.map(n=>{if(n.state==="dismissed")return n;const i=n.value.blocking??(n.value.severity==="warning"&&"once"||!0),o=U(n,["value","blocking"],i),s=i===!0||i==="once"&&!t;if(r==="navigation"&&o.state==="active"&&o.value.blocking!==!0&&o.value.severity==="warning"){const c=o;return c.dismissable&&c.response.dismiss&&(c.response.blocking!=="once"||!c.response.blocking)?c.response.dismiss():(c?.response.blocking==="once"&&(c.response.blocking=!1),c.dismissable=!0),c}const l=e(o.value),a={type:o.type,value:o.value,state:l?"active":"none",isBlockingNavigation:s,dismissable:o.value.severity==="warning"&&r==="navigation",response:l?{...o.value,message:l.message??"Something is broken",severity:o.value.severity,displayTarget:o.value.displayTarget??"field"}:void 0};return a.state==="active"&&o.value.severity==="warning"&&(a.response.dismiss=()=>{a.state="dismissed",this.onDismiss?.()}),a})}update(e,t,r){const n=[];if(!(e==="load"&&this.currentPhase!==void 0)){if(this.currentPhase==="navigation"||e===this.currentPhase){this.runApplicableValidations(r,t,e);return}e==="load"?(this.currentPhase="load",this.applicableValidations=[...this.validationsByState.load]):e==="change"&&this.currentPhase==="load"?(this.currentPhase="change",this.applicableValidations=[...this.applicableValidations,...this.validationsByState.change]):e==="navigation"&&(this.currentPhase==="load"||this.currentPhase==="change")&&(this.applicableValidations.forEach(i=>{i.type==="error"&&i.state==="active"&&i.isBlockingNavigation===!1||n.push(i)}),this.applicableValidations=[...n,...this.validationsByState.navigation,...this.currentPhase==="load"?this.validationsByState.change:[]],this.currentPhase="navigation"),this.runApplicableValidations(r,t,e)}}},oi=class{constructor(e,t){this.hooks={createValidatorRegistry:new E,onAddValidation:new R,onRemoveValidation:new R,resolveValidationProviders:new R,onTrackBinding:new E},this.validations=new Map,this.weakBindingTracker=new Set,this.schema=e,this.options=t,this.reset()}setOptions(e){this.options=e}getDataMiddleware(){return[{set:(e,t,r)=>r?.set(e,t)??[],get:(e,t,r)=>r?.get(e,t),delete:(e,t,r)=>(this.validations=ir(this.validations,e),r?.delete(e,t))},new Mn(e=>{if(!this.options)return;this.updateValidationsForBinding(e,"change",this.options);const t=this.getValidationForBinding(e);if(t?.get()?.severity==="error")return t.get();const r=new Set;if(this.validations.forEach((n,i)=>{Le(new Set([e]),n.weakBindings)&&n?.get()?.severity==="error"&&n?.weakBindings.forEach(o=>{o===i?r.add({binding:o,isStrong:!0}):r.add({binding:o,isStrong:!1})})}),r.size>0)return r},{logger:new An(()=>this.options?.logger)})]}getValidationProviders(){return this.providers?this.providers:(this.providers=this.hooks.resolveValidationProviders.call([{source:ei,provider:this.schema},{source:ti,provider:{getValidationsForBinding:e=>this.viewValidationProvider?.getValidationsForBinding?.(e),getValidationsForView:()=>this.viewValidationProvider?.getValidationsForView?.()}}]),this.providers)}reset(){this.validations.clear(),this.tracker=void 0}onView(e){if(this.validations.clear(),!this.options)return;const t=new Zn({...this.options,callbacks:{onAdd:r=>{if(!this.options||this.getValidationForBinding(r)!==void 0)return;const n=this.options.model.get(r),i=this.options.model.get(r,{ignoreDefaultValue:!0});n!==i&&this.options.model.set([[r,n]],{silent:!0}),this.updateValidationsForBinding(r,"load",this.options,()=>{e.update(new Set([r]))}),this.hooks.onTrackBinding.call(r)}}});this.tracker=t,this.viewValidationProvider=e,t.apply(e)}updateValidationsForBinding(e,t,r,n){const i=r??this.options;if(!i)throw new Error("Context is required for executing validations");if(t==="load"){const s=this.getValidationProviders().reduce((l,a)=>(l.push(...a.provider.getValidationsForBinding?.(e)?.map(c=>({...c,[ri]:a.source}))??[]),l),[]);if(s.length===0)return;this.validations.set(e,new si(s,n,this.options?.logger))}this.validations.get(e)?.update(t,!0,s=>{const l=this.validationRunner(s,e,i);if(this.weakBindingTracker.size>0){const a=this.validations.get(e);this.weakBindingTracker.forEach(c=>a.weakBindings.add(c))}return l?{message:l.message}:void 0}),t!=="load"&&this.validations.forEach((s,l)=>{l!==e&&Le(new Set([e]),s.weakBindings)&&s.update(t,!0,a=>{const c=this.validationRunner(a,l,i);return c?{message:c.message}:void 0})})}validationRunner(e,t,r=this.options){if(!r)throw new Error("No context provided to validation runner");const n=e.handler??this.getValidator(e.type),i=new Set,o={get(l,a){return i.add(W(l)?t:r.parseBinding(l)),r.model.get(l,{...a,includeInvalid:!0})},set:r.model.set,delete:r.model.delete},s=n?.({...r,evaluate:(l,a={model:o})=>r.evaluate(l,a),model:o,validation:e,schemaType:this.schema.getType(t)},r.model.get(t,{includeInvalid:!0,formatted:e.dataTarget==="formatted"}),e);if(this.weakBindingTracker=i,s){let{message:l}=s;const{parameters:a}=s;return e.message&&(l=Qe(e.message,{model:o,evaluate:r.evaluate}),a&&(l=Jn(l,a))),{message:l}}}updateValidationsForView(e){const t=e==="navigation",r=this.activeBindings,n=i=>{this.getBindings().forEach(o=>{this.validations.get(o)?.update(e,i,s=>{if(this.options)return this.validationRunner(s,o,this.options)})})};if(n(!t),t){const{activeBindings:i}=this;ni(i,r)&&n(!0)}}get activeBindings(){return new Set(Array.from(this.getBindings()).filter(e=>this.validations.get(e)?.get()!==void 0))}getValidator(e){if(this.validatorRegistry)return this.validatorRegistry.get(e);const t=new Rn;return this.hooks.createValidatorRegistry.call(t),this.validatorRegistry=t,t.get(e)}getBindings(){return this.tracker?.getBindings()??new Set}trackBinding(e){this.tracker?.trackBinding(e)}validateView(e="navigation"){this.updateValidationsForView(e);const t=new Map;let r=!0;return this.getBindings().forEach(n=>{this.getValidationForBinding(n)?.getAll()?.forEach(o=>{e==="navigation"&&o.blocking&&(this.options?.logger.debug(`Validation on binding: ${n.asString()} is preventing navigation. ${JSON.stringify(o)}`),r=!1),t.has(n)||t.set(n,o)})}),{canTransition:r,validations:t.size?t:void 0}}getValidationForBinding(e){return this.validations.get(e)}forView(e){return{_getValidationForBinding:t=>this.getValidationForBinding(W(t)?t:e(t)),getAll:()=>{const t=this.getBindings();if(t.size===0)return;const r=new Map;return t.forEach(n=>{const i=this.getValidationForBinding(n)?.get();i&&r.set(n,i)}),r.size===0?void 0:r},get(){throw new Error("Error Access be provided by the view plugin")},getValidationsForBinding(){throw new Error("Error rollup should be provided by the view plugin")},getChildren(){throw new Error("Error rollup should be provided by the view plugin")},getValidationsForSection(){throw new Error("Error rollup should be provided by the view plugin")},track:()=>{throw new Error("Tracking should be provided by the view plugin")},register:()=>{throw new Error("Section functionality should be provided by the view plugin")},type:t=>this.schema.getType(W(t)?t:e(t))}}},ai=class{constructor(e){this.updateCallback=e,this.state=new Map}removeKey(e){this.state.delete(e)}reset(){this.state.clear()}useSharedState(e){return t=>(this.state.has(e)||this.state.set(e,t),[this.state.get(e),r=>{const n=this.state.get(e);this.state.set(e,r),n!==r&&this.updateCallback?.()}])}getLocalStateFunction(e,t){return r=>{this.state.has(e)||this.state.set(e,[]),this.state.has(t)||this.state.set(t,0);const n=this.state.get(e),i=this.state.get(t);return this.state.set(t,i+1),n.length<=i&&n.push(r),[n[i],s=>{const l=n[i];n[i]=s,l!==s&&this.updateCallback?.()}]}}};function ze(e,t){return e===t?!0:e.parent?ze(e.parent,t):!1}var li=class{constructor(e){this.registry=e,this.stateStore=new Map,this.beforeResolveSymbol=Symbol("before resolve"),this.resolveSymbol=Symbol("resolve"),this.beforeResolveCountSymbol=Symbol("before resolve count"),this.resolveCountSymbol=Symbol("resolve count")}apply(e){e.hooks.view.tap("asset-transform",t=>{this.stateStore.clear(),t.hooks.resolver.tap("asset-transform",r=>{let n;const i=s=>{n=s,t.update(new Set)},o=(s,l)=>{let a;const c=l===this.resolveSymbol?this.resolveCountSymbol:this.beforeResolveCountSymbol,d=this.stateStore.get(s);return d?(a=d,a.removeKey(c)):(a=new ai(()=>{i(s)}),this.stateStore.set(s,a)),{useSharedState:h=>a.useSharedState(h),useLocalState:h=>a.getLocalStateFunction(l,c)(h)}};r.hooks.beforeResolve.tap("asset-transform",(s,l)=>{if(s&&(s.type==="asset"||s.type==="view")){const a=this.registry.get(s.value);if(a?.beforeResolve){const c=o(l.node??s,this.beforeResolveSymbol);return a.beforeResolve(s,l,c)}}return s}),r.hooks.afterUpdate.tap("asset-transform",()=>{n=void 0}),r.hooks.skipResolve.tap("asset-transform",(s,l)=>{if(!s||!n)return s;const a=ze(n,l),c=ze(l,n);return!a&&!c}),r.hooks.afterResolve.tap("asset-transform",(s,l,a)=>{if(l.type!=="asset"&&l.type!=="view")return s;const c=r.getSourceNode(l);if(!c)return s;const d=this.registry.get(s);if(d?.resolve){const h=o(c,this.resolveSymbol);return d?.resolve(s,a,h)}return s})})})}},ci=class{constructor(e,t){this.hooks={resolveView:new R,view:new E},this.transformRegistry=new $r,this.optimizeUpdates=!0,this.viewOptions=t,this.viewMap=e.reduce((n,i)=>(n[i.id]=i,n),{}),new li(this.transformRegistry).apply(this),t.flowController.hooks.flow.tap("viewController",n=>{n.hooks.transition.tap("viewController",(i,o)=>{o.value.state_type==="VIEW"?this.onView(o.value):this.currentView=void 0})});const r=(n,i=!1)=>{this.currentView&&(this.optimizeUpdates?this.queueUpdate(n,i):this.currentView.update())};t.model.hooks.onUpdate.tap("viewController",(n,i)=>{r(new Set(n.map(o=>o.binding)),i?.silent??!1)}),t.model.hooks.onDelete.tap("viewController",n=>{const i=n.parent(),o=n.key();r(typeof o=="number"&&i?new Set([i]):new Set([n]))})}queueUpdate(e,t=!1){this.pendingUpdate?.changedBindings?this.pendingUpdate.changedBindings=new Set([...this.pendingUpdate.changedBindings,...e]):this.pendingUpdate={changedBindings:e,scheduled:!1},!this.pendingUpdate.scheduled&&!t&&(this.pendingUpdate.scheduled=!0,Dr(()=>{const r=this.pendingUpdate?.changedBindings;this.pendingUpdate=void 0,this.currentView?.update(r)}))}getViewForRef(e){if(this.viewMap[e])return this.viewMap[e];const t=Object.keys(this.viewMap).find(r=>e===rr(r,{model:this.viewOptions.model,evaluate:this.viewOptions.evaluator.evaluate}));if(t&&this.viewMap[t])return this.viewMap[t]}onView(e){const t=e.ref,r=this.hooks.resolveView.call(this.getViewForRef(t),t,e);if(!r)throw new Error(`No view with id ${t}`);const n=new $n(r,this.viewOptions);this.currentView=n,this.hooks.view.call(n),n.update()}},ui=class{constructor(e,t){this.controller=e,this.logger=t}get(e,t){return this.controller.get(e,t)}set(e,t){return this.logger?.error("Error: Tried to set in a read only instance of the DataController"),[]}delete(e,t){this.logger?.error("Error: Tried to delete in a read only instance of the DataController")}},hi=class{constructor(e,t){this.hooks={resolve:new R,resolveDataStages:new R,resolveDefaultValue:new J,onDelete:new E,onSet:new E,onGet:new E,onUpdate:new E,format:new R,deformat:new R,serialize:new R},this.logger=t.logger;const r=t.middleware||[];this.baseMiddleware=[new Ue(e),...r],this.trash=new Set,this.pathResolver=t.pathResolver}getModel(){if(!this.model){const e=this.hooks.resolveDataStages.call(this.baseMiddleware),t=new ln;t.setMiddleware(e),this.model=t}return this.model}resolveDataValue(e,t,r){return r?this.hooks.deformat.call(t,e):t}set(e,t){let r=[];Array.isArray(e)?r=e.map(([s,l])=>{const a=this.pathResolver.parse(s);return[a,this.resolveDataValue(a,l,!!t?.formatted)]}):r=Object.keys(e).map(s=>{const l=this.pathResolver.parse(s),a=e[s];return[l,this.resolveDataValue(l,a,!!t?.formatted)]});const n=r.reduce((s,[l,a])=>{const c=this.get(l,{includeInvalid:!0}),d={binding:l,newValue:a,oldValue:c};return G(c,a)?this.logger?.debug(`Skipping update for path: ${l.asString()}. Value was unchanged: ${c}`):(s.push(d),this.logger?.debug(`Setting path: ${l.asString()} from: ${c} to: ${a}`)),s},[]),i=this.getModel().set(r,t),o=new Set(n.map(s=>s.binding));return i.forEach(s=>{!o.has(s.binding)&&(s.force===!0||!G(s.oldValue,s.newValue))&&(this.logger?.debug(`Path: ${s.binding.asString()} was changed from: ${s.oldValue} to: ${s.newValue}`),n.push(s))}),this.hooks.onSet.call(r),n.length>0&&this.hooks.onUpdate.call(n,t),i}resolve(e,t){return Array.isArray(e)||typeof e=="string"?this.pathResolver.parse(e,{readOnly:t}):e}get(e,t){const r=e instanceof Q?e:this.resolve(e,!0);let n=this.getModel().get(r,t);if(n===void 0&&!t?.ignoreDefaultValue){const i=this.hooks.resolveDefaultValue.call(r);i!==n&&(n=i)}return t?.formatted?n=this.hooks.format.call(n,r):t?.formatted===!1&&(n=this.hooks.deformat.call(n,r)),this.hooks.onGet.call(e,n),n}delete(e,t){if(typeof e!="string"&&!Array.isArray(e)&&!(e instanceof Q))throw new Error("Invalid arguments: delete expects a data path (string)");const r=e instanceof Q?e:this.resolve(e,!1),n=r.parent(),i=r.key(),o=this.get(n),s=typeof o=="object"&&o!==null&&Object.prototype.hasOwnProperty.call(o,i);this.getModel().delete(r,t),s&&!this.get(r)&&this.trash.add(r),this.hooks.onDelete.call(r)}serialize(){return this.hooks.serialize.call(this.get(""))}makeReadOnly(){return new ui(this,this.logger)}};function ur(e,t=[],r="."){return Object.keys(e).reduce((n,i)=>({...n,...Object.prototype.toString.call(e[i])==="[object Object]"?ur(e[i],t.concat([i])):{[t.concat([i]).join(r)]:e[i]}}),{})}function mt(e){const t=ur(e),r=[];return Object.keys(t).forEach(n=>{r.push([new Q(n),t[n]])}),r}var di=class{constructor(){this.store=new Map,this.tempStore=new Map}addConstants(e,t){this.store.has(t)?this.store.get(t)?.set(mt(e)):this.store.set(t,new Ue(e))}getConstants(e,t,r){const n=new Q(e);return this.tempStore.get(t)?.get(n)??this.store.get(t)?.get(n)??r}setTemporaryValues(e,t){this.tempStore.has(t)?this.tempStore.get(t)?.set(mt(e)):this.tempStore.set(t,new Ue(e))}clearTemporaryValues(e){e?this.tempStore.get(e)?.reset():this.tempStore.forEach(t=>{t.reset()})}},fi=class{constructor(){this.name="flow-exp-plugin"}apply(e){let t;const r=n=>{n&&(typeof n=="object"&&"exp"in n?t?.evaluate(n.exp):t?.evaluate(n))};e.hooks.expressionEvaluator.tap(this.name,n=>{t=n}),e.hooks.flowController.tap(this.name,n=>{n.hooks.flow.tap(this.name,i=>{i.hooks.onStart.tap(this.name,o=>r(o)),i.hooks.onEnd.tap(this.name,o=>r(o)),i.hooks.resolveTransitionNode.intercept({call:o=>{o?.onStart&&r(o.onStart)}})})})}},pi=e=>(r,n,i)=>e.getFormatterForType({type:i})?.format(n)??n,gi=class{constructor(){this.name="flow-exp-plugin"}apply(e){let t;e.hooks.schema.tap(this.name,r=>{t=pi(r)}),e.hooks.expressionEvaluator.tap(this.name,r=>{t&&r.addExpressionFunction("format",t),r.addExpressionFunction("log",(n,...i)=>{e.logger.info(...i)}),r.addExpressionFunction("debug",(n,...i)=>{e.logger.debug(...i)}),r.addExpressionFunction("eval",(n,...i)=>n.evaluate(...i))})}},vi={ref:Symbol("not-started"),status:"not-started"},yi=class{constructor(){this.name="default-view-plugin"}apply(e){e.hooks.viewController.tap(this.name,t=>{t.hooks.view.tap(this.name,r=>{const n=or(r.resolverOptions);new Wn().apply(r),new Kn(n).apply(r),new qn().apply(r),new Hn().apply(r);const i=new Fn(n);i.apply(r),r.hooks.onTemplatePluginCreated.call(i),new Gn().apply(r)})})}},wi="__VERSION__",mi="__GIT_COMMIT__",hr=class He{constructor(t){this.logger=new On,this.constantsController=new di,this.state=vi,this.hooks={flowController:new E,viewController:new E,view:new E,expressionEvaluator:new E,dataController:new E,schema:new E,validationController:new E,bindingParser:new E,state:new E,onStart:new E,onEnd:new E,resolveFlowContent:new R},t?.logger&&this.logger.addHandler(t.logger),this.config=t||{},this.config.plugins=[new gi,new yi,...this.config.plugins||[],new fi],this.config.plugins?.forEach(r=>{r.apply(this)})}getPlugins(){return this.config.plugins??[]}findPlugin(t){return this.config.plugins?.find(r=>r.symbol===t)}applyTo(t,r){const n=this.findPlugin(t);n&&r(n)}registerPlugin(t){t.apply(this),this.config.plugins?.push(t)}getVersion(){return He.info.version}getCommit(){return He.info.commit}getState(){return this.state}setState(t){this.state=t,this.hooks.state.call(t)}setupFlow(t){const r=this.hooks.resolveFlowContent.call(t),n=new Yn(r.navigation,{logger:this.logger});this.hooks.onStart.call(r),this.hooks.flowController.call(n);let i,o;const s=new tn({get:p=>o.get(p),set:p=>o.set(p),evaluate:p=>i.evaluate(p)});this.hooks.bindingParser.call(s);const l=s.parse,a=Ht(),c=new Tn(r.schema);this.hooks.schema.call(c);const d=new oi(c);this.hooks.validationController.call(d),o=new hi(r.data,{pathResolver:s,middleware:d.getDataMiddleware(),logger:this.logger}),o.hooks.format.tap("player",(p,y)=>{const g=c.getFormatter(y);return g?g.format(p):p}),o.hooks.deformat.tap("player",(p,y)=>{const g=c.getFormatter(y);return g?g.deformat(p):p}),o.hooks.resolveDefaultValue.tap("player",p=>c.getApparentType(p)?.default);let h;i=new kn({model:o,logger:this.logger}),this.hooks.expressionEvaluator.call(i),i.hooks.onError.tap("player",p=>(a.reject(p),!0));function v(p,y){return Qe(p,{model:o,evaluate:i.evaluate,formatted:y})}return n.hooks.flow.tap("player",p=>{p.hooks.beforeTransition.tap("player",(y,g)=>{const w=y.transitions[g]?g:"*";return y.onEnd&&y.transitions[w]&&(typeof y.onEnd=="object"&&"exp"in y.onEnd?i?.evaluate(y.onEnd.exp):i?.evaluate(y.onEnd)),!("transitions"in y)||!y.transitions[w]?y:U(y,["transitions",w],v(y.transitions[w]))}),p.hooks.skipTransition.tap("validation",y=>{if(y?.value.state_type==="VIEW"){const{canTransition:g,validations:w}=d.validateView("navigation");if(!g&&w){const b=new Set(w.keys());return h?.currentView?.update(b),!0}}}),p.hooks.resolveTransitionNode.tap("player",y=>{let g=y;return"ref"in y&&(g=U(y,["ref"],v(y.ref))),"param"in y&&(g=U(y,["param"],v(y.param,!1))),g}),p.hooks.transition.tap("player",(y,g)=>{g.value.state_type!=="VIEW"&&d.reset()}),p.hooks.afterTransition.tap("player",y=>{const g=y.currentState?.value;if(g&&g.state_type==="ACTION"){const{exp:w}=g;n?.transition(String(i?.evaluate(w)))}i.reset()})}),this.hooks.dataController.call(o),d.setOptions({parseBinding:l,model:o,logger:this.logger,evaluate:i.evaluate,constants:this.constantsController}),h=new ci(r.views||[],{evaluator:i,parseBinding:l,transition:n.transition,model:o,utils:{findPlugin:p=>this.findPlugin(p)},logger:this.logger,flowController:n,schema:c,format:(p,y)=>{const g=c.getFormatter(p);return g?.format?g.format(y):y},formatValue:(p,y)=>{const g=c.getFormatterForType(p);return g?.format?g.format(y):y},validation:{...d.forView(l),type:p=>c.getType(l(p))},constants:this.constantsController}),h.hooks.view.tap("player",p=>{d.onView(p),this.hooks.view.call(p)}),this.hooks.viewController.call(h),{start:()=>{n.start().then(p=>({endState:v(p,!1),data:o.serialize()})).then(a.resolve).catch(p=>{throw this.logger.error(`Something went wrong: ${p.message}`),p}).catch(a.reject).finally(()=>this.hooks.onEnd.call())},state:{status:"in-progress",flowResult:a.promise,controllers:{data:o,view:h,flow:n,schema:c,expression:i,binding:s,validation:d},fail:a.reject,flow:r,logger:this.logger}}}async start(t){const r=Symbol(t?.id??"payload"),n=i=>this.state.ref!==r?(this.logger.warn("Received update for a flow that's not the current one"),i):(this.setState(i),i);this.setState({status:"not-started",ref:r});try{const{state:i,start:o}=this.setupFlow(t);this.setState({ref:r,...i}),o();const s={ref:r,status:"completed",flow:i.flow,controllers:{data:i.controllers.data.makeReadOnly()}};return n({...await i.flowResult,...s})}catch(i){throw n({status:"error",ref:r,flow:t,error:i}),i}}};hr.info={version:wi,commit:mi};var Ps=hr;function bi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function St(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bt(Object(r),!0).forEach(function(n){bi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Si(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function Ei(e,t){if(e==null)return{};var r=Si(e,t),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ki(e,t){return Oi(e)||Ai(e,t)||Ci(e,t)||Ti()}function Oi(e){if(Array.isArray(e))return e}function Ai(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,i=!1,o=void 0;try{for(var s=e[Symbol.iterator](),l;!(n=(l=s.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(a){i=!0,o=a}finally{try{!n&&s.return!=null&&s.return()}finally{if(i)throw o}}return r}}function Ci(e,t){if(e){if(typeof e=="string")return Et(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Et(e,t)}}function Et(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ti(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ot(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kt(Object(r),!0).forEach(function(n){Pi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vi(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(i,o){return o(i)},n)}}function se(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.length>=e.length?e.apply(this,i):function(){for(var s=arguments.length,l=new Array(s),a=0;a<s;a++)l[a]=arguments[a];return t.apply(r,[].concat(i,l))}}}function we(e){return{}.toString.call(e).includes("Object")}function Mi(e){return!Object.keys(e).length}function le(e){return typeof e=="function"}function Ri(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function xi(e,t){return we(t)||q("changeType"),Object.keys(t).some(function(r){return!Ri(e,r)})&&q("changeField"),t}function Ni(e){le(e)||q("selectorType")}function Di(e){le(e)||we(e)||q("handlerType"),we(e)&&Object.values(e).some(function(t){return!le(t)})&&q("handlersType")}function _i(e){e||q("initialIsRequired"),we(e)||q("initialType"),Mi(e)&&q("initialContent")}function Bi(e,t){throw new Error(e[t]||e.default)}var Ii={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},q=se(Bi)(Ii),pe={changes:xi,selector:Ni,handler:Di,initial:_i};function ji(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pe.initial(e),pe.handler(t);var r={current:e},n=se(Ui)(r,t),i=se(Fi)(r),o=se(pe.changes)(e),s=se($i)(r);function l(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(d){return d};return pe.selector(c),c(r.current)}function a(c){Vi(n,i,o,s)(c)}return[l,a]}function $i(e,t){return le(t)?t(e.current):t}function Fi(e,t){return e.current=Ot(Ot({},e.current),t),t}function Ui(e,t,r){return le(t)?t(e.current):Object.keys(r).forEach(function(n){var i;return(i=t[n])===null||i===void 0?void 0:i.call(t,e.current[n])}),r}var Li={create:ji},zi={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}};function Hi(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return i.length>=e.length?e.apply(this,i):function(){for(var s=arguments.length,l=new Array(s),a=0;a<s;a++)l[a]=arguments[a];return t.apply(r,[].concat(i,l))}}}function qi(e){return{}.toString.call(e).includes("Object")}function Ki(e){return e||At("configIsRequired"),qi(e)||At("configType"),e.urls?(Gi(),{paths:{vs:e.urls.monacoBase}}):e}function Gi(){console.warn(dr.deprecation)}function Wi(e,t){throw new Error(e[t]||e.default)}var dr={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},At=Hi(Wi)(dr),Qi={config:Ki},Yi=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(i){return r.reduceRight(function(o,s){return s(o)},i)}};function fr(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],fr(e[r],t[r]))}),St(St({},e),t)}var Xi={type:"cancelation",msg:"operation is manually canceled"};function Be(e){var t=!1,r=new Promise(function(n,i){e.then(function(o){return t?i(Xi):n(o)}),e.catch(i)});return r.cancel=function(){return t=!0},r}var Ji=Li.create({config:zi,isInitialized:!1,resolve:null,reject:null,monaco:null}),pr=ki(Ji,2),ce=pr[0],ke=pr[1];function Zi(e){var t=Qi.config(e),r=t.monaco,n=Ei(t,["monaco"]);ke(function(i){return{config:fr(i.config,n),monaco:r}})}function es(){var e=ce(function(t){var r=t.monaco,n=t.isInitialized,i=t.resolve;return{monaco:r,isInitialized:n,resolve:i}});if(!e.isInitialized){if(ke({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Be(Ie);if(window.monaco&&window.monaco.editor)return gr(window.monaco),e.resolve(window.monaco),Be(Ie);Yi(ts,ns)(is)}return Be(Ie)}function ts(e){return document.body.appendChild(e)}function rs(e){var t=document.createElement("script");return e&&(t.src=e),t}function ns(e){var t=ce(function(n){var i=n.config,o=n.reject;return{config:i,reject:o}}),r=rs("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function is(){var e=ce(function(r){var n=r.config,i=r.resolve,o=r.reject;return{config:n,resolve:i,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){gr(r),e.resolve(r)},function(r){e.reject(r)})}function gr(e){ce().monaco||ke({monaco:e})}function ss(){return ce(function(e){var t=e.monaco;return t})}var Ie=new Promise(function(e,t){return ke({resolve:e,reject:t})}),vr={config:Zi,init:es,__getMonacoInstance:ss},os={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},je=os,as={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},ls=as;function cs({children:e}){return X.createElement("div",{style:ls.container},e)}var us=cs,hs=us;function ds({width:e,height:t,isEditorReady:r,loading:n,_ref:i,className:o,wrapperProps:s}){return X.createElement("section",{style:{...je.wrapper,width:e,height:t},...s},!r&&X.createElement(hs,null,n),X.createElement("div",{ref:i,style:{...je.fullWidth,...!r&&je.hide},className:o}))}var fs=ds,yr=A.memo(fs);function ps(e){A.useEffect(e,[])}var wr=ps;function gs(e,t,r=!0){let n=A.useRef(!0);A.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var F=gs;function oe(){}function Y(e,t,r,n){return vs(e,n)||ys(e,t,r,n)}function vs(e,t){return e.editor.getModel(mr(e,t))}function ys(e,t,r,n){return e.editor.createModel(t,r,n?mr(e,n):void 0)}function mr(e,t){return e.Uri.parse(t)}function ws({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:i,originalModelPath:o,modifiedModelPath:s,keepCurrentOriginalModel:l=!1,keepCurrentModifiedModel:a=!1,theme:c="light",loading:d="Loading...",options:h={},height:v="100%",width:p="100%",className:y,wrapperProps:g={},beforeMount:w=oe,onMount:b=oe}){let[k,x]=A.useState(!1),[I,C]=A.useState(!0),P=A.useRef(null),M=A.useRef(null),B=A.useRef(null),u=A.useRef(b),f=A.useRef(w),m=A.useRef(!1);wr(()=>{let T=vr.init();return T.then(V=>(M.current=V)&&C(!1)).catch(V=>V?.type!=="cancelation"&&console.error("Monaco initialization: error:",V)),()=>P.current?N():T.cancel()}),F(()=>{if(P.current&&M.current){let T=P.current.getOriginalEditor(),V=Y(M.current,e||"",n||r||"text",o||"");V!==T.getModel()&&T.setModel(V)}},[o],k),F(()=>{if(P.current&&M.current){let T=P.current.getModifiedEditor(),V=Y(M.current,t||"",i||r||"text",s||"");V!==T.getModel()&&T.setModel(V)}},[s],k),F(()=>{let T=P.current.getModifiedEditor();T.getOption(M.current.editor.EditorOption.readOnly)?T.setValue(t||""):t!==T.getValue()&&(T.executeEdits("",[{range:T.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),T.pushUndoStop())},[t],k),F(()=>{P.current?.getModel()?.original.setValue(e||"")},[e],k),F(()=>{let{original:T,modified:V}=P.current.getModel();M.current.editor.setModelLanguage(T,n||r||"text"),M.current.editor.setModelLanguage(V,i||r||"text")},[r,n,i],k),F(()=>{M.current?.editor.setTheme(c)},[c],k),F(()=>{P.current?.updateOptions(h)},[h],k);let S=A.useCallback(()=>{if(!M.current)return;f.current(M.current);let T=Y(M.current,e||"",n||r||"text",o||""),V=Y(M.current,t||"",i||r||"text",s||"");P.current?.setModel({original:T,modified:V})},[r,t,i,e,n,o,s]),O=A.useCallback(()=>{!m.current&&B.current&&(P.current=M.current.editor.createDiffEditor(B.current,{automaticLayout:!0,...h}),S(),M.current?.editor.setTheme(c),x(!0),m.current=!0)},[h,c,S]);A.useEffect(()=>{k&&u.current(P.current,M.current)},[k]),A.useEffect(()=>{!I&&!k&&O()},[I,k,O]);function N(){let T=P.current?.getModel();l||T?.original?.dispose(),a||T?.modified?.dispose(),P.current?.dispose()}return X.createElement(yr,{width:p,height:v,isEditorReady:k,loading:d,_ref:B,className:y,wrapperProps:g})}var ms=ws;A.memo(ms);function bs(e){let t=A.useRef();return A.useEffect(()=>{t.current=e},[e]),t.current}var Ss=bs,ge=new Map;function Es({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:i,path:o,theme:s="light",line:l,loading:a="Loading...",options:c={},overrideServices:d={},saveViewState:h=!0,keepCurrentModel:v=!1,width:p="100%",height:y="100%",className:g,wrapperProps:w={},beforeMount:b=oe,onMount:k=oe,onChange:x,onValidate:I=oe}){let[C,P]=A.useState(!1),[M,B]=A.useState(!0),u=A.useRef(null),f=A.useRef(null),m=A.useRef(null),S=A.useRef(k),O=A.useRef(b),N=A.useRef(),T=A.useRef(n),V=Ss(o),Ye=A.useRef(!1),Oe=A.useRef(!1);wr(()=>{let $=vr.init();return $.then(H=>(u.current=H)&&B(!1)).catch(H=>H?.type!=="cancelation"&&console.error("Monaco initialization: error:",H)),()=>f.current?br():$.cancel()}),F(()=>{let $=Y(u.current,e||n||"",t||i||"",o||r||"");$!==f.current?.getModel()&&(h&&ge.set(V,f.current?.saveViewState()),f.current?.setModel($),h&&f.current?.restoreViewState(ge.get(o)))},[o],C),F(()=>{f.current?.updateOptions(c)},[c],C),F(()=>{!f.current||n===void 0||(f.current.getOption(u.current.editor.EditorOption.readOnly)?f.current.setValue(n):n!==f.current.getValue()&&(Oe.current=!0,f.current.executeEdits("",[{range:f.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),f.current.pushUndoStop(),Oe.current=!1))},[n],C),F(()=>{let $=f.current?.getModel();$&&i&&u.current?.editor.setModelLanguage($,i)},[i],C),F(()=>{l!==void 0&&f.current?.revealLine(l)},[l],C),F(()=>{u.current?.editor.setTheme(s)},[s],C);let Xe=A.useCallback(()=>{if(!(!m.current||!u.current)&&!Ye.current){O.current(u.current);let $=o||r,H=Y(u.current,n||e||"",t||i||"",$||"");f.current=u.current?.editor.create(m.current,{model:H,automaticLayout:!0,...c},d),h&&f.current.restoreViewState(ge.get($)),u.current.editor.setTheme(s),l!==void 0&&f.current.revealLine(l),P(!0),Ye.current=!0}},[e,t,r,n,i,o,c,d,h,s,l]);A.useEffect(()=>{C&&S.current(f.current,u.current)},[C]),A.useEffect(()=>{!M&&!C&&Xe()},[M,C,Xe]),T.current=n,A.useEffect(()=>{C&&x&&(N.current?.dispose(),N.current=f.current?.onDidChangeModelContent($=>{Oe.current||x(f.current.getValue(),$)}))},[C,x]),A.useEffect(()=>{if(C){let $=u.current.editor.onDidChangeMarkers(H=>{let Ae=f.current.getModel()?.uri;if(Ae&&H.find(Ce=>Ce.path===Ae.path)){let Ce=u.current.editor.getModelMarkers({resource:Ae});I?.(Ce)}});return()=>{$?.dispose()}}return()=>{}},[C,I]);function br(){N.current?.dispose(),v?h&&ge.set(o,f.current.saveViewState()):f.current.getModel()?.dispose(),f.current.dispose()}return X.createElement(yr,{width:p,height:y,isEditorReady:C,loading:a,_ref:m,className:g,wrapperProps:w})}var ks=Es,Vs=A.memo(ks);export{Ts as A,tn as B,kn as E,Ue as L,Gn as M,_n as P,$r as R,R as S,Fn as T,E as a,Cs as b,Vs as c,G as d,Tn as e,Wn as f,qn as g,Kn as h,As as i,Ps as j,vr as l,Qe as r,an as w};
