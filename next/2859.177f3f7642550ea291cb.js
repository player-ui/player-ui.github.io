"use strict";(self.webpackChunk_player_ui_docs=self.webpackChunk_player_ui_docs||[]).push([[2859],{83190:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>h});var a=t(52112);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(t),d=i,h=u["".concat(l,".").concat(d)]||u[d]||g[d]||r;return t?a.createElement(h,o(o({ref:n},p),{},{components:t})):a.createElement(h,o({ref:n},p))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},52859:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});t(52112);var a=t(83190),i=t(4478);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},r.apply(this,arguments)}const o={},s=(0,i.A)({title:"SwiftUIPendingTransactionPlugin",platform:"ios",tableOfContents:[{text:"SwiftUIPendingTransactionPlugin",id:"swiftuipendingtransactionplugin",level:1},{text:"CocoaPods",id:"cocoapods",level:3},{text:"The Issue:",id:"the-issue",level:2},{text:"The Solution:",id:"the-solution",level:2}]});function l(e){let{components:n,...t}=e;return(0,a.yg)(s,r({},o,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"swiftuipendingtransactionplugin"},(0,a.yg)("a",{parentName:"h1",href:"#swiftuipendingtransactionplugin"},"SwiftUIPendingTransactionPlugin")),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"SwiftUIPendingTransactionPlugin")," allows you to register pending transactions (callbacks) in the userInfo on the decoder. Users can decide when to register, commit and clear transactions based on the use case. Anytime there is a scenario where we want a native transaction to happen while a view update is taking place, we can make use of this plugin. Below is an example used in the sample app where we can see this take place:"),(0,a.yg)("h3",{id:"cocoapods"},(0,a.yg)("a",{parentName:"h3",href:"#cocoapods"},"CocoaPods")),(0,a.yg)("p",null,"Add the subspec to your ",(0,a.yg)("inlineCode",{parentName:"p"},"Podfile")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-ruby"},"pod 'PlayerUI/SwiftUIPendingTransactionPlugin'\n")),(0,a.yg)("h2",{id:"the-issue"},(0,a.yg)("a",{parentName:"h2",href:"#the-issue"},(0,a.yg)("strong",{parentName:"a"},"The Issue:"))),(0,a.yg)("p",null,"When you enter text on input and then click on an action to try to navigate (which triggers a view update), the text gets wiped out and only saves you hit enter or click on another input field."),(0,a.yg)("h2",{id:"the-solution"},(0,a.yg)("a",{parentName:"h2",href:"#the-solution"},(0,a.yg)("strong",{parentName:"a"},"The Solution:"))),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 1:")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"SwiftUIPendingTransactionPlugin")," takes a generic T that represents the namespace of the ",(0,a.yg)("inlineCode",{parentName:"p"},"TransactionContext")),(0,a.yg)("p",null,"Declare a new object for keeping track of the namespaces or use the default struct ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhases")," for adding Phases"),(0,a.yg)("p",null,"If you use the default ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhases")," the plugin can be defined like ",(0,a.yg)("inlineCode",{parentName:"p"},"SwiftUIPendingTransactionPlugin<PendingTransactionPhases>()")," or using the typealias ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhasesPlugin()"),"\nOtherwise pass the new object in the generics on plugin initialization"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 2:")),(0,a.yg)("p",null,"If you use the default ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhases"),":"),(0,a.yg)("p",null,"Give a name to represent the phase of the transaction which you are keeping track of, for the example we will call the phase “input”.\nAdd the new phase via the ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhases")," extension"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},'extension PendingTransactionPhases {\n    public static let input = PendingTransactionPhases(rawValue: "input")\n}\n')),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"If you don't want to use the default, one option is an enum which can show all your groups of transactions under one place\nenum AlternativePhases: String, Identifiable {\n    var id: Self { self }\n    case action\n    case input\n    case ...\n}\n")),(0,a.yg)("p",null,"If you use the default ",(0,a.yg)("inlineCode",{parentName:"p"},"PendingTransactionPhases"),": the transactionContext environment variable is already provided:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"@Environment(\\.transactionContext) private var transactionContext\n")),(0,a.yg)("p",null,"Otherwise create a new environment variable with a different keypath:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"/// EnvironmentKey for setting a `TransactionContextAlternativeKey`\ninternal struct TransactionContextAlternativeKey: EnvironmentKey {\n    /// Default value for this key\n    public static let defaultValue: TransactionContext<AlternativePhases> = .init()\n}\n\n/// EnvironmentValue for `TransactionContextAlternative` for the `SwiftUIPendingTransactionPlugin`\npublic extension EnvironmentValues {\n    /// The `TransactionContext` if it exists in the environment\n    var transactionContextAlternative: TransactionContext<AlternativePhases> {\n        get { self[TransactionContextAlternativeKey.self] }\n        set { self[TransactionContextAlternativeKey.self] = newValue }\n    }\n}\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 3:")),(0,a.yg)("p",null,"To start registering transactions with the assets, access the transactionContext through the default environment variable above or the new one you created"),(0,a.yg)("p",null,"Register the transaction with the “input” phase (the view update) when a user starts editing the input,  (code snippet taken from ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/player-ui/player/blob/main/ios/packages/reference-assets/Sources/SwiftUI/InputAsset.swift"},"InputAsset")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"onEditingChanged: { editing in\n    guard !editing else {\n        // register the transaction once editing begins\n        transactionContext?.register(.input) {\n            self.model.set()\n        }\n        return\n    }\n\n    self.model.set()\n    // remove the transaction once editing ends\n    transactionContext?.clear(.input)\n}\n\n")),(0,a.yg)("p",null,"Note: we can register multiple transactions under a single phase and we commit based on phase, when commiting a phase if multiple transactions exist they commit in no particular order"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 4:")),(0,a.yg)("p",null,"Commit the transaction (view update) before the action to navigate takes place. The WrappedFunction provides access to the userInfo where the TransactionContext is stored and users can use this how they see fit."),(0,a.yg)("p",null,"Now in the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/player-ui/player/blob/main/ios/packages/reference-assets/Sources/SwiftUI/ActionAsset.swift"},"ActionAsset")," instead of calling WrappedFunction ",(0,a.yg)("inlineCode",{parentName:"p"},"run")," directly, we can extend the WrappedFunction and create another function called commitCallbacksThenCall which does the same thing as the normal call function except it will check for any input callbacks and commit then if they exist."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"extension WrappedFunction {\n    ///  commits the pendingTransactionContext callbacks before running the wrapped function\n    public func commitCallbacksThenCall(_ args: Any...) {\n        let pendingTransactions = userInfo?[.pendingTransactionContext] as? TransactionContext\n        pendingTransactions?.commit(.input)\n\n        guard let jsValue = rawValue else { return }\n        jsValue.call(withArguments: args)\n    }\n}\n")),(0,a.yg)("p",null,"Calling the new function inside of the action handler:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-swift"},"model.data.run?.commitCallbacksThenCall()\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 5:")),(0,a.yg)("p",null,"Remove the registered transaction with the “input” phase once editing ended (as seen in the code snippet from step 1) because at this point callback has already been committed."),(0,a.yg)("hr",null),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://github.dev/player-ui/player/blob/main/docs/site/pages/plugins/swiftui-pending-transaction.mdx"},"Help to improve this page")))}l.isMDXComponent=!0},4478:(e,n,t)=>{t.d(n,{A:()=>T});var a=t(52112),i=t(95055),r=t(69724),o=t(83190),s=t(31021),l=t(4323),c=t(377),p=t(11716),u=t(34787),g=t(38484),d=t(52947),h=t(39325),m=t(13516),f="chakra-skip-nav";function y(e){return{userSelect:"none",border:"0",height:"1px",width:"1px",margin:"-1px",padding:"0",outline:"0",overflow:"hidden",position:"absolute",clip:"rect(0 0 0 0)",...e,_focus:{clip:"auto",width:"auto",height:"auto",...e._focus}}}var w=(0,u.R)((function(e,n){const t=(0,g.Vl)("SkipLink",e),{id:a=f,...i}=(0,d.MN)(e);return(0,m.jsx)(h.B.a,{...i,ref:n,href:`#${a}`,__css:y(t)})}));w.displayName="SkipNavLink";var v=(0,u.R)((function(e,n){const{id:t=f,...a}=e;return(0,m.jsx)(h.B.div,{ref:n,id:t,tabIndex:-1,style:{outline:0},...a})}));v.displayName="SkipNavContent";var b=t(11049),x=t(51856);const C=e=>a.createElement(l.az,{display:{base:"none",xl:"block"}},"Table Of Contents",a.createElement(c._J,{spacing:1,ml:"0",mt:"4",styleType:"none"},e.tableOfContents?.map((e=>a.createElement("li",{key:e.text},a.createElement("a",{href:`#${e.id}`},e.text)))))),P=e=>{const{bannerExpanded:n}=a.useContext(b.BR),t="72px",r=`calc(100vh - 88px - ${n?t:"0px"})`,o=`calc(100vh - 88px - 105px - ${n?t:"0px"})`;return a.createElement(l.az,{minH:"100vh"},a.createElement(w,null,"Skip to Main Content"),a.createElement(i.s,{flexDir:"column",padding:"2"},a.createElement(x.IS,null),a.createElement(p.c,null),a.createElement(i.s,null,a.createElement(l.az,{as:"main",w:"100%",mx:"auto"},a.createElement(l.az,{display:{md:"flex"}},a.createElement(l.az,{display:{base:"none",md:"block"},overflow:"auto",maxH:r,pr:"8",ml:"4"},a.createElement(x.E1,null)),a.createElement(l.az,{flex:"1",minW:"0",overflow:"auto",maxH:r},a.createElement(l.az,{minH:o},a.createElement(v,null),e.children),a.createElement(l.az,{pt:"20"},a.createElement(x.wi,null))),e.tableOfContents&&a.createElement(C,{tableOfContents:e.tableOfContents}))))))};function T(e){return e=>a.createElement(P,null,a.createElement(i.s,{alignItems:"center"},a.createElement(r.m,{maxW:"container.lg"},a.createElement(o.xA,{components:s.Ul},e.children))))}}}]);
//# sourceMappingURL=2859.177f3f7642550ea291cb.js.map