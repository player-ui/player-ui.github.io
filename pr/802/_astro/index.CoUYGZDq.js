import{g as Ze,c as gr,r as R,R as oe}from"./index.YTOF1_EJ.js";function vr(e,t){return Array.isArray(t)?t.includes(e):t===e}function ne(e,t,r){return e.context?e.callback(r,...t):e.callback(...t)}class wr{constructor(){this.interceptions=[],this.interceptionKeySet=new Set}isUsed(){return this.interceptions.length>0}intercept(t){this.interceptions.push(t),Object.keys(t).forEach(r=>{this.interceptionKeySet.add(r)})}tap(t){this.interceptionKeySet.has("tap")&&this.interceptions.forEach(r=>{var n;(n=r.tap)==null||n.call(r,t)})}call(t,...r){this.interceptionKeySet.has("call")&&this.interceptions.forEach(n=>{var i,s;n.context?(i=n.call)==null||i.call(n,t,...r):(s=n.call)==null||s.call(n,...r)})}loop(...t){this.interceptionKeySet.has("loop")&&this.interceptions.forEach(r=>{var n;(n=r.loop)==null||n.call(r,...t)})}error(t){if(this.interceptionKeySet.has("error")&&t instanceof Error){const r=t;this.interceptions.forEach(n=>{var i;(i=n.error)==null||i.call(n,r)})}}result(t){this.interceptionKeySet.has("result")&&this.interceptions.forEach(r=>{var n;(n=r.result)==null||n.call(r,t)})}done(){this.interceptionKeySet.has("done")&&this.interceptions.forEach(t=>{var r;(r=t.done)==null||r.call(t)})}}class ie{constructor(){this.taps=[],this.interceptions=new wr}tap(t,r){const n=typeof t=="string"?{name:t,context:!1}:{context:!1,...t},s={key:Symbol(n.name),...n,callback:r};if(s.before){let o=this.taps.length;const l=new Set(Array.isArray(s.before)?s.before:[s.before]);for(o;o>0&&l.size>0;o--){const a=this.taps[o-1];if(l.has(a.name)&&l.delete(a.name),a.before&&vr(s.name,a.before))break}this.taps.splice(o,0,s)}else this.taps.push(s);return this.interceptions.tap(s),s}untap(t){this.taps=this.taps.filter(r=>r.key!==t.key)}isUsed(){return this.taps.length>0||this.interceptions.isUsed()}intercept(t){this.interceptions.intercept(t)}}class P extends ie{call(...t){if(!this.isUsed())return;const r={};this.interceptions.call(r,...t);try{this.taps.forEach(n=>{ne(n,t,r)})}catch(n){throw this.interceptions.error(n),n}this.interceptions.done()}}class re extends ie{call(...t){if(!this.isUsed())return;const r={};this.interceptions.call(r,...t);for(let n=0;n<this.taps.length;n+=1){const i=ne(this.taps[n],t,r);if(i!==void 0)return this.interceptions.result(i),i}this.interceptions.done()}}class j extends ie{call(...t){const r={};this.interceptions.call(r,...t);let[n,...i]=t;for(let s=0;s<this.taps.length;s+=1){const o=ne(this.taps[s],[n,...i],r);o!==void 0&&(n=o)}return this.interceptions.result(n),n}}class ks extends ie{async call(...t){const r={};this.interceptions.call(r,...t),await Promise.allSettled(this.taps.map(n=>ne(n,t,r))),this.interceptions.done()}}class As extends ie{async call(...t){const r={};this.interceptions.call(r,...t);try{for(let n=0;n<this.taps.length;n+=1)await ne(this.taps[n],t,r)}catch(n){throw this.interceptions.error(n),n}this.interceptions.done()}}class Os extends ie{async call(...t){const r={};this.interceptions.call(r,...t);try{for(let n=0;n<this.taps.length;n+=1){const i=await ne(this.taps[n],t,r);if(i!==void 0)return this.interceptions.result(i),i}}catch(n){throw this.interceptions.error(n),n}this.interceptions.done()}}class Cs extends ie{async call(...t){let[r,...n]=t;const i={};this.interceptions.call(i,...t);try{for(let s=0;s<this.taps.length;s+=1){const o=await ne(this.taps[s],[r,...n],i);o!==void 0&&(r=o)}}catch(s){throw this.interceptions.error(s),s}return this.interceptions.result(r),r}}var X={},it;function yr(){if(it)return X;it=1,Object.defineProperty(X,"__esModule",{value:!0}),X.toError=X.NestedError=void 0;class e extends Error{constructor(n,...i){super(n);const s=e.getErrorReport(this);if(i.length===1){const l=t(i[0]);this.innerErrors=[l];const a=e.getErrorReport(l);this.stack=`${s}

======= INNER ERROR =======

${a}`;return}this.innerErrors=i.map(l=>t(l));const o=this.innerErrors.map((l,a)=>{const c=e.getErrorReport(l);return`======= INNER ERROR (${a+1} of ${i.length}) =======

${c}`}).join(`

`);this.stack=`${s}

${o}`}get innerError(){return this.innerErrors.length===0?null:this.innerErrors[0]}static rethrow(n){return(...i)=>{throw new this(n,...i)}}}X.NestedError=e,e.getErrorReport=typeof new Error().stack=="string"?r=>r.stack:r=>`${r.name}: ${r.message}`,e.prototype.name="NestedError";function t(r){try{return r instanceof Error?r:new Error(`Value that is not an instance of Error was thrown: ${r}`)}catch{return new Error("Failed to stringify non-instance of Error that was thrown.This is possibly due to the fact that toString() method of the valuedoesn't return a primitive value.")}}return X.toError=t,X}var fe=yr();function et(e,t,r,n,i){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:i;return e===i?r:e}var B={},st;function mr(){if(st)return B;st=1,Object.defineProperty(B,"__esModule",{value:!0}),B.clone=i,B.addLast=o,B.addFirst=l,B.removeLast=a,B.removeFirst=c,B.insert=f,B.removeAt=d,B.replaceAt=m,B.getIn=C,B.set=S,B.setIn=y,B.update=E,B.updateIn=O,B.merge=x,B.mergeDeep=_,B.mergeIn=N,B.omit=T,B.addDefaults=V,B.default=void 0;/*!
 * Timm
 *
 * Immutability helpers with fast reads and acceptable writes.
 *
 * @copyright Guillermo Grau Panea 2016
 * @license MIT
 */const e="INVALID_ARGS";function t(u){throw new Error(u)}function r(u){const p=Object.keys(u);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(u)):p}const n={}.hasOwnProperty;function i(u){if(Array.isArray(u))return u.slice();const p=u,w=r(p),k={};for(let b=0;b<w.length;b++){const A=w[b];k[A]=p[A]}return k}function s(u){return u!=null&&typeof u=="object"}function o(u,p){return Array.isArray(p)?u.concat(p):u.concat([p])}function l(u,p){return Array.isArray(p)?p.concat(u):[p].concat(u)}function a(u){return u.length?u.slice(0,u.length-1):u}function c(u){return u.length?u.slice(1):u}function f(u,p,w){return u.slice(0,p).concat(Array.isArray(w)?w:[w]).concat(u.slice(p))}function d(u,p){return p>=u.length||p<0?u:u.slice(0,p).concat(u.slice(p+1))}function m(u,p,w){if(u[p]===w)return u;const k=u.length,b=Array(k);for(let A=0;A<k;A++)b[A]=u[A];return b[p]=w,b}function C(u,p){if(Array.isArray(p)||t(e),u==null)return;let w=u;for(let k=0;k<p.length;k++){const b=p[k];if(w=w?.[b],w===void 0)return w}return w}function S(u,p,w){let k=u;if(k==null&&(k=typeof p=="number"?[]:{}),k[p]===w)return k;const b=i(k);return b[p]=w,b}function y(u,p,w){return p.length?v(u,p,w,0):w}function v(u,p,w,k){let b;const A=p[k];if(k===p.length-1)b=w;else{const I=s(u)&&s(u[A])?u[A]:typeof p[k+1]=="number"?[]:{};b=v(I,p,w,k+1)}return S(u,A,b)}function E(u,p,w){const k=u?.[p],b=w(k);return S(u,p,b)}function O(u,p,w){const k=C(u,p),b=w(k);return y(u,p,b)}function x(u,p,w,k,b,A,...I){return I.length?D.call(null,!1,!1,u,p,w,k,b,A,...I):D(!1,!1,u,p,w,k,b,A)}function _(u,p,w,k,b,A,...I){return I.length?D.call(null,!1,!0,u,p,w,k,b,A,...I):D(!1,!0,u,p,w,k,b,A)}function N(u,p,w,k,b,A,I,...H){let W=C(u,p);W==null&&(W={});let Q;return H.length?Q=D.call(null,!1,!1,W,w,k,b,A,I,...H):Q=D(!1,!1,W,w,k,b,A,I),y(u,p,Q)}function T(u,p){const w=Array.isArray(p)?p:[p];let k=!1;for(let I=0;I<w.length;I++)if(n.call(u,w[I])){k=!0;break}if(!k)return u;const b={},A=r(u);for(let I=0;I<A.length;I++){const H=A[I];w.indexOf(H)>=0||(b[H]=u[H])}return b}function V(u,p,w,k,b,A,...I){return I.length?D.call(null,!0,!1,u,p,w,k,b,A,...I):D(!0,!1,u,p,w,k,b,A)}function D(u,p,w,...k){let b=w;b==null&&t(e);let A=!1;for(let I=0;I<k.length;I++){const H=k[I];if(H==null)continue;const W=r(H);if(W.length)for(let Q=0;Q<=W.length;Q++){const $=W[Q];if(u&&b[$]!==void 0)continue;let z=H[$];p&&s(b[$])&&s(z)&&(z=D(u,p,b[$],z)),!(z===void 0||z===b[$])&&(A||(A=!0,b=i(b)),b[$]=z)}}return b}var g={clone:i,addLast:o,addFirst:l,removeLast:a,removeFirst:c,insert:f,removeAt:d,replaceAt:m,getIn:C,set:S,setIn:y,update:E,updateIn:O,merge:x,mergeDeep:_,mergeIn:N,omit:T,addDefaults:V};return B.default=g,B}var U=mr(),ot=Object.prototype.hasOwnProperty;function at(e,t,r){for(r of e.keys())if(Z(r,t))return r}function Z(e,t){var r,n,i;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&Z(e[n],t[n]););return n===-1}if(r===Set){if(e.size!==t.size)return!1;for(n of e)if(i=n,i&&typeof i=="object"&&(i=at(t,i),!i)||!t.has(i))return!1;return!0}if(r===Map){if(e.size!==t.size)return!1;for(n of e)if(i=n[0],i&&typeof i=="object"&&(i=at(t,i),!i)||!Z(n[1],t.get(i)))return!1;return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return n===-1}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(ot.call(e,r)&&++n&&!ot.call(t,r)||!(r in t)||!Z(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}var Te,lt;function br(){return lt||(lt=1,Te=()=>{const t={};return t.promise=new Promise((r,n)=>{t.resolve=r,t.reject=n}),t}),Te}var Sr=br();const _t=Ze(Sr);/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Re,ct;function Er(){if(ct)return Re;ct=1;let e;return Re=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:gr):t=>(e||(e=Promise.resolve())).then(t).catch(r=>setTimeout(()=>{throw r},0)),Re}var kr=Er();const $t=Ze(kr);var Ve={exports:{}},ut;function Ar(){return ut||(ut=1,function(e){var t=function(){var r=n({constructor:function(s,o){this.array=[],this.compare=o||i;for(var l=s.length,a=0;a<l;)this.insert(s[a++])},insert:function(s){for(var o=this.array,l=this.compare,a=o.length-1,c=0,f=-1,d,m;a>=c;)if(d=(a+c)/2>>>0,m=l(o[d],s),m<0)c=d+1;else if(m>0)a=d-1;else{f=d;break}for(f===-1&&(f=a),f++,a=o.length-1;f<a&&l(s,o[f])===0;)f++;for(d=o.length,o.push(s);d>f;)o[d]=o[--d];return o[f]=s,this},search:function(s){for(var o=this.array,l=this.compare,a=o.length-1,c=0,f,d;a>=c;)if(f=(a+c)/2>>>0,d=l(o[f],s),d<0)c=f+1;else if(d>0)a=f-1;else return f;return-1},remove:function(s){var o=this.search(s);return o>=0&&this.array.splice(o,1),this}});return r.comparing=function(s,o){return new r(o,function(l,a){return i(l[s],a[s])})},r;function n(s){var o=s.constructor;return o.prototype=s,o}function i(s,o){return s<o?-1:s>o?1:0}}();e.exports=t}(Ve)),Ve.exports}var Or=Ar();const Cr=Ze(Or);function Ft(e,t=[],r=new Map){for(const n of Object.keys(e)){const i=e[n],s=[...t,n];typeof i=="object"?Ft(i,s,r):r.set(s,i)}return r}function Pr(e){const t=Ft(e),r=n=>{for(const i of Array.from(t)){const[s,o]=i;if(et(n,s)!==o)return!1}return!0};return r.count=t.size,r}function Tr(e){const t=r=>e===r;return t.count=1,t}var ht=()=>new Cr([],e=>e.matcher.count),Rr=class{constructor(e){this.store=ht(),e?.forEach(([t,r])=>{this.set(t,r)})}set(e,t){const r=typeof e=="object"?Pr(e):Tr(e);this.store.insert({key:e,value:t,matcher:r})}get(e){for(const t of this.store.array)if(t.matcher(e))return t.value}forEach(e){for(const t of this.store.array)e(t)}clear(){this.store=ht()}isRegistryEmpty(){return this.store.array.length===0}},Vr=Object.defineProperty,Mr=(e,t)=>{for(var r in t)Vr(e,r,{get:t[r],enumerable:!0})},ge=e=>({name:"Value",value:e}),xr=e=>({name:"Expression",value:e}),Nr=e=>({name:"PathNode",path:e}),Dr=(e,t)=>({name:"Query",key:e,value:t}),Ir=e=>e.length===1?e[0]:{name:"Concatenated",value:e},jr=".",Me="{",xe="}",ft="[",Br="]",dt="=",ve="'",Ne='"',we="`",pt=e=>{if(!e)return!1;const t=e.charCodeAt(0);return!(t===32||t===34||t===39||t===40||t===41||t===42||t===46||t===61||t===91||t===93||t===96||t===123||t===125)},_r=e=>{let t=1,r=e.charAt(0);const n=v=>{if(v&&r!==v)throw new Error(`Expected char: ${v} but got: ${r}`);return r=e.charAt(t),t+=1,r},i=()=>{for(;r===" ";)n()},s=(v=!1)=>{if(!pt(r))return;let E=r;for(;n()&&pt(r);)E+=r;if(v){if(E==="true")return ge(!0);if(E==="false")return ge(!1)}if(E){const O=Number(E);return E=isNaN(O)?E:O,ge(E)}},o=()=>{if(r===we){n(we);let v=r;for(;n()&&r!==we;)v+=r;if(n(we),v)return xr(v)}},l=v=>{if(!r?.match(v))return;let E=r;for(;n()&&r?.match(v);)E+=r;if(E)return ge(E)},a=()=>{if(r===Me){n(Me),n(Me);const v=y();return n(xe),n(xe),v}},c=(v=!1)=>a()??o()??s(v),f=()=>{const v=[];let E=c();for(;E!==void 0;)v.push(E),E=c();if(v.length!==0)return Ir(v)},d=(v=!1)=>{if(i(),r===ve||r===Ne){const E=r===ve;n(E?ve:Ne);const O=l(/[^'"]+/);return n(E?ve:Ne),O}return c(v)},m=()=>{if(r!==dt)return!1;for(;r===dt;)n();return!0},C=()=>{if(r===ft){n(ft),i();let v=d();if(v){if(i(),m()){i();const E=d(!0);v=Dr(v,E),i()}}else throw new Error("Expected identifier");return v&&n(Br),v}},S=()=>{const v=[],E=f();if(E){v.push(E);let O=C();if(O?.name==="Value"){const x=Number(O.value);O.value=isNaN(x)||String(x)!==O.value?O.value:x}for(;O!==void 0;)v.push(O),O=C()}return v},y=()=>{const v=[];let E=S();for(;E!==void 0&&(v.push(...E),!(!r||r===xe));){if(E.length===0&&r)throw new Error(`Unexpected character: ${r}`);n(jr),E=S()}return Nr(v)};try{return{status:!0,path:y()}}catch(v){return{status:!1,error:v.message}}};function ee(e){return!(typeof e=="string"||Array.isArray(e))}function $r(e){const t=parseInt(e,10);return isNaN(t)?e:t}function Fr(e){return Array.isArray(e)?e:typeof e=="string"?e.split("."):e.asArray()}function Ur(e,t,r){return e.findIndex(n=>n&&typeof n=="object"?n[t]==r:!1)}var te=class Ut{constructor(t,r=n=>new Ut(n)){const n=Array.isArray(t)?t:t.split(".");this.split=n.map(i=>{if(typeof i=="number")return i;const s=Number(i);return isNaN(s)||String(s)!==i?i:s}),Object.freeze(this.split),this.joined=this.split.join("."),this.factory=r}asArray(){return this.split}asString(){return this.joined}contains(t){const r=t.asArray();if(r.length<this.split.length)return!1;for(let n=0;n<this.split.length;n++)if(this.split[n]!==r[n])return!1;return!0}relative(t){return this.asArray().slice(t.asArray().length)}parent(){return this.factory(this.split.slice(0,-1))}key(){return this.split[this.split.length-1]}descendent(t){const r=Fr(t);return this.factory(this.split.concat(r))}};function Lt(e,t,r){const n={updates:{},path:[]};function i(l){if(l.name==="Value")return l.value;if(l.name==="PathNode"){const a=Lt(l,t);a.updates&&(n.updates={...n.updates,...a.updates});try{return t.convertToPath(t.getValue(a.path))}catch(c){throw new fe.NestedError(`Unable to resolve path segment: ${a.path}`,c)}}if(l.name==="Expression")try{const a=t.evaluate(l.value);return t.convertToPath(a)}catch(a){throw new fe.NestedError(`Unable to resolve path: ${l.value}`,a)}throw new Error(`Unable to resolve value for node: ${l.name}`)}function s(l){typeof l=="string"&&l.indexOf(".")>-1?l.split(".").forEach(a=>{n.path.push($r(a))}):n.path.push(l)}function o(l){const a=r?.beforeResolveNode.call(l,{...n,...t})??l;switch(a.name){case"Expression":case"PathNode":s(i(a));break;case"Value":s(typeof a.value=="boolean"?String(a.value):a.value);break;case"Query":{const c=t.getValue(n.path)??[],{key:f,value:d}=a,m=i(f),C=d&&i(d),S=Ur(c,m,C);S===void 0||S===-1?(n.updates[[...n.path,c.length,m].join(".")]=C,n.path.push(c.length)):n.path.push(S);break}case"Concatenated":n.path.push(a.value.map(i).join(""));break;default:throw new Error(`Unsupported node type: ${a.name}`)}}return e.path.forEach(o),{path:n.path,updates:Object.keys(n.updates??{}).length>0?n.updates:void 0}}var Lr=/[\s()*=`{}'"[\]]/,zr=/^[^.]+(\..+)*$/,Hr={get:()=>{throw new Error("Not Implemented")},set:()=>{throw new Error("Not Implemented")},evaluate:()=>{throw new Error("Not Implemented")}},qr=class{constructor(e){this.hooks={skipOptimization:new re,beforeResolveNode:new j},this.parserOptions={...Hr,...e},this.cache={},this.parseCache={},this.parse=this.parse.bind(this)}normalizePath(e,t){if(!Lr.test(e)&&zr.test(e)&&this.hooks.skipOptimization.call(e)!==!0)return{path:e.split("."),updates:void 0};const r=this.parseCache[e]??_r(e);if(this.parseCache[e]=r,typeof r!="object"||!r?.status)throw new TypeError(`Cannot normalize path "${e}": ${r?.error??"Unknown Error."}`);try{return Lt(r.path,t,this.hooks)}catch(n){throw new fe.NestedError(`Cannot resolve binding: ${e}`,n)}}getBindingForNormalizedResult(e){const t=e.path.join(".");if(this.cache[t])return this.cache[t];const r=new te(t===""?[]:e.path,this.parse);return this.cache[t]=r,r}parse(e,t={}){if(ee(e))return e;const r={...this.parserOptions,...t};let n={};const i=Array.isArray(e)?e.join("."):String(e),s={getValue:a=>{const c=this.normalizePath(a.join("."),s);return r.get(this.getBindingForNormalizedResult(c))},evaluate:a=>r.evaluate(a),convertToPath:a=>{if(a===void 0)throw new Error("Attempted to convert undefined value to binding path");if(typeof a!="string"&&typeof a!="number"&&typeof a!="boolean")throw new Error(`Attempting to convert ${typeof a} to a binding path.`);const c=this.normalizePath(String(a),s);c.updates&&(n={...n,...c.updates});const f=c.path.join(".");if(f==="")throw new Error("Nested path resolved to an empty path");return f}},o=this.normalizePath(i,s);o.updates&&(n={...n,...o.updates});const l=Object.keys(n);if(!r.readOnly&&l.length>0){const a=l.map(c=>[this.parse(c),n[c]]);r.set(a)}return this.getBindingForNormalizedResult(o)}},Wr=class{constructor(){this.readDeps=new Set,this.writeDeps=new Set,this.namedDependencySets={},this.namedSet="core",this.createSubset("core"),this.createSubset("children")}createSubset(e,t=!1){(t||!this.namedDependencySets[e])&&(this.namedDependencySets[e]={readDeps:new Set,writeDeps:new Set})}getDependencies(e){return e!==void 0?this.namedDependencySets?.[e]?.readDeps??new Set:this.readDeps}trackSubset(e){this.createSubset(e),this.namedSet=e}trackDefault(){this.namedSet="core"}getModified(e){return e!==void 0?this.namedDependencySets?.[e]?.writeDeps??new Set:this.writeDeps}readsBinding(e){return this.readDeps.has(e)}writesBinding(e){return this.writeDeps.has(e)}reset(){this.readDeps=new Set,this.writeDeps=new Set,this.namedDependencySets={},this.namedSet="core",this.createSubset("core",!0),this.createSubset("children",!0)}addReadDep(e,t=this.namedSet){t&&this.namedDependencySets?.[t]?.readDeps.add(e),this.readDeps.add(e)}addWriteDep(e,t=this.namedSet){t&&this.namedDependencySets?.[t]?.writeDeps.add(e),this.writeDeps.add(e)}addChildReadDep(e){this.addReadDep(e,"children")}},Kr=class extends Wr{constructor(e){super(),this.rootModel=e,this.set=this.set.bind(this),this.get=this.get.bind(this)}set(e,t){return e.forEach(([r])=>this.addWriteDep(r)),this.rootModel.set(e,t)}get(e,t){return this.addReadDep(e),this.rootModel.get(e,t)}delete(e,t){return this.addWriteDep(e),this.rootModel.delete(e,t)}},Gr=class{get(){}set(){return[]}delete(){}},gt=new Gr,Qr=new te([]);function Yr(e,t){function r(n,i){const s=ee(n)?n:t(n,{get:e.get,set:e.set,readOnly:i});if(!s)throw new Error("Unable to parse binding");return s}return{get(n,i){return e.get(r(n,!0),i)},set(n,i){return e.set(n.map(([s,o])=>[r(s,!1),o]),i)},delete(n,i){return e.delete(r(n,!1),i)}}}function He(e,t,r){return r?{get:(n,i)=>{const s=i??t;return e.get?e.get(n,s,r):r?.get(n,s)},set:(n,i)=>{const s=i??t;return e.set?e.set(n,s,r):r?.set(n,s)},delete:(n,i)=>{const s=i??t;return e.delete?e.delete(n,s,r):r?.delete(n,s)}}:e}function De(e){if(e.length===0)return gt;if(e.length===1)return He(e[0]);function t(r){return e.reduce((i,s)=>He(s,r,i),void 0)??gt}return{get:(r,n)=>t(n)?.get(r,n),set:(r,n)=>t(n)?.set(r,n),delete:(r,n)=>t(n)?.delete(r,n)}}var Jr=class{constructor(e=[]){this.hooks={onSet:new P},this.pipeline=e,this.effectiveDataModel=De(this.pipeline)}setMiddleware(e){this.pipeline=e,this.effectiveDataModel=De(e)}addMiddleware(e){this.pipeline=[...this.pipeline,e],this.effectiveDataModel=De(this.pipeline)}reset(e={}){this.pipeline.forEach(t=>{"reset"in t&&t.reset?.()}),this.set([[Qr,e]])}set(e,t){const r=this.effectiveDataModel.set(e,t);return this.hooks.onSet.call(e),r}get(e,t){return this.effectiveDataModel.get(e,t)}delete(e,t){return this.effectiveDataModel.delete(e,t)}},qe=class{constructor(e={}){this.model=e,this.get=this.get.bind(this),this.set=this.set.bind(this)}reset(e={}){this.model=e}get(e){return!e||!e.asString()?this.model:et(this.model,e.asArray())}set(e){const t=[];return e.forEach(([r,n])=>{const i=this.get(r);this.model=U.setIn(this.model,r.asArray(),n),t.push({binding:r,oldValue:i,newValue:n})}),t}delete(e){const t=e.parent();if(t){const r=this.get(t);r!==void 0&&(Array.isArray(r)?this.model=U.setIn(this.model,t.asArray(),U.removeAt(r,e.key())):this.model=U.setIn(this.model,t.asArray(),U.omit(r,e.key())))}}},L=Symbol("Expression Node ID");function zt(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)&&e.__id===L}var ae=46,Ie=44,vt=39,wt=34,ye=40,yt=41,je=91,mt=93,Xr=63,Zr=59,bt=58,Ee=123,Be=125,me=!0,Ht={"-":me,"!":me,"~":me,"+":me},tt={"=":3,"+=":3,"-=":3,"&=":3,"|=":3,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,"<<":12,">>":12,">>>":12,"+":13,"-":13,"*":14,"/":14,"%":14};function F(e,t){const r=new Error(`${e} at character ${t}`);throw r.index=t,r.description=e,r}function St(e,t){if(!(!e||!t))return{start:e.start,end:t.end}}function qt(e){let t=0;return Object.keys(e).forEach(r=>{r.length>t&&Object.prototype.hasOwnProperty.call(e,r)&&(t=r.length)}),t}var en=qt(Ht),tn=qt(tt),Et={true:!0,false:!1,null:null,undefined:void 0},rn="this";function kt(e){return tt[e]||0}function At(e,t,r,n){let i;return e==="||"||e==="&&"?i="LogicalExpression":e==="="?i="Assignment":e==="+="||e==="-="||e==="&="||e==="|="?i="Modification":i="BinaryExpression",{__id:L,type:i,operator:e,left:t,right:r,location:n}}function le(e){return e>=48&&e<=57}function _e(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122}function nn(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57}function sn(e,t){return e===Ee&&t===Ee}function on(e,t){const r=t?.strict??!0,n=e.charAt,i=e.charCodeAt,{length:s}=e;let o=0;const l=h=>({start:{character:h},end:{character:o}});function a(h){return n.call(e,h)}function c(h){return i.call(e,h)}function f(){const h=[];let g=!1,u=!0,p,w,k;const b=o;for(++o;o<s;){if(d(),k=c(o),k===Be){p&&F("A key was defined but a value was not",o),o++,g=!0;break}else u?(k!==vt&&k!==wt&&F("An object must start wtih a key",o),p=E(),d(),c(o)===bt?(o++,u=!1):F("A colon must follow an object key",o)):(w=m(),h.push({key:p,value:w}),d(),k=c(o),k===Ie?o++:k!==Be&&F("Please add a comma to add another key",o),u=!0,p=void 0,w=void 0);k=c(o)}return g||F("Unclosed brace in object",o),{__id:L,type:"Object",attributes:h,location:l(b)}}function d(){let h=c(o);for(;h===32||h===9;)h=c(++o)}function m(){const h=S();d();const g=o;if(o<s&&c(o)===Xr){o++;const u=m();if(u||F("Expected expression",o),d(),c(o)===bt){o++;const p=m();return p||F("Expected expression",o),{__id:L,type:"ConditionalExpression",test:h,consequent:u,alternate:p,location:l(g)}}F("Expected :",o)}return h}function C(){d();let h=e.substr(o,tn),g=h.length;for(;g>0;){if(Object.prototype.hasOwnProperty.call(tt,h))return o+=g,h;h=h.substr(0,--g)}return!1}function S(){let h,g,u,p=y(),w=C();if(!w)return p;let k={value:w,prec:kt(w)},b=y();b||F(`Expected expression after ${w}`,o);const A=[p,k,b];for(w=C();w&&(g=kt(w),g!==0);){for(k={value:w,prec:g};A.length>2&&g<=A[A.length-2].prec;)b=A.pop(),w=A.pop().value,p=A.pop(),h=At(w,p,b,St(p.location,b.location)),A.push(h);h=y(),h||F(`Expected expression after ${w}`,o),A.push(k,h),w=C()}for(u=A.length-1,h=A[u];u>1;)h=At(A[u-1].value,A[u-2],h,St(A[u-2].location,h.location)),u-=2;return h}function y(){d();const h=c(o),g=o;if(le(h)||h===ae)return v();if(h===vt||h===wt)return E();if(_e(h)||h===ye)return N();if(h===je)return V();if(sn(h,c(o+1)))return O();if(h===Ee)return f();let u=e.substr(o,en),p=u.length;for(;p>0;){if(Object.prototype.hasOwnProperty.call(Ht,u))return o+=p,{__id:L,type:"UnaryExpression",operator:u,argument:y(),prefix:!0,location:l(g)};u=u.substr(0,--p)}return!1}function v(){let h="";const g=o;for(;le(c(o));)h+=a(o++);if(c(o)===ae)for(h+=a(o++);le(c(o));)h+=a(o++);let u=a(o);if(u==="e"||u==="E"){for(h+=a(o++),u=a(o),(u==="+"||u==="-")&&(h+=a(o++));le(c(o));)h+=a(o++);le(c(o-1))||F(`Expected exponent (${h}${a(o)})`,o)}const p=c(o);return _e(p)?F(`Variable names cannot start with a number (${h}${a(o)})`,o):p===ae&&F("Unexpected period",o),{__id:L,type:"Literal",value:parseFloat(h),raw:h,location:l(g)}}function E(){const h=a(o++);let g="",u=!1;const p=o;for(;o<s;){let w=a(o++);if(w===h){u=!0;break}if(w!=="\\"){g+=w;continue}switch(w=a(o++),w){case"n":g+=`
`;break;case"r":g+="\r";break;case"t":g+="	";break;case"b":g+="\b";break;case"f":g+="\f";break;case"v":g+="\v";break}}return u||F(`Unclosed quote after "${g}"`,o),{__id:L,type:"Literal",value:g,raw:`${h}${g}${h}`,location:l(p)}}function O(){let h="",g=!1,u=1;const p=o;for(o+=2;o<s;){const w=a(o++);if(w==="}"&&c(o)===Be){if(o++,u--,u===0){g=!0;break}h+="}}"}else w==="{"&&c(o)===Ee?(u++,h+="{{",o++):h+=w}return g||F(`Unclosed brace after "${h}"`,o),{__id:L,type:"ModelRef",ref:h,location:l(p)}}function x(){const h=o;let g=c(h);for(_e(g)?o++:F(`Unexpected ${a(o)}`,o);o<s&&(g=c(o),nn(g));)o++;const u=e.slice(h,o);return Object.prototype.hasOwnProperty.call(Et,u)?{__id:L,type:"Literal",value:Et[u],raw:u,location:l(h)}:u===rn?{__id:L,type:"ThisExpression",location:l(h)}:{__id:L,type:"Identifier",name:u,location:l(h)}}function _(h){const g=[];let u,p;for(;o<s;){if(d(),u=c(o),u===h){o++;break}if(u===Ie){o++;continue}p=m(),(!p||p.type==="Compound")&&F("Expected comma",o),g.push(p)}return r&&u!==h&&F(`Expected ${String.fromCharCode(h)}`,o),g}function N(){let h=c(o),g=h===ye?T():x();const u=o;for(d(),h=c(o);h===ae||h===je||h===ye;)o++,h===ae?(d(),g={__id:L,type:"MemberExpression",computed:!1,object:g,property:x(),location:l(u)}):h===je?(g={__id:L,type:"MemberExpression",computed:!0,object:g,property:m(),location:l(u)},d(),h=c(o),h!==mt&&F("Unclosed [",o),o++):h===ye&&(g={__id:L,type:"CallExpression",args:_(yt),callTarget:g,location:l(u)}),d(),h=c(o);return g}function T(){o++;const h=m();if(d(),c(o)===yt)return o++,h;F("Unclosed (",o)}function V(){const h=o;return o++,{__id:L,type:"ArrayExpression",elements:_(mt),location:l(h)}}const D=[];try{for(;o<s;){const h=c(o);if(h===Zr||h===Ie){o++;continue}const g=m();g?D.push(g):r&&o<s&&F(`Unexpected "${a(o)}"`,o)}return D.length===1?D[0]:{__id:L,type:"Compound",body:D,location:l(0)}}catch(h){if(r||!(h instanceof Error))throw h;return{__id:L,type:"Compound",body:D,location:l(0),error:h}}}var Wt={};Mr(Wt,{conditional:()=>Kt,deleteDataVal:()=>cn,getDataVal:()=>ln,setDataVal:()=>an,waitFor:()=>Ke});function ke(e){return e!=null&&typeof e=="object"&&typeof e.then=="function"&&(e instanceof Promise||e.constructor?.name==="Promise"||typeof e.catch=="function"&&typeof e.finally=="function")}var We=Symbol("Awaitable");function M(e){return ke(e)&&e[We]!==void 0}function K(e){const t=Promise.all(e);return rt(t)}function rt(e){return e[We]=We,e.awaitableThen=t=>rt(e.then(t)),e}var an=(e,t,r)=>{e.model.set([[t,r]])},ln=(e,t)=>e.model.get(t),cn=(e,t)=>e.model.delete(t),Kt=(e,t,r,n)=>{const i=e.evaluate(t);return M(i)?i.awaitableThen(s=>s?e.evaluate(r):n?e.evaluate(n):null):i?e.evaluate(r):n?e.evaluate(n):null};Kt.resolveParams=!1;var Ke=(e,t)=>rt(t);function un(e){return zt(e)?!1:typeof e=="object"&&e!==null&&!Array.isArray(e)&&"value"in e}var Gt=(e,t,r,n)=>Yt.and(e,t,r,n);Gt.resolveParams=!1;var Qt=(e,t,r,n)=>Yt.or(e,t,r,n);Qt.resolveParams=!1;var hn={"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"==":Y((e,t)=>e==t),"!=":Y((e,t)=>e!=t),">":Y((e,t)=>e>t),">=":Y((e,t)=>e>=t),"<":Y((e,t)=>e<t),"<=":Y((e,t)=>e<=t),"!==":Y((e,t)=>e!==t),"===":Y((e,t)=>e===t),"&&":Gt,"||":Qt,"|":(e,t)=>e|t,"&":(e,t)=>e&t,"+=":(e,t)=>e+t,"-=":(e,t)=>e-t,"&=":(e,t)=>e&t,"|=":(e,t)=>e|t},fn={"-":e=>-e,"+":e=>Number(e),"!":dn(e=>!e)};function Y(e){return(t,r,n)=>n&&(M(t)||M(r))?K([Promise.resolve(t),Promise.resolve(r)]).awaitableThen(([i,s])=>e(i,s)):e(t,r)}function dn(e){return(t,r)=>r&&M(t)?t.awaitableThen(n=>e(n)):e(t)}function pn(e,t,r,n,i){if(i&&M(e))return e.awaitableThen(o=>{const l=o?t():r(),a=n(l);return M(a)?Promise.resolve(a):a});const s=e?t():r();return n(s)}var Ot={handleArray(e,t){return t&&e.some(n=>M(n))?K(e):e},handleObject(e,t,r){const n={},i=[];let s=!1;return e.forEach(o=>{const l=t(o.key),a=t(o.value);if(r&&(M(l)||M(a))){s=!0;const c=Promise.resolve(l),f=Promise.resolve(a);i.push(K([c,f]).awaitableThen(([d,m])=>{n[d]=m}))}else n[l]=a}),s?K(i).awaitableThen(()=>n):n}},Yt={and:(e,t,r,n)=>{const i=e.evaluate(t);return n&&M(i)?i.awaitableThen(s=>{if(!s)return s;const o=e.evaluate(r);return M(o)?o:Promise.resolve(o)}):i&&e.evaluate(r)},or:(e,t,r,n)=>{const i=e.evaluate(t);return n&&M(i)?i.awaitableThen(s=>{if(s)return s;const o=e.evaluate(r);return M(o)?o:Promise.resolve(o)}):i||e.evaluate(r)}},gn=class{constructor(e){this.vars={},this.hooks={resolve:new j,resolveOptions:new j,beforeEvaluate:new j,onError:new re},this.expressionsCache=new Map,this.operators={binary:new Map(Object.entries(hn)),unary:new Map(Object.entries(fn)),expressions:new Map([...Object.entries(Wt),["await",Ke]])},this.defaultHookOptions={...e,evaluate:t=>this.evaluate(t,this.defaultHookOptions),resolveNode:t=>this._execAST(t,this.defaultHookOptions)},this.hooks.resolve.tap("ExpressionEvaluator",(t,r,n)=>this._resolveNode(t,r,n)),this.evaluate=this.evaluate.bind(this)}reset(){this.expressionsCache.clear()}evaluate(e,t){const r=this.hooks.resolveOptions.call({...this.defaultHookOptions,...t,resolveNode:i=>this._execAST(i,r)});let n=this.hooks.beforeEvaluate.call(e,r)??e;for(;un(n);)n=n.value;return typeof n=="number"||typeof n=="boolean"||n===void 0||n===null?n:zt(n)?this._execAST(n,r):Array.isArray(n)?n.reduce((i,s)=>this.evaluate(s,t),null):this._execString(String(n),r)}evaluateAsync(e,t){return Array.isArray(e)?K(e.map(async r=>this.evaluate(r,{...t,async:!0}))).awaitableThen(r=>r.pop()):this.evaluate(e,{...t,async:!0})}addExpressionFunction(e,t){this.operators.expressions.set(e,t)}addBinaryOperator(e,t){this.operators.binary.set(e,t)}addUnaryOperator(e,t){this.operators.unary.set(e,t)}setExpressionVariable(e,t){this.vars[e]=t}getExpressionVariable(e){return this.vars[e]}_execAST(e,t){return this.hooks.resolve.call(void 0,e,t)}_execString(e,t){if(e==="")return e;const r=e.match(/^@\[(.*)\]@$/);let n=e;if(r){const[,s]=Array.from(r);s&&(n=s)}let i;try{i=this.expressionsCache.get(n)??on(n,{strict:t.strict}),this.expressionsCache.set(n,i)}catch(s){if(t.throwErrors||!this.hooks.onError.call(s))throw new fe.NestedError(`Error parsing expression: ${e}`,s);return}try{return this._execAST(i,t)}catch(s){if(t.throwErrors||!this.hooks.onError.call(s))throw new fe.NestedError(`Error evaluating expression: ${e}`,s)}}_resolveNode(e,t,r){const{resolveNode:n,model:i}=r,s=r.async??!1,o={...r,evaluate:l=>this.evaluate(l,r)};if(t.type==="Literal")return t.value;if(t.type==="Identifier")return this.vars[t.name];if(t.type==="Compound"||t.type==="ThisExpression")throw new Error(`Expression type: ${t.type} is not supported`);if(t.type==="BinaryExpression"||t.type==="LogicalExpression"){const l=this.operators.binary.get(t.operator);if(l){if("resolveParams"in l){if(l.resolveParams===!1)return l(o,t.left,t.right,s);const f=n(t.left),d=n(t.right);return r.async&&(M(f)||M(d))?K([f,d]).awaitableThen(([m,C])=>l(o,m,C,s)):l(o,f,d,s)}const a=n(t.left),c=n(t.right);return r.async&&(M(a)||M(c))?K([a,c]).awaitableThen(([f,d])=>l(f,d,s)):l(a,c,s)}return}if(t.type==="UnaryExpression"){const l=this.operators.unary.get(t.operator);if(l){if("resolveParams"in l){if(l.resolveParams===!1)return l(o,t.argument,s);const c=n(t.argument);return r.async&&M(c)?c.awaitableThen(f=>l(o,f,s)):l(o,c,s)}const a=n(t.argument);return r.async&&M(a)?a.awaitableThen(c=>l(c,s)):l(a,s)}return}if(t.type==="Object")return Ot.handleObject(t.attributes,n,r.async||!1);if(t.type==="CallExpression"){const l=t.callTarget.name,a=this.operators.expressions.get(l);if(!a)throw new Error(`Unknown expression function: ${l}`);if(a.name===Ke.name&&!r.async)throw new Error("Usage of await outside of async context");if("resolveParams"in a&&a.resolveParams===!1)return a(o,...t.args);const c=t.args.map(f=>n(f));return r.async&&c.some(M)?K(c).awaitableThen(d=>a(o,...d)):a(o,...c)}if(t.type==="ModelRef")return i.get(t.ref,{context:{model:r.model}});if(t.type==="MemberExpression"){const l=n(t.object),a=n(t.property);return r.async&&(M(l)||M(a))?K([l,a]).awaitableThen(([c,f])=>c[f]):l[a]}if(t.type==="Assignment"){if(t.left.type==="ModelRef"){const l=n(t.right);if(ke(l)){if(r.async&&M(l))return l.awaitableThen(a=>(i.set([[t.left.ref,a]]),a));r.logger?.warn("Unawaited promise written to mode, this behavior is undefined and may change in future releases")}return i.set([[t.left.ref,l]]),l}if(t.left.type==="Identifier"){const l=n(t.right);return r.async&&M(l)?l.awaitableThen(a=>(this.vars[t.left.name]=a,a)):(this.vars[t.left.name]=l,l)}return}if(t.type==="ConditionalExpression"){const l=n(t.test);return pn(l,()=>t.consequent,()=>t.alternate,n,s)}if(t.type==="ArrayExpression"){const l=t.elements.map(a=>n(a));return Ot.handleArray(l,s)}if(t.type==="Modification"){const l=this.operators.binary.get(t.operator);if(l){let a;if("resolveParams"in l)if(l.resolveParams===!1)a=l(o,t.left,t.right,s);else{const c=n(t.left),f=n(t.right);r.async&&(M(c)||M(f))?a=K([c,f]).awaitableThen(([d,m])=>l(o,d,m,s)):a=l(o,c,f,s)}else{const c=n(t.left),f=n(t.right);r.async&&(M(c)||M(f))?a=K([c,f]).awaitableThen(([d,m])=>l(d,m,s)):a=l(c,f,s)}if(t.left.type==="ModelRef"){if(r.async&&M(a))return a.awaitableThen(c=>(i.set([[t.left.ref,c]]),c));i.set([[t.left.ref,a]])}else if(t.left.type==="Identifier"){if(r.async&&M(a))return a.awaitableThen(c=>(this.vars[t.left.name]=c,c));this.vars[t.left.name]=a}return a}return n(t.left)}}},vn=class{constructor(){this.hooks={trace:new P,debug:new P,info:new P,warn:new P,error:new P,log:new P},this.logHandlers=new Set,this.trace=this.createHandler("trace"),this.debug=this.createHandler("debug"),this.info=this.createHandler("info"),this.warn=this.createHandler("warn"),this.error=this.createHandler("error")}createHandler(e){return(...t)=>{this.hooks[e].call(t),this.hooks.log.call(e,t),this.logHandlers.forEach(r=>r[e](...t))}}addHandler(e){this.logHandlers.add(e)}removeHandler(e){this.logHandlers.delete(e)}},wn=class{constructor(e){this.trace=this.createHandler("trace"),this.debug=this.createHandler("debug"),this.info=this.createHandler("info"),this.warn=this.createHandler("warn"),this.error=this.createHandler("error"),this.proxiedLoggerProvider=e}createHandler(e){return(...t)=>{this.proxiedLoggerProvider()?.[e](...t)}}},Ct=e=>e;function yn(e){const t=new Map;if(!e.ROOT)return t;const r=[{node:e.ROOT,path:[],visited:new Set}];for(;r.length>0;){const n=r.shift();if(!n)break;const{node:i,path:s,visited:o}=n;Object.entries(i).forEach(([l,a])=>{const c=[...s,l],f=c.join(".");if(t.has(f))throw new Error("Path has already been processed. There's either a loop somewhere or a bug");if(o.has(a.type))throw new Error(`Path already contained type: ${a.type}. This likely indicates a loop in the schema`);t.set(f,a),a.isArray&&c.push("[]"),a.isRecord&&c.push("{}"),a.type&&e[a.type]&&r.push({path:c,node:e[a.type],visited:new Set([...o,a.type])})})}return t}var mn=class{constructor(e){this.formatters=new Map,this.types=new Map,this.schema=new Map,this.bindingSchemaNormalizedCache=new Map,this.hooks={resolveTypeForBinding:new j},this.schema=e?yn(e):new Map}addFormatters(e){e.forEach(t=>{this.formatters.set(t.name,t)})}addDataTypes(e){e.forEach(t=>{this.types.set(t.type,t)})}getValidationsForBinding(e){const t=this.getApparentType(e);if(t?.validation?.length)return t.validation.map(r=>({severity:"error",trigger:"change",...r}))}normalizeBinding(e){const t=this.bindingSchemaNormalizedCache.get(e);if(t)return t;let r=e.asArray(),n=r.map(i=>typeof i=="number"?"[]":i).join(".");return n&&(this.bindingSchemaNormalizedCache.set(e,n),r=n.split(".")),r.forEach(i=>{const s=r.map(o=>o===i?"{}":o).join(".");this.schema.get(s)&&(this.bindingSchemaNormalizedCache.set(e,s),r=s.split("."),n=s)}),n}getType(e){return this.hooks.resolveTypeForBinding.call(this.schema.get(this.normalizeBinding(e)),e)}getApparentType(e){const t=this.getType(e);if(t===void 0)return;const r=this.getTypeDefinition(t?.type);return r===void 0?t:{...r,...t,validation:[...t.validation??[],...r.validation??[]]}}getTypeDefinition(e){return this.types.get(e)}getFormatterForType(e){const{type:t,...r}=e,n=this.formatters.get(t);if(n)return{format:n.format?i=>n.format?.(i,r):Ct,deformat:n.deformat?i=>n.deformat?.(i,r):Ct}}getFormatter(e){const t=this.getApparentType(e);if(t?.format)return this.getFormatterForType(t.format)}},G="{{",$e="}}";function bn(e){const t=e.indexOf(G);if(t===-1)return;let r=1,n=t+G.length,i=e.substring(t+G.length);for(;r>0&&i.length>0;){const s=i.indexOf($e);if(s===-1)break;const o=i.indexOf(G);o!==-1&&o<s?(r++,i=i.substring(o+G.length),n+=o+G.length):(r--,i=i.substring(s+$e.length),n+=s+$e.length)}if(r!==0)throw new Error(`Unbalanced {{ and }} in exp: ${e}`);return{start:t,end:n}}function Sn(e,{evaluate:t}){if(!t)return e;const r=/@\[.*?\]@/;let n=e,i=n.match(r);for(;i!==null;){const s=i[0],o=n.indexOf(s),l=s.substr(2,s.length-2-2),a=t(l);if(o===0&&s===e&&typeof a!="string")return a;n=n.substr(0,o)+a+n.substr(o+s.length),i=n.match(r)}return n}function Jt(e,t){const{model:r,formatted:n=!0}=t;let i=Sn(e,t);if(!r||typeof i!="string"||i.indexOf(G)===-1)return i;for(;i.indexOf(G)!==-1;){const s=bn(i);if(!s)return i;const{start:o,end:l}=s,a=i.substring(o+G.length,l-G.length).trim(),c=r.get(a,{formatted:n});if(o===0&&l===i.length&&typeof c!="string")return c;i=i.substr(0,o)+c+i.substr(l)}return i}function Xt(e,t){switch(typeof e){case"string":return Jt(e,t);case"object":{if(!e)return e;const r=Object.keys(e);let n=e;return r.length>0&&r.forEach(i=>{n=U.setIn(n,[i],Xt(e[i],t))}),n}default:return e}}function nt(e,t){return Xt(e,t)}function Zt(e,t){const r=new Map(e),n=t.parent(),i=t.key();return r.forEach((s,o)=>{(t===o||t.contains(o))&&r.delete(o)}),typeof i=="number"&&Array.from(e.keys()).filter(o=>{if(n.contains(o)){const[l]=o.relative(n);return typeof l=="number"&&l>i}return!1}).sort().forEach(o=>{const[l,...a]=o.relative(n);if(typeof l=="number"){const c=[l-1,...a],f=n.descendent(c);r.set(f,r.get(o)),r.delete(o)}}),r}var En=class{constructor(e,t){this.validator=e,this.shadowModelPaths=new Map,this.logger=t?.logger,this.shouldIncludeInvalid=t?.shouldIncludeInvalid}set(e,t,r){const n=He(this,{...t,includeInvalid:!0},r),i=[],s=new Set;e.forEach(([c,f])=>{this.shadowModelPaths.set(c,f),s.add(c)});const o=[];this.shadowModelPaths.forEach((c,f)=>{const d=this.validator(f,n);d===void 0?i.push([f,c]):d instanceof Set?d.forEach(m=>{o.push(m.binding),!m.isStrong&&m.binding.asString()===f.asString()&&i.push([m.binding,c])}):s.has(f)&&(o.push(f),this.logger?.debug(`Invalid value for path: ${f.asString()} - ${d.severity} - ${d.message}`))});let l=[];if(r&&i.length>0){i.forEach(([f])=>this.shadowModelPaths.delete(f));const c=r.set(i,t);if(o.length===0)return c;l=c}const a=o.map(c=>({binding:c,oldValue:n.get(c),newValue:n.get(c),force:!0}));return[...l,...a]}get(e,t,r){let n=r?.get(e,t);return(this.shouldIncludeInvalid?.(t)??t?.includeInvalid===!0)&&this.shadowModelPaths.forEach((i,s)=>{if(s===e){n=i;return}e.contains(s)&&(n=U.setIn(n,s.relative(e),i))}),n}delete(e,t,r){return this.shadowModelPaths=Zt(this.shadowModelPaths,e),r?.delete(e,t)}},kn=class{constructor(){this.registry=new Map}get(e){return this.registry.get(e)}register(e,t){this.registry.set(e,t)}},An=(e=>(e.Asset="asset",e.View="view",e.Applicability="applicability",e.Template="template",e.Value="value",e.MultiNode="multi-node",e.Switch="switch",e.Async="async",e.Unknown="unknown",e.Empty="empty",e))(An||{});function On(e,t){return Object.hasOwnProperty.call(e,"template")&&Array.isArray(e?.template)&&e.template.length&&e.template.find(r=>r.output===t)}function Pt(e){return e==="staticSwitch"||e==="dynamicSwitch"}function er(e){return e==="template"}function Cn(e){if(e&&"value"in e&&typeof e.value=="object"&&typeof e.value?.id=="string")return e.value.id}var Pn={type:"empty"},Tn=class{constructor(){this.hooks={onParseObject:new j,onCreateASTNode:new j,parseNode:new re}}parseView(e){const t=this.parseObject(e,"view");if(!t)throw new Error("Unable to parse object into a view");return t}createASTNode(e,t){const r=this.hooks.onCreateASTNode.call(e,t);return r===void 0?e:r}parseObject(e,t="value",r={templateDepth:0}){const n=this.hooks.parseNode.call(e,t,r);if(n||n===null)return n;const i=(a,c,f=[])=>{if(typeof c!="object"||c===null)return{value:c,children:[]};const d=this.hooks.onParseObject.call(c,t);if(!d)return a;const m=Array.isArray(d)?d.map((y,v)=>[v,y]):[...Object.entries(d),...Object.getOwnPropertySymbols(d).map(y=>[y,d[y]])],C={children:[],value:a};return m.reduce((y,v)=>{let{value:E}=y;const{children:O}=y,[x,_]=v,N=this.hooks.parseNode.call(_,"value",r,{path:f,key:x,parentObj:d});if(N)O.push(...N);else if(_&&typeof _=="object"){const T=i(y.value,_,[...f,x]);E=T.value,O.push(...T.children)}else E=U.setIn(y.value,[...f,x],_);return{value:E,children:O}},C)},{value:s,children:o}=i(void 0,e),l=s===void 0&&!o.length?void 0:{type:t,value:s};if(l&&o.length){const a=l;a.children=o,o.forEach(c=>{c.value.parent=a})}return this.hooks.onCreateASTNode.call(l,e)??null}};function Ge(e,t){if(!e||!t)return!0;const r=Array.from(t.values()),n=Array.from(e.values());return r.find(i=>!!n.find(s=>s===i||s.contains(i)||i.contains(s)))!==void 0}function tr(e){return{...e,data:{model:e.model,formatValue:(t,r)=>e.formatValue?e.formatValue(t,r):r,format:(t,r)=>e.format?e.format(ee(t)?t:e.parseBinding(t),r):r},evaluate:t=>e.evaluator.evaluate(t,e)}}var Rn=e=>({get:(t,r)=>e.get(t,{context:{model:e},...r}),set:(t,r)=>e.set(t,{context:{model:e},...r}),delete:(t,r)=>e.delete(t,{context:{model:e},...r})}),Vn=class{constructor(e,t){this.hooks={skipResolve:new j,beforeUpdate:new P,afterUpdate:new P,resolveOptions:new j,beforeResolve:new j,resolve:new j,afterResolve:new j,afterNodeUpdate:new P},this.root=e,this.options=t,this.resolveCache=new Map,this.ASTMap=new Map,this.logger=t.logger,this.idCache=new Set}getSourceNode(e){return this.ASTMap.get(e)}update(e,t){this.hooks.beforeUpdate.call(e);const r=new Map;this.idCache.clear();const n=new Map(this.ASTMap);this.ASTMap.clear();const i=new Set;for(const o of t?.values()??[]){let l=o;for(;l;){const a=n.get(l)??l;if(i.has(a))break;i.add(a),l=l.parent}}const s=this.computeTree(this.root,void 0,e,r,tr(this.options),void 0,n,i);return this.resolveCache=r,this.hooks.afterUpdate.call(s.value),s.value}getResolveCache(){return new Map(this.resolveCache)}getPreviousResult(e){if(!e)return;const t=this.resolveCache.size===0,r=Cn(e);if(r){if(this.idCache.has(r)){t&&(e.type==="asset"||e.type==="view"?this.logger?.error(`Cache conflict: Found Asset/View nodes that have conflicting ids: ${r}, may cause cache issues.`):e.type==="value"&&this.logger?.info(`Cache conflict: Found Value nodes that have conflicting ids: ${r}, may cause cache issues. To improve performance make value node IDs globally unique.`));return}this.idCache.add(r)}return this.resolveCache.get(e)}cloneNode(e){const t=U.clone(e);return Object.keys(t).forEach(r=>{if(r==="parent")return;const n=t[r];typeof n=="object"&&n!==null&&(t[r]=Array.isArray(n)?[...n]:{...n})}),t}computeTree(e,t,r,n,i,s,o,l){try{const a=new Kr(i.data.model);a.trackSubset("core");const c=Rn(Yr(a,this.options.parseBinding)),f=this.hooks.resolveOptions.call({...i,data:{...i.data,model:c},evaluate:T=>this.options.evaluator.evaluate(T,{model:c}),node:e},e),d=this.getPreviousResult(e),m=d?.dependencies,C=l.has(e),S=Ge(r,m),y=this.hooks.skipResolve.call(!S&&!C,e,f);if(d&&y){const T={...d,updated:!1},V=(D,h,g)=>{const{node:u}=D;this.ASTMap.set(u,h);const p={...D,updated:!1};n.set(h,p);const w=k=>{const b=o.get(k)??k,A=this.getPreviousResult(b);A&&V(A,b,h)};"children"in u?u.children?.forEach(({value:k})=>w(k)):u.type==="multi-node"&&u.values.forEach(w),this.hooks.afterNodeUpdate.call(h,g,p)};return d.node.parent=s,V(d,e,t),T}const v={...this.cloneNode(e),parent:s},E=this.hooks.beforeResolve.call(v,f)??{type:"empty"};E.parent=s,f.node=E,this.ASTMap.set(E,e);let O=this.hooks.resolve.call(void 0,E,f),x=!Z(d?.value,O);d&&!x&&(O=d?.value);const _=new Set;if(a.trackSubset("children"),"children"in E){const T=E.children?.map(V=>{const D=this.computeTree(V.value,e,r,n,f,E,o,l),{dependencies:h,node:g,updated:u,value:p}=D;if(h.forEach(w=>_.add(w)),p)if(g.type==="multi-node"&&!g.override){const w=U.addLast(et(O,V.path,[]),p);O=U.setIn(O,V.path,w)}else O=U.setIn(O,V.path,p);return x=x||u,{...V,value:g}});E.children=T}else if(E.type==="multi-node"){const T=[],V=e;E.values=E.values.map(D=>{const h=this.computeTree(D,V,r,n,f,E,o,l);return h.value!==void 0&&h.value!==null&&(h.dependencies.forEach(g=>_.add(g)),x=x||h.updated,T.push(h.value)),h.node}),O=T}_.forEach(T=>a.addChildReadDep(T)),a.trackSubset("core"),d&&!x&&(O=d?.value),O=this.hooks.afterResolve.call(O,E,{...f,getDependencies:T=>a.getDependencies(T)});const N={node:E,updated:x,value:O,dependencies:new Set([...a.getDependencies(),..._])};return this.hooks.afterNodeUpdate.call(e,t,N),n.set(e,N),N}catch(a){const c=a instanceof Error?a:new Error(String(a));throw c instanceof Qe?c:new Qe(c,Mn.BeforeResolve,e)}}},Mn={BeforeResolve:"before-resolve"},Qe=class extends Error{constructor(e,t,r){super(`An error in the resolver occurred at stage '${t}'`),this.cause=e,this.stage=t,this.node=r}},xn=class{constructor(e,t,r){this.isTransitioning=!1,this.hooks={beforeStart:new re,onStart:new P,onEnd:new P,skipTransition:new re,beforeTransition:new j,resolveTransitionNode:new j,transition:new P,afterTransition:new P},this.id=e,this.flow=t,this.log=r?.logger,this.history=[],this.hooks.transition.tap("startPromise",async(n,i)=>{const s=i.value;this.flowPromise&&s.state_type==="END"&&this.flowPromise.resolve(s)})}async start(){if(this.flowPromise)return this.log?.warn("Already called start for flow"),this.flowPromise.promise;this.flow=this.hooks.beforeStart.call(this.flow)||this.flow,this.flow.onStart&&this.hooks.onStart.call(this.flow.onStart);const e=this.flow.startState;return e?(this.flowPromise=_t(),this.pushHistory(e),this.flowPromise.promise):Promise.reject(new Error("No 'startState' defined for flow"))}getFlowErrorTransitions(){return this.flow.errorTransitions}lookupInMap(e,t){if(e)return e[t]||e["*"]}errorTransition(e){if(this.currentState?.value.state_type==="END"){this.log?.warn("Cannot error transition from END state");return}if(this.currentState){const r=this.lookupInMap(this.currentState.value.errorTransitions,e);if(r)if(!Object.prototype.hasOwnProperty.call(this.flow,r))this.log?.debug(`Node-level errorTransition references non-existent state "${r}", trying flow-level fallback`);else return this.log?.debug(`Error transition (node-level) from ${this.currentState.name} to ${r} using ${e}`),this.pushHistory(r)}const t=this.lookupInMap(this.flow.errorTransitions,e);if(t)if(!Object.prototype.hasOwnProperty.call(this.flow,t))this.log?.debug(`Flow-level errorTransition references non-existent state "${t}"`);else return this.log?.debug(`Error transition (flow-level) to ${t} using ${e}${this.currentState?` from ${this.currentState.name}`:""}`),this.pushHistory(t);this.log?.warn(`No errorTransition found for ${e} (checked node and flow level)`)}transition(e,t){if(this.isTransitioning)throw new Error(`Transitioning while ongoing transition from ${this.currentState?.name} is in progress is not supported`);if(this.currentState?.value.state_type==="END"){this.log?.warn(`Skipping transition using ${e}. Already at END state`);return}if(this.currentState===void 0)throw new Error("Cannot transition when there's no current state");const r=this.currentState.value;if(t?.force)this.log?.debug("Forced transition. Skipping validation checks");else if(this.hooks.skipTransition.call(this.currentState)){this.log?.debug(`Skipping transition from ${this.currentState.name} b/c hook told us to`);return}const n=this.hooks.beforeTransition.call(r,e);if(!("transitions"in n))throw new Error(`No transitions defined for ${this.currentState.value}`);const{transitions:i}=n,s=i[e]||i["*"];if(s===void 0){this.log?.warn(`No transition from ${this.currentState.name} using ${e} or *`);return}return this.log?.debug(`Transitioning from ${this.currentState.name} to ${s} using ${e} `),this.pushHistory(s,t)}pushHistory(e,t){if(!Object.prototype.hasOwnProperty.call(this.flow,e))throw new Error(`No flow definition for: ${e} was found.`);let r=this.flow[e];if(!this.flow[e]||typeof r!="object"||!("state_type"in r)){this.log?.error(`Flow doesn't contain any states named: ${e}`);return}const n=this.currentState;this.isTransitioning=!0,r=this.hooks.resolveTransitionNode.call(r);const i={name:e,value:r};this.currentState=i,this.history.push(e),i.value.state_type==="END"&&this.flow.onEnd&&this.hooks.onEnd.call(this.flow.onEnd),this.hooks.transition.call(n,{...i}),this.isTransitioning=!1,this.hooks.afterTransition.call(this)}},Nn=class{constructor(e,t){this.hooks={flow:new P},this.navigation=e,this.navStack=[],this.log=t?.logger,this.start=this.start.bind(this),this.run=this.run.bind(this),this.transition=this.transition.bind(this),this.addNewFlow=this.addNewFlow.bind(this)}transition(e,t){if(this.current===void 0)throw new Error("Not currently in a flow. Cannot transition.");this.current.transition(e,t)}addNewFlow(e){this.navStack.push(e),this.current=e,this.hooks.flow.call(e)}async run(e){if(!Object.prototype.hasOwnProperty.call(this.navigation,e))return Promise.reject(new Error(`No flow defined for: ${e}`));const t=this.navigation[e];if(t===null||typeof t!="object")return Promise.reject(new Error(`Flow: ${e} needs to be an object`));this.log?.debug(`Starting flow: ${e}`);const r=new xn(e,t,{logger:this.log});this.addNewFlow(r),r.hooks.afterTransition.tap("flow-controller",i=>{if(i.currentState?.value.state_type==="FLOW"){const s=i.currentState?.value.ref;this.log?.debug(`Loading subflow ${s}`),this.run(s).then(o=>{this.log?.debug(`Subflow ended. Using outcome: ${o.outcome}`),i.transition(o?.outcome)})}});const n=await r.start();return this.navStack.pop(),this.navStack.length>0&&(this.current=this.navStack[0]),n}async start(){return this.navigation.BEGIN?this.run(this.navigation.BEGIN):Promise.reject(new Error("Must supply a BEGIN state"))}},Dn=/%([a-zA-Z]+)/g;function In(e,t){return e.slice().replace(Dn,r=>t[r.slice(1)]||r)}var ce="validation-binding-tracker",jn=class{constructor(e){this.trackedBindings=new Set,this.options=e}getBindings(){return this.trackedBindings}trackBinding(e){this.trackedBindings.has(e)||(this.trackedBindings.add(e),this.options.callbacks?.onAdd?.(e))}applyResolver(e){this.trackedBindings.clear();const t=new Map,r=new Map;let n;const i=new Map;let s=new Map;const o=new Map,l=new Map;e.hooks.beforeUpdate.tap(ce,a=>{n=a}),e.hooks.skipResolve.tap(ce,(a,c)=>{const f=i.get(c);return!a||!n||!f?a:new Set([...n].filter(m=>f.has(m))).size===0}),e.hooks.resolveOptions.tap(ce,(a,c)=>{if(a.validation===void 0)return a;t.delete(c);const f=d=>{const m=ee(d)?d:this.options.parseBinding(d);t.has(c)?t.get(c)?.add(m):t.set(c,new Set([m]));let{parent:C}=c;for(;C;)if(r.has(C)){r.get(C)?.add(c);break}else C=C.parent;this.trackedBindings.add(m),this.options.callbacks?.onAdd?.(m)};return{...a,validation:{...a.validation,get:(d,m)=>(m?.track&&f(d),a.validation?._getValidationForBinding(d)?.getAll(m)?.find(y=>y.displayTarget==="field"||y.displayTarget===void 0)),getValidationsForBinding(d,m){return m?.track&&f(d),a.validation?._getValidationForBinding(d)?.getAll(m)??[]},getChildren:d=>{const m=new Array;return i.get(c)?.forEach(C=>{const S=a.validation?._getValidationForBinding(C)?.get();S&&(d===void 0||d===S.displayTarget)&&m.push(S)}),m},getValidationsForSection:()=>{const d=new Array;return o.get(c)?.forEach(m=>{const C=a.validation?._getValidationForBinding(m)?.get();C&&C.displayTarget==="section"&&d.push(C)}),d},register:d=>{d?.type==="section"&&(r.has(c)||r.set(c,new Set))},track:f}}}),e.hooks.afterNodeUpdate.tap(ce,(a,c,f)=>{const{updated:d,node:m}=f;if(l.set(m,a),d){const C=new Set(t.get(a));m.type==="multi-node"&&m.values.forEach(S=>s.get(S)?.forEach(y=>C.add(y))),"children"in m&&m.children&&m.children.forEach(S=>{s.get(S.value)?.forEach(y=>C.add(y))}),s.set(m,C)}else s.set(m,i.get(a)??new Set);a===e.root&&(this.trackedBindings=new Set(s.get(m)),i.clear(),s.forEach((C,S)=>{const y=l.get(S);y&&i.set(y,C)}),o.clear(),r.forEach((C,S)=>{const y=new Set;C.forEach(v=>{t.get(v)?.forEach(y.add,y)}),o.set(S,y)}),t.clear(),r.clear(),s=new Map)})}apply(e){e.hooks.resolver.tap(ce,this.applyResolver.bind(this))}},Bn="schema",_n="view",$n=Symbol.for("validation-provider-name");function Fn(e,t){if(e.size>t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function Un(e){return{value:e,type:e.severity,state:"none",isBlockingNavigation:!1}}var Ln=class{constructor(e,t,r,n){this.applicableValidations=[],this.validationsByState={load:[],change:[],navigation:[]},this.onDismiss=t,e.forEach(i=>{const{trigger:s}=i;if(this.validationsByState[s]){const o=Un(i);this.validationsByState[s].push(o)}else r?.warn(`Unknown validation trigger: ${s}`)}),this.weakBindings=n??new Set}get allValidations(){return Object.values(this.validationsByState).flat()}checkIfBlocking(e){if(e.state==="active"){const{isBlockingNavigation:t}=e;return t}return!1}getAll(){return this.applicableValidations.reduce((e,t)=>(t.state==="active"&&t.response&&e.push({...t.response,blocking:this.checkIfBlocking(t)}),e),[])}get(){const e=this.applicableValidations.find(t=>t.state==="active"&&t.response);if(e?.state==="active")return{...e.response,blocking:this.checkIfBlocking(e)}}runApplicableValidations(e,t,r){this.applicableValidations=this.applicableValidations.map(n=>{if(n.state==="dismissed")return n;const i=n.value.blocking??(n.value.severity==="warning"&&"once"||!0),s=U.setIn(n,["value","blocking"],i),o=i===!0||i==="once"&&!t;if(r==="navigation"&&s.state==="active"&&s.value.blocking!==!0&&s.value.severity==="warning"){const c=s;return c.dismissable&&c.response.dismiss&&(c.response.blocking!=="once"||!c.response.blocking)?c.response.dismiss():(c?.response.blocking==="once"&&(c.response.blocking=!1),c.dismissable=!0),c}const l=e(s.value),a={type:s.type,value:s.value,state:l?"active":"none",isBlockingNavigation:o,dismissable:s.value.severity==="warning"&&r==="navigation",response:l?{...s.value,message:l.message??"Something is broken",severity:s.value.severity,displayTarget:s.value.displayTarget??"field"}:void 0};return a.state==="active"&&s.value.severity==="warning"&&(a.response.dismiss=()=>{a.state="dismissed",this.onDismiss?.()}),a})}update(e,t,r){const n=[];if(!(e==="load"&&this.currentPhase!==void 0)){if(this.currentPhase==="navigation"||e===this.currentPhase){this.runApplicableValidations(r,t,e);return}e==="load"?(this.currentPhase="load",this.applicableValidations=[...this.validationsByState.load]):e==="change"&&this.currentPhase==="load"?(this.currentPhase="change",this.applicableValidations=[...this.applicableValidations,...this.validationsByState.change]):e==="navigation"&&(this.currentPhase==="load"||this.currentPhase==="change")&&(this.applicableValidations.forEach(i=>{i.type==="error"&&i.state==="active"&&i.isBlockingNavigation===!1||n.push(i)}),this.applicableValidations=[...n,...this.validationsByState.navigation,...this.currentPhase==="load"?this.validationsByState.change:[]],this.currentPhase="navigation"),this.runApplicableValidations(r,t,e)}}},zn=class{constructor(e,t){this.hooks={createValidatorRegistry:new P,onAddValidation:new j,onRemoveValidation:new j,resolveValidationProviders:new j,onTrackBinding:new P},this.validations=new Map,this.weakBindingTracker=new Set,this.schema=e,this.options=t,this.reset()}setOptions(e){this.options=e}getDataMiddleware(){return[{set:(e,t,r)=>r?.set(e,t)??[],get:(e,t,r)=>r?.get(e,t),delete:(e,t,r)=>(this.validations=Zt(this.validations,e),r?.delete(e,t))},new En(e=>{if(!this.options)return;this.updateValidationsForBinding(e,"change",this.options);const t=this.getValidationForBinding(e);if(t?.get()?.severity==="error")return t.get();const r=new Set;if(this.validations.forEach((n,i)=>{Ge(new Set([e]),n.weakBindings)&&n?.get()?.severity==="error"&&n?.weakBindings.forEach(s=>{s===i?r.add({binding:s,isStrong:!0}):r.add({binding:s,isStrong:!1})})}),r.size>0)return r},{logger:new wn(()=>this.options?.logger)})]}getValidationProviders(){return this.providers?this.providers:(this.providers=this.hooks.resolveValidationProviders.call([{source:Bn,provider:this.schema},{source:_n,provider:{getValidationsForBinding:e=>this.viewValidationProvider?.getValidationsForBinding?.(e),getValidationsForView:()=>this.viewValidationProvider?.getValidationsForView?.()}}]),this.providers)}reset(){this.validations.clear(),this.tracker=void 0}onView(e){if(this.validations.clear(),!this.options)return;const t=new jn({...this.options,callbacks:{onAdd:r=>{if(!this.options||this.getValidationForBinding(r)!==void 0)return;const n=this.options.model.get(r),i=this.options.model.get(r,{ignoreDefaultValue:!0});n!==i&&this.options.model.set([[r,n]],{silent:!0}),this.updateValidationsForBinding(r,"load",this.options,()=>{e.update(new Set([r]))}),this.hooks.onTrackBinding.call(r)}}});this.tracker=t,this.viewValidationProvider=e,t.apply(e)}updateValidationsForBinding(e,t,r,n){const i=r??this.options;if(!i)throw new Error("Context is required for executing validations");if(t==="load"){const o=this.getValidationProviders().reduce((l,a)=>(l.push(...a.provider.getValidationsForBinding?.(e)?.map(c=>({...c,[$n]:a.source}))??[]),l),[]);if(o.length===0)return;this.validations.set(e,new Ln(o,n,this.options?.logger))}this.validations.get(e)?.update(t,!0,o=>{const l=this.validationRunner(o,e,i);if(this.weakBindingTracker.size>0){const a=this.validations.get(e);this.weakBindingTracker.forEach(c=>a.weakBindings.add(c))}return l?{message:l.message}:void 0}),t!=="load"&&this.validations.forEach((o,l)=>{l!==e&&Ge(new Set([e]),o.weakBindings)&&o.update(t,!0,a=>{const c=this.validationRunner(a,l,i);return c?{message:c.message}:void 0})})}validationRunner(e,t,r=this.options){if(!r)throw new Error("No context provided to validation runner");const n=e.handler??this.getValidator(e.type),i=new Set,s={get(l,a){return i.add(ee(l)?t:r.parseBinding(l)),r.model.get(l,{...a,includeInvalid:!0})},set:r.model.set,delete:r.model.delete},o=n?.({...r,evaluate:(l,a={model:s})=>r.evaluate(l,a),model:s,validation:e,schemaType:this.schema.getType(t)},r.model.get(t,{includeInvalid:!0,formatted:e.dataTarget==="formatted"}),e);if(this.weakBindingTracker=i,o){let{message:l}=o;const{parameters:a}=o;return e.message&&(l=nt(e.message,{model:s,evaluate:r.evaluate}),a&&(l=In(l,a))),{message:l}}}updateValidationsForView(e){const t=e==="navigation",r=this.activeBindings,n=i=>{this.getBindings().forEach(s=>{this.validations.get(s)?.update(e,i,o=>{if(this.options)return this.validationRunner(o,s,this.options)})})};if(n(!t),t){const{activeBindings:i}=this;Fn(i,r)&&n(!0)}}get activeBindings(){return new Set(Array.from(this.getBindings()).filter(e=>this.validations.get(e)?.get()!==void 0))}getValidator(e){if(this.validatorRegistry)return this.validatorRegistry.get(e);const t=new kn;return this.hooks.createValidatorRegistry.call(t),this.validatorRegistry=t,t.get(e)}getBindings(){return this.tracker?.getBindings()??new Set}trackBinding(e){this.tracker?.trackBinding(e)}validateView(e="navigation"){this.updateValidationsForView(e);const t=new Map;let r=!0;return this.getBindings().forEach(n=>{this.getValidationForBinding(n)?.getAll()?.forEach(s=>{e==="navigation"&&s.blocking&&(this.options?.logger.debug(`Validation on binding: ${n.asString()} is preventing navigation. ${JSON.stringify(s)}`),r=!1),t.has(n)||t.set(n,s)})}),{canTransition:r,validations:t.size?t:void 0}}getValidationForBinding(e){return this.validations.get(e)}forView(e){return{_getValidationForBinding:t=>this.getValidationForBinding(ee(t)?t:e(t)),getAll:()=>{const t=this.getBindings();if(t.size===0)return;const r=new Map;return t.forEach(n=>{const i=this.getValidationForBinding(n)?.get();i&&r.set(n,i)}),r.size===0?void 0:r},get(){throw new Error("Error Access be provided by the view plugin")},getValidationsForBinding(){throw new Error("Error rollup should be provided by the view plugin")},getChildren(){throw new Error("Error rollup should be provided by the view plugin")},getValidationsForSection(){throw new Error("Error rollup should be provided by the view plugin")},track:()=>{throw new Error("Tracking should be provided by the view plugin")},register:()=>{throw new Error("Section functionality should be provided by the view plugin")},type:t=>this.schema.getType(ee(t)?t:e(t))}}},Tt=(e,t)=>new Set([...e?.values()??[],...t?.values()??[]]),Hn=class{constructor(e,t){this.hooks={resolveView:new j,view:new P},this.transformRegistry=new Rr,this.optimizeUpdates=!0,this.viewOptions=t,this.viewMap=e.reduce((n,i)=>(n[i.id]=i,n),{}),t.flowController.hooks.flow.tap("viewController",n=>{n.hooks.transition.tap("viewController",(i,s)=>{s.value.state_type==="VIEW"?this.onView(s.value):this.currentView=void 0})});const r=(n,i=!1)=>{this.currentView&&(this.optimizeUpdates?this.queueUpdate(n,void 0,i):this.currentView.update())};t.model.hooks.onUpdate.tap("viewController",(n,i)=>{r(new Set(n.map(s=>s.binding)),i?.silent??!1)}),t.model.hooks.onDelete.tap("viewController",n=>{const i=n.parent(),s=n.key();r(typeof s=="number"&&i?new Set([i]):new Set([n]))}),this.viewPlugins=this.createViewPlugins()}queueUpdate(e,t,r=!1){this.pendingUpdate||(this.pendingUpdate={scheduled:!1}),this.pendingUpdate={...this.pendingUpdate,changedBindings:Tt(this.pendingUpdate.changedBindings,e),changedNodes:Tt(this.pendingUpdate.changedNodes,t)},!this.pendingUpdate.scheduled&&!r&&(this.pendingUpdate.scheduled=!0,$t(()=>{const{changedBindings:n,changedNodes:i}=this.pendingUpdate??{};this.pendingUpdate=void 0,this.currentView?.update(n,i)}))}getViewForRef(e){if(this.viewMap[e])return this.viewMap[e];const t=Object.keys(this.viewMap).find(r=>e===Jt(r,{model:this.viewOptions.model,evaluate:this.viewOptions.evaluator.evaluate}));if(t&&this.viewMap[t])return this.viewMap[t]}onView(e){const t=e.ref,r=this.hooks.resolveView.call(this.getViewForRef(t),t,e);if(!r)throw new Error(`No view with id ${t}`);const n=new ti(r,this.viewOptions,this.viewOptions.errorController);this.currentView=n,this.applyViewPlugins(n),this.hooks.view.call(n),n.update()}applyViewPlugins(e){for(const t of this.viewPlugins)t.apply(e)}createViewPlugins(){const e=tr(this.viewOptions);return[new ui,new li(e),new ai,new hi(this.transformRegistry),new oi,new ri(e),new ci]}updateViewAST(e){this.queueUpdate(void 0,e)}},qn=class{constructor(e){this.updateCallback=e,this.state=new Map}removeKey(e){this.state.delete(e)}reset(){this.state.clear()}useSharedState(e){return t=>(this.state.has(e)||this.state.set(e,t),[this.state.get(e),r=>{const n=this.state.get(e);this.state.set(e,r),n!==r&&this.updateCallback?.()}])}getLocalStateFunction(e,t){return r=>{this.state.has(e)||this.state.set(e,[]),this.state.has(t)||this.state.set(t,0);const n=this.state.get(e),i=this.state.get(t);return this.state.set(t,i+1),n.length<=i&&n.push(r),[n[i],o=>{const l=n[i];n[i]=o,l!==o&&this.updateCallback?.()}]}}},Wn=class{constructor(e,t){this.controller=e,this.logger=t}get(e,t){return this.controller.get(e,t)}set(e,t){return this.logger?.error("Error: Tried to set in a read only instance of the DataController"),[]}delete(e,t){this.logger?.error("Error: Tried to delete in a read only instance of the DataController")}},Kn=class{constructor(e,t){this.hooks={resolve:new j,resolveDataStages:new j,resolveDefaultValue:new re,onDelete:new P,onSet:new P,onGet:new P,onUpdate:new P,format:new j,deformat:new j,serialize:new j},this.logger=t.logger;const r=t.middleware||[];this.baseMiddleware=[new qe(e),...r],this.trash=new Set,this.pathResolver=t.pathResolver}getModel(){if(!this.model){const e=this.hooks.resolveDataStages.call(this.baseMiddleware),t=new Jr;t.setMiddleware(e),this.model=t}return this.model}resolveDataValue(e,t,r){return r?this.hooks.deformat.call(t,e):t}set(e,t){let r=[];Array.isArray(e)?r=e.map(([o,l])=>{const a=this.pathResolver.parse(o);return[a,this.resolveDataValue(a,l,!!t?.formatted)]}):r=Object.keys(e).map(o=>{const l=this.pathResolver.parse(o),a=e[o];return[l,this.resolveDataValue(l,a,!!t?.formatted)]});const n=r.reduce((o,[l,a])=>{const c=this.get(l,{includeInvalid:!0}),f={binding:l,newValue:a,oldValue:c};return Z(c,a)?this.logger?.debug(`Skipping update for path: ${l.asString()}. Value was unchanged: ${c}`):(o.push(f),this.logger?.debug(`Setting path: ${l.asString()} from: ${c} to: ${a}`)),o},[]),i=this.getModel().set(r,t),s=new Set(n.map(o=>o.binding));return i.forEach(o=>{!s.has(o.binding)&&(o.force===!0||!Z(o.oldValue,o.newValue))&&(this.logger?.debug(`Path: ${o.binding.asString()} was changed from: ${o.oldValue} to: ${o.newValue}`),n.push(o))}),this.hooks.onSet.call(r),n.length>0&&this.hooks.onUpdate.call(n,t),i}resolve(e,t){return Array.isArray(e)||typeof e=="string"?this.pathResolver.parse(e,{readOnly:t}):e}get(e,t){const r=e instanceof te?e:this.resolve(e,!0);let n=this.getModel().get(r,t);if(n===void 0&&!t?.ignoreDefaultValue){const i=this.hooks.resolveDefaultValue.call(r);i!==n&&(n=i)}return t?.formatted?n=this.hooks.format.call(n,r):t?.formatted===!1&&(n=this.hooks.deformat.call(n,r)),this.hooks.onGet.call(e,n),n}delete(e,t){if(typeof e!="string"&&!Array.isArray(e)&&!(e instanceof te))throw new Error("Invalid arguments: delete expects a data path (string)");const r=e instanceof te?e:this.resolve(e,!1),n=r.parent(),i=r.key(),s=this.get(n),o=typeof s=="object"&&s!==null&&Object.prototype.hasOwnProperty.call(s,i);this.getModel().delete(r,t),o&&!this.get(r)&&this.trash.add(r),this.hooks.onDelete.call(r)}serialize(){return this.hooks.serialize.call(this.get(""))}makeReadOnly(){return new Wn(this,this.logger)}};function rr(e,t=[],r="."){return Object.keys(e).reduce((n,i)=>({...n,...Object.prototype.toString.call(e[i])==="[object Object]"?rr(e[i],t.concat([i])):{[t.concat([i]).join(r)]:e[i]}}),{})}function Rt(e){const t=rr(e),r=[];return Object.keys(t).forEach(n=>{r.push([new te(n),t[n]])}),r}var Gn=class{constructor(){this.store=new Map,this.tempStore=new Map}addConstants(e,t){this.store.has(t)?this.store.get(t)?.set(Rt(e)):this.store.set(t,new qe(e))}getConstants(e,t,r){const n=new te(e);return this.tempStore.get(t)?.get(n)??this.store.get(t)?.get(n)??r}setTemporaryValues(e,t){this.tempStore.has(t)?this.tempStore.get(t)?.set(Rt(e)):this.tempStore.set(t,new qe(e))}clearTemporaryValues(e){e?this.tempStore.get(e)?.reset():this.tempStore.forEach(t=>{t.reset()})}},Qn=class{constructor(e){this.name="error-state-middleware",this.logger=e.logger,this.writeSymbol=e.writeSymbol}set(e,t,r){if(t?.writeSymbol===this.writeSymbol)return r?.set(e,t)??[];const n=[],i=[];e.forEach(([l,a])=>{const c=l.asString();c==="errorState"||c.startsWith("errorState.")?(i.push(l),this.logger?.warn(`[ErrorStateMiddleware] Blocked write to protected path: ${c}`)):n.push([l,a])});const s=r?.set(n,t)??[],o=i.map(l=>({binding:l,oldValue:r?.get(l,t),newValue:r?.get(l,t),force:!1}));return[...s,...o]}get(e,t,r){return r?.get(e,t)}delete(e,t,r){if(t?.writeSymbol===this.writeSymbol){r?.delete(e,t);return}const n=e.asString();if(n==="errorState"||n.startsWith("errorState.")){this.logger?.warn(`[ErrorStateMiddleware] Blocked delete of protected path: ${n}`);return}r?.delete(e,t)}},Fe=Symbol("errorControllerWrite"),Yn=()=>{const e=new Set;return(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[CIRCULAR]";e.add(r)}return r}},Jn=class{constructor(e){this.hooks={onError:new re},this.errorHistory=[],this.options=e,this.middleware=new Qn({logger:e.logger,writeSymbol:Fe})}getDataMiddleware(){return this.middleware}setOptions(e){this.options.model=e.model}captureError(e,t,r,n){const i={error:e,errorType:t,severity:r,metadata:n,skipped:!1};return this.errorHistory.push(i),this.currentError=i,this.options.logger.debug(`[ErrorController] Captured error: ${e.message}`,JSON.stringify({errorType:t,severity:r,metadata:n},Yn())),this.hooks.onError.call(i)??!1?(i.skipped=!0,this.options.logger.debug("[ErrorController] Error state navigation skipped by plugin"),i):(this.setErrorInDataModel(i),this.navigateToErrorState(i),i)}navigateToErrorState(e){const t=this.options.flow.current;if(!t){this.options.logger.warn("[ErrorController] No active flow instance for error navigation");return}try{t.errorTransition(e.errorType)}catch(r){this.options.logger.error(`[ErrorController] Error transition failed with unexpected error: ${r}`),this.options.logger.debug("[ErrorController] Rejecting flow with error"),this.options.fail(e.error)}}getCurrentError(){return this.currentError}getErrors(){return this.errorHistory}clearErrors(){this.errorHistory=[],this.currentError=void 0,this.deleteErrorFromDataModel(),this.options.logger.debug("[ErrorController] All errors cleared")}clearCurrentError(){this.currentError=void 0,this.deleteErrorFromDataModel(),this.options.logger.debug("[ErrorController] Current error cleared")}setErrorInDataModel(e){if(!this.options.model){this.options.logger.warn("[ErrorController] No DataController available");return}try{const{error:t,errorType:r,severity:n,metadata:i}=e;this.options.model.set([["errorState",{message:t.message,name:t.name,errorType:r,severity:n,...i}]],{writeSymbol:Fe}),this.options.logger.debug("[ErrorController] Error set in data model at 'data.errorState'")}catch(t){this.options.logger.error("[ErrorController] Failed to set error in data model",t)}}deleteErrorFromDataModel(){if(this.options.model)try{this.options.model.delete("errorState",{writeSymbol:Fe}),this.options.logger.debug("[ErrorController] errorState deleted from data model")}catch(e){this.options.logger.error("[ErrorController] Failed to delete errorState from data model",e)}}},Xn=(e=>(e.FATAL="fatal",e.ERROR="error",e.WARNING="warning",e))(Xn||{}),Zn={VIEW:"view",RENDER:"render"},ei=class{constructor(e,t,r){this.allValidations=new Set,this.byBinding=new Map,this.logger=r,this.parse(e,t)}parse(e,t){const r=e.validation;if(r!==void 0){if(!Array.isArray(r)){this.logger?.warn(`Unable to register view validations for id: ${e.id}. 'validation' property must be an Array.`);return}r.forEach(n=>{const i={trigger:"navigation",severity:"error",...n};this.allValidations.add(i);const{ref:s}=n;if(s){const o=t(s);this.byBinding.has(o)?this.byBinding.get(o)?.push(i):this.byBinding.set(o,[i])}})}}getValidationsForBinding(e){return this.byBinding.get(e)}},ti=class{constructor(e,t,r){this.hooks={onUpdate:new P,parser:new P,resolver:new P,templatePlugin:new P},this.initialView=e,this.resolverOptions=t,this.errorController=r}updateAsync(e){const t=this.resolver?.update();this.lastUpdate=t,this.hooks.onUpdate.call(t)}update(e,t){if(this.rootNode===void 0){this.validationProvider=new ei(this.initialView,this.resolverOptions.parseBinding,this.resolverOptions.logger),this.templatePlugin?this.hooks.templatePlugin.call(this.templatePlugin):this.resolverOptions.logger?.warn("templatePlugin not set for View, legacy templates may not work");const r=new Tn;this.hooks.parser.call(r),this.rootNode=r.parseView(this.initialView),this.resolver=new Vn(this.rootNode,{...this.resolverOptions,parseNode:r.parseObject.bind(r)}),this.hooks.resolver.call(this.resolver)}try{const r=this.resolver?.update(e,t);return this.lastUpdate===r?this.lastUpdate:(this.lastUpdate=r,this.hooks.onUpdate.call(r),r)}catch(r){if(!this.errorController)throw r;const n=r instanceof Error?r:new Error(String(r)),i={};return n instanceof Qe&&(i.node=n.node),this.errorController.captureError(n,Zn.VIEW,"error",i),this.lastUpdate}}getValidationsForBinding(e){return this.validationProvider?.getValidationsForBinding(e)}setTemplatePlugin(e){this.templatePlugin=e}},Ps=class Ye{static asset(t){return{type:"asset",value:t}}static assetWrapper(t){const r=Ye.value();return Ye.addChild(r,"asset",t),r}static value(t){return{type:"value",value:t}}static multiNode(...t){const r={type:"multi-node",override:!0,values:t};return t.forEach(n=>{n.parent=r}),r}static asyncNode(t,r=!0,n){return{id:t,type:"async",flatten:r,onValueReceived:n,value:{type:"value",value:{id:t}}}}static addChild(t,r,n){n.parent=t;const i={path:Array.isArray(r)?r:[r],value:n};return t.children=t.children||[],t.children.push(i),t}static updateChildrenByPath(t,r,n){if(!t.children)return t;const i=t.children.map(s=>s.path.join()===r.join()?{...s,value:n(s)}:s);return{...t,children:i}}},Vt=Symbol("template"),ri=class{constructor(e){this.hooks={resolveTemplateSubstitutions:new j},this.options=e}parseTemplate(e,t,r){const{template:n,depth:i}=t,s=r.data.model.get(t.data);if(!s)return null;if(!Array.isArray(s))throw new Error(`Template using '${t.data}' but is not an array`);const o=[];s.forEach((a,c)=>{const f=this.hooks.resolveTemplateSubstitutions.call([{expression:new RegExp(`_index${i||""}_`),value:String(c)}],{depth:i,data:a,index:c});let d=JSON.stringify(n);for(const{expression:C,value:S}of f){let y="g";typeof C=="object"&&(y=`${C.flags}${C.global?"":"g"}`),d=d.replace(new RegExp(C,y),S)}const m=e(JSON.parse(d),"value",{templateDepth:t.depth+1});m&&o.push(m)});const l={type:"multi-node",override:!1,values:o};return t.placement!==void 0&&(l[Vt]=t.placement),l}applyParser(e){e.hooks.onCreateASTNode.tap("template",t=>t&&t.type==="template"&&!t.dynamic?this.parseTemplate(e.parseObject.bind(e),t,this.options):t),e.hooks.onCreateASTNode.tap("template",t=>{function r(n){if(n.type==="multi-node")return n[Vt];if(n.type==="template")return n.placement}return t&&(t.type==="view"||t.type==="asset")&&Array.isArray(t.children)&&(t.children=t.children.sort((n,i)=>{const s=n.path.join(),o=i.path.join();if(s===o){const a=r(n.value),c=r(i.value);return a!==void 0&&c===void 0?a==="prepend"?-1:1:c!==void 0&&a===void 0?c==="prepend"?1:-1:a!==void 0&&c!==void 0?a===c?0:a==="prepend"?-1:1:0}return s>o?1:-1})),t}),e.hooks.parseNode.tap("template",(t,r,n,i)=>{if(i&&er(i.key))return t.map(s=>{const o=e.createASTNode({type:"template",depth:n.templateDepth??0,data:s.data,template:s.value,dynamic:s.dynamic??!1,placement:s.placement},s);if(o)return o.type==="multi-node"&&o.values.forEach(l=>{l.parent=o}),{path:[...i.path,s.output],value:o}}).filter(Boolean)})}applyResolverHooks(e){e.hooks.beforeResolve.tap("template",(t,r)=>t&&t.type==="template"&&t.dynamic?this.parseTemplate(r.parseNode,t,r):t)}apply(e){e.hooks.parser.tap("template",this.applyParser.bind(this)),e.hooks.resolver.tap("template",this.applyResolverHooks.bind(this)),e.setTemplatePlugin(this)}},nr=(e,t)=>r=>{const n=r.indexOf(e);if(n===-1)return!1;const i=r.indexOf(t);return i===-1?!1:n<i},ni=nr("{{","}}"),ii=nr("@[","]@");function si(e){return ni(e)||ii(e)}function Mt(e,t){return si(e)?nt(e,{model:t.data.model,evaluate:t.evaluate}):e}function ir(e,t,r){if(e==null||typeof e!="object"&&typeof e!="string")return e;if(typeof e=="string")return Mt(e,t);let n=e;return Object.keys(e).forEach(i=>{if(r.has(i))return;const s=e[i];let o=s;typeof s=="object"?o=ir(s,t,r):typeof s=="string"&&(o=Mt(s,t)),o!==s&&(n=U.set(n,i,o))}),n}var sr=(e,t)=>{const r=e.parent;if(!r)return[];if("children"in r){const n=t.getSourceNode(e);return r.children?.find(i=>i.value===n)?.path??[]}return r.type!=="multi-node"?[]:sr(r,t)},oi=class{constructor(){this.propertiesToSkipCache=new Map}applyResolver(e){e.hooks.resolve.tap("string-resolver",(t,r,n)=>{if(r.type==="empty"||r.type==="unknown")return null;if(r.type==="value"||r.type==="asset"||r.type==="view"){let i;r.type==="asset"||r.type==="view"?(i=new Set(r.plugins?.stringResolver?.propertiesToSkip??["exp"]),r.value?.id&&this.propertiesToSkipCache.set(r.value.id,i)):r.parent?.type==="multi-node"&&(r.parent?.parent?.type==="asset"||r.parent?.parent?.type==="view")&&r.parent.parent.value?.id&&this.propertiesToSkipCache.has(r.parent.parent.value.id)?i=this.propertiesToSkipCache.get(r.parent.parent.value.id):i=new Set(["exp"]);const s=sr(r,e);return s.length>0&&s.some(o=>i.has(o.toString()))?r.value:ir(r.value,n,i)}return t})}apply(e){e.hooks.resolver.tap("string-resolver",this.applyResolver.bind(this))}},ai=class{isApplicability(e){return e&&Object.prototype.hasOwnProperty.call(e,"applicability")}applyResolver(e){e.hooks.beforeResolve.tap("applicability",(t,r)=>{let n=t;if(t?.type==="applicability"){if(r.evaluate(t.expression)===!1)return null;n=t.value}return n})}applyParser(e){e.hooks.parseNode.tap("applicability",(t,r,n,i)=>{if(this.isApplicability(t)){const s=e.parseObject(U.omit(t,"applicability"),r,n);if(!s)return i?[]:null;const o=e.createASTNode({type:"applicability",expression:t.applicability,value:s},t);return o?(o.type==="applicability"&&(o.value.parent=o),i?[{path:[...i.path,i.key],value:o}]:o):i?[]:null}})}apply(e){e.hooks.resolver.tap("applicability",this.applyResolver.bind(this)),e.hooks.parser.tap("applicability",this.applyParser.bind(this))}},li=class{constructor(e){this.options=e}resolveSwitch(e,t){for(const r of e.cases)if(t.evaluate(r.case))return r.value;return Pn}isSwitch(e){return e&&(Object.prototype.hasOwnProperty.call(e,"dynamicSwitch")||Object.prototype.hasOwnProperty.call(e,"staticSwitch"))}applyParser(e){e.hooks.onCreateASTNode.tap("switch",t=>t&&t.type==="switch"&&!t.dynamic?this.resolveSwitch(t,this.options):t),e.hooks.parseNode.tap("switch",(t,r,n,i)=>{if(this.isSwitch(t)||i&&Pt(i.key)){const s=i&&Pt(i.key)?{[i.key]:t}:t,o="dynamicSwitch"in s,a=(o?s.dynamicSwitch:s.staticSwitch).map(f=>{const{case:d,...m}=f,C=e.parseObject(m,"value",n);if(C)return{case:d,value:C}}).filter(Boolean),c=e.createASTNode({type:"switch",dynamic:o,cases:a},s);if(!c||c.type==="empty")return i?[]:null;if(c.type==="switch"&&c.cases.forEach(f=>{f.value.parent=c}),i){let f=[...i.path,i.key],d=c;if(c.type==="value"&&c.children?.length===1&&c.value===void 0){const m=c.children[0];f=[...f,...m.path],d=m.value}return[{path:f,value:d}]}return c}})}applyResolver(e){e.hooks.beforeResolve.tap("switch",(t,r)=>t&&t.type==="switch"&&t.dynamic?this.resolveSwitch(t,r):t)}apply(e){e.hooks.parser.tap("switch",this.applyParser.bind(this)),e.hooks.resolver.tap("switch",this.applyResolver.bind(this))}},ci=class{applyParser(e){e.hooks.parseNode.tap("multi-node",(t,r,n,i)=>{if((i===void 0||!er(i.key))&&Array.isArray(t)){const s=t.map(l=>e.parseObject(l,"value",n)).filter(l=>!!l);if(!s.length)return[];const o=e.createASTNode({type:"multi-node",override:i!==void 0&&!On(i.parentObj,i.key),values:s},t);return o?(o.type==="multi-node"&&o.values.forEach(l=>{l.parent=o}),i===void 0?o:[{path:[...i.path,i.key],value:o}]):[]}})}apply(e){e.hooks.parser.tap("multi-node",this.applyParser.bind(this))}},ui=class{applyParser(e){e.hooks.parseNode.tap("asset",(t,r,n,i)=>{if(i?.key==="asset"&&typeof t=="object"){const s=e.parseObject(t,"asset",n);return s?[{path:[...i.path,i.key],value:s}]:[]}})}apply(e){e.hooks.parser.tap("asset",this.applyParser.bind(this))}};function Je(e,t){return e===t?!0:e.parent?Je(e.parent,t):!1}var hi=class{constructor(e){this.registry=e,this.stateStore=new Map,this.beforeResolveSymbol=Symbol("before resolve"),this.resolveSymbol=Symbol("resolve"),this.beforeResolveCountSymbol=Symbol("before resolve count"),this.resolveCountSymbol=Symbol("resolve count")}apply(e){this.stateStore.clear(),e.hooks.resolver.tap("asset-transform",t=>{let r;const n=s=>{r=s,e.update(new Set)},i=(s,o)=>{let l;const a=o===this.resolveSymbol?this.resolveCountSymbol:this.beforeResolveCountSymbol,c=this.stateStore.get(s);return c?(l=c,l.removeKey(a)):(l=new qn(()=>{n(s)}),this.stateStore.set(s,l)),{useSharedState:f=>l.useSharedState(f),useLocalState:f=>l.getLocalStateFunction(o,a)(f)}};t.hooks.beforeResolve.tap("asset-transform",(s,o)=>{if(s&&(s.type==="asset"||s.type==="view")){const l=this.registry.get(s.value);if(l?.beforeResolve){const a=i(o.node??s,this.beforeResolveSymbol);return l.beforeResolve(s,o,a)}}return s}),t.hooks.afterUpdate.tap("asset-transform",()=>{r=void 0}),t.hooks.skipResolve.tap("asset-transform",(s,o)=>{if(!s||!r)return s;const l=Je(r,o),a=Je(o,r);return!l&&!a}),t.hooks.afterResolve.tap("asset-transform",(s,o,l)=>{if(o.type!=="asset"&&o.type!=="view")return s;const a=t.getSourceNode(o);if(!a)return s;const c=this.registry.get(s);if(c?.resolve){const f=i(a,this.resolveSymbol);return c?.resolve(s,l,f)}return s})})}},fi=class{constructor(){this.name="flow-exp-plugin"}apply(e){let t;const r=n=>{n&&(typeof n=="object"&&"exp"in n?t?.evaluate(n.exp):t?.evaluate(n))};e.hooks.expressionEvaluator.tap(this.name,n=>{t=n}),e.hooks.flowController.tap(this.name,n=>{n.hooks.flow.tap(this.name,i=>{i.hooks.onStart.tap(this.name,s=>r(s)),i.hooks.onEnd.tap(this.name,s=>r(s)),i.hooks.resolveTransitionNode.intercept({call:s=>{s?.onStart&&r(s.onStart)}})})})}},di=e=>(r,n,i)=>e.getFormatterForType({type:i})?.format(n)??n,pi=class{constructor(){this.name="flow-exp-plugin"}apply(e){let t;e.hooks.schema.tap(this.name,r=>{t=di(r)}),e.hooks.expressionEvaluator.tap(this.name,r=>{t&&r.addExpressionFunction("format",t),r.addExpressionFunction("log",(n,...i)=>{e.logger.info(...i)}),r.addExpressionFunction("debug",(n,...i)=>{e.logger.debug(...i)}),r.addExpressionFunction("eval",(n,...i)=>n.evaluate(...i))})}},gi={ref:Symbol("not-started"),status:"not-started"},vi="https://github.com/player-ui/player/pull/802",wi="17ce531cbbca3f4188f7f0fcb915fce16094a189",or=class Xe{constructor(t){this.logger=new vn,this.constantsController=new Gn,this.state=gi,this.hooks={flowController:new P,viewController:new P,view:new P,expressionEvaluator:new P,dataController:new P,schema:new P,validationController:new P,bindingParser:new P,errorController:new P,state:new P,onStart:new P,onEnd:new P,resolveFlowContent:new j},t?.logger&&this.logger.addHandler(t.logger),this.config=t||{},this.config.plugins=[new pi,...this.config.plugins||[],new fi],this.config.plugins?.forEach(r=>{r.apply(this)})}getPlugins(){return this.config.plugins??[]}findPlugin(t){return this.config.plugins?.find(r=>r.symbol===t)}applyTo(t,r){const n=this.findPlugin(t);n&&r(n)}registerPlugin(t){t.apply(this),this.config.plugins?.push(t)}getVersion(){return Xe.info.version}getCommit(){return Xe.info.commit}getState(){return this.state}setState(t){this.state=t,this.hooks.state.call(t)}setupFlow(t){const r=this.hooks.resolveFlowContent.call(t),n=new Nn(r.navigation,{logger:this.logger});this.hooks.onStart.call(r),this.hooks.flowController.call(n);let i,s;const o=new qr({get:S=>s.get(S),set:S=>s.set(S),evaluate:S=>i.evaluate(S)});this.hooks.bindingParser.call(o);const l=o.parse,a=_t(),c=new mn(r.schema);this.hooks.schema.call(c);const f=new zn(c);this.hooks.validationController.call(f);const d=new Jn({logger:this.logger,flow:n,fail:a.reject});this.hooks.errorController.call(d),s=new Kn(r.data,{pathResolver:o,middleware:[...f.getDataMiddleware(),d.getDataMiddleware()],logger:this.logger}),s.hooks.format.tap("player",(S,y)=>{const v=c.getFormatter(y);return v?v.format(S):S}),s.hooks.deformat.tap("player",(S,y)=>{const v=c.getFormatter(y);return v?v.deformat(S):S}),s.hooks.resolveDefaultValue.tap("player",S=>c.getApparentType(S)?.default),d.setOptions({model:s});let m;i=new gn({model:s,logger:this.logger}),this.hooks.expressionEvaluator.call(i),i.hooks.onError.tap("player",S=>(a.reject(S),!0));function C(S,y){return nt(S,{model:s,evaluate:i.evaluate,formatted:y})}return n.hooks.flow.tap("player",S=>{S.hooks.beforeTransition.tap("player",(y,v)=>{const E=y.transitions[v]?v:"*";return y.onEnd&&y.transitions[E]&&(typeof y.onEnd=="object"&&"exp"in y.onEnd?i?.evaluate(y.onEnd.exp):i?.evaluate(y.onEnd)),!("transitions"in y)||!y.transitions[E]?y:U.setIn(y,["transitions",E],C(y.transitions[E]))}),S.hooks.skipTransition.tap("validation",y=>{if(y?.value.state_type==="VIEW"){const{canTransition:v,validations:E}=f.validateView("navigation");if(!v&&E){const O=new Set(E.keys());return m?.currentView?.update(O),!0}}}),S.hooks.resolveTransitionNode.tap("player",y=>{let v=y;return"ref"in y&&(v=U.setIn(y,["ref"],C(y.ref))),"param"in y&&(v=U.setIn(y,["param"],C(y.param,!1))),v}),S.hooks.transition.tap("player",(y,v)=>{v.value.state_type!=="VIEW"&&f.reset()}),S.hooks.afterTransition.tap("player-action-states",y=>{const v=y.currentState?.value;if(v&&v.state_type==="ASYNC_ACTION"){const{exp:E}=v;try{const O=i.evaluateAsync(E);ke(O)?v.await?$t(()=>{O.then(x=>n?.transition(String(x))).catch(a.reject)}):(this.logger.warn("Unawaited promise used as return value in in non-async context, transitioning with '*' value"),n?.transition(String(O))):(this.logger.warn("Non async expression used in async action node"),n?.transition(String(O)))}catch(O){a.reject(O)}}else if(v&&v.state_type==="ACTION"){const{exp:E}=v,O=i.evaluate(E);ke(O)&&this.logger.warn("Async expression used as return value in in non-async context, transitioning with '*' value"),n?.transition(String(O))}i.reset()})}),this.hooks.dataController.call(s),f.setOptions({parseBinding:l,model:s,logger:this.logger,evaluate:i.evaluate,constants:this.constantsController}),m=new Hn(r.views||[],{evaluator:i,parseBinding:l,transition:n.transition,model:s,utils:{findPlugin:S=>this.findPlugin(S)},logger:this.logger,flowController:n,schema:c,format:(S,y)=>{const v=c.getFormatter(S);return v?.format?v.format(y):y},formatValue:(S,y)=>{const v=c.getFormatterForType(S);return v?.format?v.format(y):y},validation:{...f.forView(l),type:S=>c.getType(l(S))},constants:this.constantsController,errorController:d}),m.hooks.view.tap("player",S=>{f.onView(S),this.hooks.view.call(S)}),this.hooks.viewController.call(m),{start:()=>{n.start().then(S=>({endState:C(S,!1),data:s.serialize()})).then(a.resolve).catch(S=>{throw this.logger.error(`Something went wrong: ${S.message}`),S}).catch(a.reject).finally(()=>this.hooks.onEnd.call())},state:{status:"in-progress",flowResult:a.promise,controllers:{data:s,view:m,flow:n,schema:c,expression:i,binding:o,validation:f,error:d},fail:a.reject,flow:r,logger:this.logger}}}async start(t){const r=Symbol(t?.id??"payload"),n=i=>this.state.ref!==r?(this.logger.warn("Received update for a flow that's not the current one"),i):(this.setState(i),i);this.setState({status:"not-started",ref:r});try{const{state:i,start:s}=this.setupFlow(t);this.setState({ref:r,...i}),s();const o={ref:r,status:"completed",flow:i.flow,controllers:{data:i.controllers.data.makeReadOnly()}};return n({...await i.flowResult,...o})}catch(i){throw n({status:"error",ref:r,flow:t,error:i}),i}}};or.info={version:vi,commit:wi};var Ts=or;function yi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Nt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xt(Object(r),!0).forEach(function(n){yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mi(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,s;for(s=0;s<n.length;s++)i=n[s],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function bi(e,t){if(e==null)return{};var r=mi(e,t),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Si(e,t){return Ei(e)||ki(e,t)||Ai(e,t)||Oi()}function Ei(e){if(Array.isArray(e))return e}function ki(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,i=!1,s=void 0;try{for(var o=e[Symbol.iterator](),l;!(n=(l=o.next()).done)&&(r.push(l.value),!(t&&r.length===t));n=!0);}catch(a){i=!0,s=a}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw s}}return r}}function Ai(e,t){if(e){if(typeof e=="string")return Dt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dt(e,t)}}function Dt(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Oi(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ci(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function It(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function jt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?It(Object(r),!0).forEach(function(n){Ci(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pi(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(i,s){return s(i)},n)}}function ue(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=e.length?e.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return t.apply(r,[].concat(i,l))}}}function Ae(e){return{}.toString.call(e).includes("Object")}function Ti(e){return!Object.keys(e).length}function de(e){return typeof e=="function"}function Ri(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Vi(e,t){return Ae(t)||J("changeType"),Object.keys(t).some(function(r){return!Ri(e,r)})&&J("changeField"),t}function Mi(e){de(e)||J("selectorType")}function xi(e){de(e)||Ae(e)||J("handlerType"),Ae(e)&&Object.values(e).some(function(t){return!de(t)})&&J("handlersType")}function Ni(e){e||J("initialIsRequired"),Ae(e)||J("initialType"),Ti(e)&&J("initialContent")}function Di(e,t){throw new Error(e[t]||e.default)}var Ii={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},J=ue(Di)(Ii),be={changes:Vi,selector:Mi,handler:xi,initial:Ni};function ji(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};be.initial(e),be.handler(t);var r={current:e},n=ue($i)(r,t),i=ue(_i)(r),s=ue(be.changes)(e),o=ue(Bi)(r);function l(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(f){return f};return be.selector(c),c(r.current)}function a(c){Pi(n,i,s,o)(c)}return[l,a]}function Bi(e,t){return de(t)?t(e.current):t}function _i(e,t){return e.current=jt(jt({},e.current),t),t}function $i(e,t,r){return de(t)?t(e.current):Object.keys(r).forEach(function(n){var i;return(i=t[n])===null||i===void 0?void 0:i.call(t,e.current[n])}),r}var Fi={create:ji},Ui={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function Li(e){return function t(){for(var r=this,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length>=e.length?e.apply(this,i):function(){for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];return t.apply(r,[].concat(i,l))}}}function zi(e){return{}.toString.call(e).includes("Object")}function Hi(e){return e||Bt("configIsRequired"),zi(e)||Bt("configType"),e.urls?(qi(),{paths:{vs:e.urls.monacoBase}}):e}function qi(){console.warn(ar.deprecation)}function Wi(e,t){throw new Error(e[t]||e.default)}var ar={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Bt=Li(Wi)(ar),Ki={config:Hi},Gi=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(i){return r.reduceRight(function(s,o){return o(s)},i)}};function lr(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],lr(e[r],t[r]))}),Nt(Nt({},e),t)}var Qi={type:"cancelation",msg:"operation is manually canceled"};function Ue(e){var t=!1,r=new Promise(function(n,i){e.then(function(s){return t?i(Qi):n(s)}),e.catch(i)});return r.cancel=function(){return t=!0},r}var Yi=Fi.create({config:Ui,isInitialized:!1,resolve:null,reject:null,monaco:null}),cr=Si(Yi,2),pe=cr[0],Oe=cr[1];function Ji(e){var t=Ki.config(e),r=t.monaco,n=bi(t,["monaco"]);Oe(function(i){return{config:lr(i.config,n),monaco:r}})}function Xi(){var e=pe(function(t){var r=t.monaco,n=t.isInitialized,i=t.resolve;return{monaco:r,isInitialized:n,resolve:i}});if(!e.isInitialized){if(Oe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Ue(Le);if(window.monaco&&window.monaco.editor)return ur(window.monaco),e.resolve(window.monaco),Ue(Le);Gi(Zi,ts)(rs)}return Ue(Le)}function Zi(e){return document.body.appendChild(e)}function es(e){var t=document.createElement("script");return e&&(t.src=e),t}function ts(e){var t=pe(function(n){var i=n.config,s=n.reject;return{config:i,reject:s}}),r=es("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function rs(){var e=pe(function(r){var n=r.config,i=r.resolve,s=r.reject;return{config:n,resolve:i,reject:s}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){ur(r),e.resolve(r)},function(r){e.reject(r)})}function ur(e){pe().monaco||Oe({monaco:e})}function ns(){return pe(function(e){var t=e.monaco;return t})}var Le=new Promise(function(e,t){return Oe({resolve:e,reject:t})}),hr={config:Ji,init:Xi,__getMonacoInstance:ns},is={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},ze=is,ss={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},os=ss;function as({children:e}){return oe.createElement("div",{style:os.container},e)}var ls=as,cs=ls;function us({width:e,height:t,isEditorReady:r,loading:n,_ref:i,className:s,wrapperProps:o}){return oe.createElement("section",{style:{...ze.wrapper,width:e,height:t},...o},!r&&oe.createElement(cs,null,n),oe.createElement("div",{ref:i,style:{...ze.fullWidth,...!r&&ze.hide},className:s}))}var hs=us,fr=R.memo(hs);function fs(e){R.useEffect(e,[])}var dr=fs;function ds(e,t,r=!0){let n=R.useRef(!0);R.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var q=ds;function he(){}function se(e,t,r,n){return ps(e,n)||gs(e,t,r,n)}function ps(e,t){return e.editor.getModel(pr(e,t))}function gs(e,t,r,n){return e.editor.createModel(t,r,n?pr(e,n):void 0)}function pr(e,t){return e.Uri.parse(t)}function vs({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:i,originalModelPath:s,modifiedModelPath:o,keepCurrentOriginalModel:l=!1,keepCurrentModifiedModel:a=!1,theme:c="light",loading:f="Loading...",options:d={},height:m="100%",width:C="100%",className:S,wrapperProps:y={},beforeMount:v=he,onMount:E=he}){let[O,x]=R.useState(!1),[_,N]=R.useState(!0),T=R.useRef(null),V=R.useRef(null),D=R.useRef(null),h=R.useRef(E),g=R.useRef(v),u=R.useRef(!1);dr(()=>{let b=hr.init();return b.then(A=>(V.current=A)&&N(!1)).catch(A=>A?.type!=="cancelation"&&console.error("Monaco initialization: error:",A)),()=>T.current?k():b.cancel()}),q(()=>{if(T.current&&V.current){let b=T.current.getOriginalEditor(),A=se(V.current,e||"",n||r||"text",s||"");A!==b.getModel()&&b.setModel(A)}},[s],O),q(()=>{if(T.current&&V.current){let b=T.current.getModifiedEditor(),A=se(V.current,t||"",i||r||"text",o||"");A!==b.getModel()&&b.setModel(A)}},[o],O),q(()=>{let b=T.current.getModifiedEditor();b.getOption(V.current.editor.EditorOption.readOnly)?b.setValue(t||""):t!==b.getValue()&&(b.executeEdits("",[{range:b.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),b.pushUndoStop())},[t],O),q(()=>{T.current?.getModel()?.original.setValue(e||"")},[e],O),q(()=>{let{original:b,modified:A}=T.current.getModel();V.current.editor.setModelLanguage(b,n||r||"text"),V.current.editor.setModelLanguage(A,i||r||"text")},[r,n,i],O),q(()=>{V.current?.editor.setTheme(c)},[c],O),q(()=>{T.current?.updateOptions(d)},[d],O);let p=R.useCallback(()=>{if(!V.current)return;g.current(V.current);let b=se(V.current,e||"",n||r||"text",s||""),A=se(V.current,t||"",i||r||"text",o||"");T.current?.setModel({original:b,modified:A})},[r,t,i,e,n,s,o]),w=R.useCallback(()=>{!u.current&&D.current&&(T.current=V.current.editor.createDiffEditor(D.current,{automaticLayout:!0,...d}),p(),V.current?.editor.setTheme(c),x(!0),u.current=!0)},[d,c,p]);R.useEffect(()=>{O&&h.current(T.current,V.current)},[O]),R.useEffect(()=>{!_&&!O&&w()},[_,O,w]);function k(){let b=T.current?.getModel();l||b?.original?.dispose(),a||b?.modified?.dispose(),T.current?.dispose()}return oe.createElement(fr,{width:C,height:m,isEditorReady:O,loading:f,_ref:D,className:S,wrapperProps:y})}var ws=vs;R.memo(ws);function ys(e){let t=R.useRef();return R.useEffect(()=>{t.current=e},[e]),t.current}var ms=ys,Se=new Map;function bs({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:i,path:s,theme:o="light",line:l,loading:a="Loading...",options:c={},overrideServices:f={},saveViewState:d=!0,keepCurrentModel:m=!1,width:C="100%",height:S="100%",className:y,wrapperProps:v={},beforeMount:E=he,onMount:O=he,onChange:x,onValidate:_=he}){let[N,T]=R.useState(!1),[V,D]=R.useState(!0),h=R.useRef(null),g=R.useRef(null),u=R.useRef(null),p=R.useRef(O),w=R.useRef(E),k=R.useRef(),b=R.useRef(n),A=ms(s),I=R.useRef(!1),H=R.useRef(!1);dr(()=>{let $=hr.init();return $.then(z=>(h.current=z)&&D(!1)).catch(z=>z?.type!=="cancelation"&&console.error("Monaco initialization: error:",z)),()=>g.current?Q():$.cancel()}),q(()=>{let $=se(h.current,e||n||"",t||i||"",s||r||"");$!==g.current?.getModel()&&(d&&Se.set(A,g.current?.saveViewState()),g.current?.setModel($),d&&g.current?.restoreViewState(Se.get(s)))},[s],N),q(()=>{g.current?.updateOptions(c)},[c],N),q(()=>{!g.current||n===void 0||(g.current.getOption(h.current.editor.EditorOption.readOnly)?g.current.setValue(n):n!==g.current.getValue()&&(H.current=!0,g.current.executeEdits("",[{range:g.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),g.current.pushUndoStop(),H.current=!1))},[n],N),q(()=>{let $=g.current?.getModel();$&&i&&h.current?.editor.setModelLanguage($,i)},[i],N),q(()=>{l!==void 0&&g.current?.revealLine(l)},[l],N),q(()=>{h.current?.editor.setTheme(o)},[o],N);let W=R.useCallback(()=>{if(!(!u.current||!h.current)&&!I.current){w.current(h.current);let $=s||r,z=se(h.current,n||e||"",t||i||"",$||"");g.current=h.current?.editor.create(u.current,{model:z,automaticLayout:!0,...c},f),d&&g.current.restoreViewState(Se.get($)),h.current.editor.setTheme(o),l!==void 0&&g.current.revealLine(l),T(!0),I.current=!0}},[e,t,r,n,i,s,c,f,d,o,l]);R.useEffect(()=>{N&&p.current(g.current,h.current)},[N]),R.useEffect(()=>{!V&&!N&&W()},[V,N,W]),b.current=n,R.useEffect(()=>{N&&x&&(k.current?.dispose(),k.current=g.current?.onDidChangeModelContent($=>{H.current||x(g.current.getValue(),$)}))},[N,x]),R.useEffect(()=>{if(N){let $=h.current.editor.onDidChangeMarkers(z=>{let Ce=g.current.getModel()?.uri;if(Ce&&z.find(Pe=>Pe.path===Ce.path)){let Pe=h.current.editor.getModelMarkers({resource:Ce});_?.(Pe)}});return()=>{$?.dispose()}}return()=>{}},[N,_]);function Q(){k.current?.dispose(),m?d&&Se.set(s,g.current.saveViewState()):g.current.getModel()?.dispose(),g.current.dispose()}return oe.createElement(fr,{width:C,height:S,isEditorReady:N,loading:a,_ref:u,className:y,wrapperProps:v})}var Ss=bs,Rs=R.memo(Ss);export{ui as A,qr as B,gn as E,qe as L,ci as M,An as N,Tn as P,Rr as R,mn as S,ri as T,ai as a,li as b,ks as c,Rs as d,j as e,Ts as f,Zn as g,Xn as h,re as i,Os as j,Cn as k,hr as l,Ps as m,As as n,Cs as o,P as p,$t as q,Z as r,nt as s,Yr as w};
